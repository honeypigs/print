(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-formula-pc"],{1101:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=d(r(31)),a=d(r(3)),o=d(r(0)),i=d(r(1)),s=d(r(4)),u=d(r(5)),l=r(136);function d(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(e,r,n,i,u,d){(0,o.default)(this,t);var c=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).call(this));return c.cellId=e,c.row=r,c.col=n,c.sheetId=i,c.nodeType=l.AST_TYPE.CELL,c.crossTableType=u,c.calcFunc=d,c.AsyncFunctionNodeList=[],c}return(0,u.default)(t,e),(0,i.default)(t,[{key:"setFormula",value:function(e){this.formula=e}},{key:"equalsFormula",value:function(e){return this.formula===e}},{key:"setAsyncFunctionNodeList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];e.length>0&&(this.AsyncFunctionNodeList=[]);var t=!0,r=!1,a=void 0;try{for(var o,i=(0,n.default)(e);!(t=(o=i.next()).done);t=!0){var s=o.value;this.AsyncFunctionNodeList.push(s)}}catch(u){r=!0,a=u}finally{try{!t&&i.return&&i.return()}finally{if(r)throw a}}}},{key:"getAsyncFunctionNodeList",value:function(){return this.AsyncFunctionNodeList}},{key:"setBody",value:function(e){this.body=e}},{key:"bodyCalc",value:function(){var e=void 0;return this.body&&(e=this.body.calculate(),this.value=e),e}},{key:"calculate",value:function(){var e=this.calcFunc(this.cellId,this.sheetId,this);return this.value=e,e}},{key:"toString",value:function(e,t){"function"===typeof t.CELL?t.CELL(e,this):e.push(this.cellId)}}]),t}(d(r(184)).default);t.default=c},1102:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(r(0)),a=o(r(1));function o(e){return e&&e.__esModule?e:{default:e}}var i=function(){function e(t,r,a){(0,n.default)(this,e),this.identities=t,this.isCell=r,this.toArray=a}return(0,a.default)(e,[{key:"getRangeCount",value:function(){return this.identities.length}},{key:"getIdentities",value:function(e){return this.identities[e]}},{key:"getRowCount",value:function(e){return this.identities[e].rowCount}},{key:"getColumnCount",value:function(e){return this.identities[e].colCount}},{key:"getRow",value:function(e){return this.identities[e].row}},{key:"getColumn",value:function(e){return this.identities[e].col}},{key:"getSheetId",value:function(e){return this.identities[e].sheetId}}]),e}();t.default=i},1103:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=l(r(3)),a=l(r(0)),o=l(r(1)),i=l(r(4)),s=l(r(5)),u=r(136);function l(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(e,r,o,s,l,d,c,h,f,m){(0,a.default)(this,t);var p=(0,i.default)(this,(t.__proto__||(0,n.default)(t)).call(this));return p.nodeType=u.AST_TYPE.CELL_RANGE,p.startSheetId=e,p.endSheetId=r,p.cellRangeType=c,p.crossTableType=h,p.start=o,p.end=s,p.scope=l,p.sheetIds=d,p.calcFunc=m,p.originValue=f,p}return(0,s.default)(t,e),(0,o.default)(t,[{key:"calculate",value:function(){var e=this.calcFunc(this);return this.value=e,e}},{key:"toString",value:function(e,t){"function"===typeof t.CELL_RANGE?t.CELL_RANGE(e,this):e.push(this.originValue)}}]),t}(l(r(184)).default);t.default=d},1104:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=l(r(3)),a=l(r(0)),o=l(r(1)),i=l(r(4)),s=l(r(5)),u=r(136);function l(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(e,r,o,s){(0,a.default)(this,t);var l=(0,i.default)(this,(t.__proto__||(0,n.default)(t)).call(this));return l.nodeType=u.AST_TYPE.CELL_RANGE_BINARY,l.binaryType=o,l.leftRange=e,l.rightRange=r,l.calcFunc=s,l}return(0,s.default)(t,e),(0,o.default)(t,[{key:"calculate",value:function(){this.leftRange.setCalculateParentFunctionNode(this.calculateParentFunctionNode),this.rightRange.setCalculateParentFunctionNode(this.calculateParentFunctionNode);var e=this.leftRange.calculate(),t=this.rightRange.calculate(),r=this.calcFunc(e,t);return this.value=r,r}},{key:"toString",value:function(e,t){this.binaryType===u.RANGE_BINARY_TYPE.CONCAT?(this.leftRange.toString(e,t),e.push(","),this.rightRange.toString(e,t)):this.binaryType===u.RANGE_BINARY_TYPE.INTERSECTION&&(this.leftRange.toString(e,t),e.push(" "),this.rightRange.toString(e,t))}}]),t}(l(r(184)).default);t.default=d},1105:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=m(r(114)),a=m(r(3)),o=m(r(0)),i=m(r(1)),s=m(r(4)),u=m(r(5)),l=m(r(47)),d=r(136),c=m(r(184)),h=r(44),f=r(201);function m(e){return e&&e.__esModule?e:{default:e}}var p=function(e,t,r,n){return new(r||(r=l.default))(function(a,o){function i(e){try{u(n.next(e))}catch(t){o(t)}}function s(e){try{u(n.throw(e))}catch(t){o(t)}}function u(e){e.done?a(e.value):new r(function(t){t(e.value)}).then(i,s)}u((n=n.apply(e,t||[])).next())})},R=window.location.href.indexOf("showFormulaLog=1")>=0,g={LEFT:!0,RIGHT:!0,MID:!0,SUMPRODUCT:!0,FIND:!0,SUBSTITUTE:!0,CONCATENATE:!0,CONCAT:!0,OFFSET:!0,FIXED:!0,REPT:!0,SMALL:!0,LARGE:!0,EOMONTH:!0,EDATE:!0,WEEKNUM:!0,DOLLAR:!0,"FLOOR.MATH":!0,"CEILING.MATH":!0,"FLOOR.PRECISE":!0,"CEILING.PRECISE":!0,BIN2OCT:!0,BIN2HEX:!0,OCT2BIN:!0,OCT2HEX:!0,HEX2BIN:!0,HEX2OCT:!0,DEC2BIN:!0,DEC2OCT:!0,DEC2HEX:!0,COMPLEX:!0,MODE:!0,"MODE.SNGL":!0,PERCENTRANK:!0,"PERCENTRANK.INC":!0,"PERCENTRANK.EXC":!0,ERF:!0,"WORKDAY.INTL":!0,RANDBETWEEN:!0},v=function(e){function t(e,r,n){(0,o.default)(this,t);var i=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).call(this));return i.nodeType=d.AST_TYPE.FUNCTION,i.args=r,i.funcName=e,i.calcFunc=n,i.noCache=!0,i}return(0,u.default)(t,e),(0,i.default)(t,[{key:"setFormatType",value:function(e){this.formatType=e}},{key:"toString",value:function(e,t){e.push(this.funcName+"(");for(var r=0;r<this.args.length;r++){this.args[r].toString(e,t),r!==this.args.length-1&&e.push(",")}e.push(")")}},{key:"calculate",value:function(){var e=this.value;if(this.noCache){for(var t=this.args.length,r=[],n=0;n<t;n++){var a=this.args[n];a.calculateParentFunctionNode=this;var o=a.calculate();(0,f.isVariableNode)(a)&&a.variableType===d.VARIABLE_TYPE.PLACEHOLDER&&(o=g[this.funcName]?"":0),r.push(o)}try{e=this.calcFunc(this.funcName,r,this.args,this)}catch(i){R&&console.log(i),e=(0,h.getErrorMsg)(i.message)}"number"!==typeof e||isFinite(e)||(e=h.error.num),this.value=e}else this.noCache=!0;return e}},{key:"asyncCalculate",value:function(){return p(this,void 0,void 0,n.default.mark(function e(){var t;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.calculate();case 2:return t=e.sent,this.noCache=!1,this.value=t,e.abrupt("return",t);case 6:case"end":return e.stop()}},e,this)}))}}]),t}(c.default);t.default=v},1108:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=d(r(3)),a=d(r(0)),o=d(r(1)),i=d(r(4)),s=d(r(5)),u=r(136),l=d(r(184));function d(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(e,r,o,s){(0,a.default)(this,t);var l=(0,i.default)(this,(t.__proto__||(0,n.default)(t)).call(this));return l.nodeType=u.AST_TYPE.VARIABLE,l.variableType=r,l.originValueNode=e,l.calcFunc=o,l.toString=s,l}return(0,s.default)(t,e),(0,o.default)(t,[{key:"calculate",value:function(){var e=this.originValueNode;this.originValueNode instanceof l.default&&(this.originValueNode.setCalculateParentFunctionNode(this.calculateParentFunctionNode),e=this.originValueNode.calculate());var t=this.calcFunc(e);return this.value=t,t}}]),t}(l.default);t.default=c},1109:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CellRangeWithFixedInfo=void 0;var n=d(r(0)),a=d(r(1)),o=r(44),i=r(246),s=d(r(11)),u=d(r(35)),l=d(r(15));function d(e){return e&&e.__esModule?e:{default:e}}function c(e,t,r,n,a,i,s,u){var l=a?0:t+1+(n?u:0),d=i?0:e+1+(r?s:0);if(!a&&l<=0||!i&&d<=0)return"#REF!";return(a?"":(n?"":"$")+(0,o.toColumnName)(l))+(i?"":(r?"":"$")+d)}(t.CellRangeWithFixedInfo=function(){function e(t){(0,n.default)(this,e),this.isRowArray=!1,this.isColArray=!1,this.isPositionRely=!1,this.startSheetId="",this.endSheetId="",this.isCellRangeReferenceCorrect=!0,this.startRowIndex=t.startRowIndex,this.endRowIndex=t.endRowIndex,this.startColIndex=t.startColIndex,this.endColIndex=t.endColIndex,this.isStartRowRelative=t.isStartRowRelative,this.isEndRowRelative=t.isEndRowRelative,this.isStartColRelative=t.isStartColRelative,this.isEndColRelative=t.isEndColRelative,"boolean"===typeof t.isColArray&&(this.isColArray=t.isColArray),"boolean"===typeof t.isRowArray&&(this.isRowArray=t.isRowArray),t.isPositionRely&&(this.isPositionRely=t.isPositionRely),"string"===typeof t.startSheetId&&(this.startSheetId=t.startSheetId),"string"===typeof t.endSheetId&&(this.endSheetId=t.endSheetId),"boolean"===typeof t.isCellRangeReferenceCorrect&&(this.isCellRangeReferenceCorrect=t.isCellRangeReferenceCorrect)}return(0,a.default)(e,[{key:"serialize",value:function(){var e=[this.startRowIndex,this.endRowIndex,this.startColIndex,this.endColIndex];return e.push(this.isStartRowRelative?1:0),e.push(this.isEndRowRelative?1:0),e.push(this.isStartColRelative?1:0),e.push(this.isEndColRelative?1:0),e.push(this.isRowArray?1:0),e.push(this.isColArray?1:0),e.push(this.isPositionRely?1:0),e.push(this.startSheetId?this.startSheetId:""),e.push(this.endSheetId?this.endSheetId:""),e.push(this.isCellRangeReferenceCorrect?1:0),e}},{key:"clone",value:function(){return new e(this)}},{key:"combine",value:function(e){this.isEndColRelative=e.isEndColRelative,this.endColIndex=e.endColIndex,this.isEndRowRelative=e.isEndRowRelative,this.endRowIndex=e.endRowIndex}},{key:"getAbsoluteEndCol",value:function(e){return(0,o.getAbsoluteNumber)(this.endColIndex,e,this.isEndColRelative)}},{key:"getAbsoluteEndRow",value:function(e){return(0,o.getAbsoluteNumber)(this.endRowIndex,e,this.isEndRowRelative)}},{key:"getAbsoluteStartCol",value:function(e){return(0,o.getAbsoluteNumber)(this.startColIndex,e,this.isStartColRelative)}},{key:"getAbsoluteStartRow",value:function(e){return(0,o.getAbsoluteNumber)(this.startRowIndex,e,this.isStartRowRelative)}},{key:"getVirtualUniqueIdForGraphBySheetId",value:function(e,t,r){return"cross-sheet-temp-"+r+"!"+this.toStringWithoutSheetName(e,t)}},{key:"isContainedByRange",value:function(e){var t=e.row,r=e.col,n=e.range;if(this.isCrossSheetReference&&(this.startSheetId!==n.sheetId||this.endSheetId!==n.sheetId))return!1;if(this.isRowArray||this.isColArray){if(n instanceof s.default)return!1;var a=n.dimension===l.default.ROWS;if(this.isRowArray!==a)return!1;if(a){var o=this.getAbsoluteStartRow(t),i=this.getAbsoluteEndRow(t);return o>=n.startIndex&&i<=n.endIndex}var d=this.getAbsoluteStartCol(r),c=this.getAbsoluteEndCol(r);return d>=n.startIndex&&c<=n.endIndex}var h=this.getAbsoluteStartRow(t),f=this.getAbsoluteEndRow(t),m=this.getAbsoluteStartCol(r),p=this.getAbsoluteEndCol(r);return n instanceof u.default?n.dimension===l.default.ROWS?h>=n.startIndex&&f<=n.endIndex:m>=n.startIndex&&p<=n.endIndex:h>=n.startRowIndex&&f<=n.endRowIndex&&m>=n.startColIndex&&p<=n.endColIndex}},{key:"toString",value:function(e,t,r){var n="";return n+=this.toStringWithOnlySheetName(r),n+=this.toStringWithoutSheetName(e,t)}},{key:"_toString",value:function(){var e=this.startRowIndex+","+this.endRowIndex+","+this.startColIndex+","+this.endColIndex;return e+=","+(this.isStartRowRelative?1:0),e+=","+(this.isEndRowRelative?1:0),e+=","+(this.isStartColRelative?1:0),e+=","+(this.isEndColRelative?1:0),e+=","+(this.isRowArray?1:0),e+=","+(this.isColArray?1:0),e+=","+(this.isPositionRely?1:0),e+=","+this.startSheetId||!1,e+=","+this.endSheetId||!1,e+=","+(this.isCellRangeReferenceCorrect?1:0)}},{key:"toStringWithOnlySheetName",value:function(e){var t="";if(this.isSheetReferenceCorrect){if(this.isCrossSheetReference){var r=this.isThreeDimensionalReference,n=e(this.startSheetId);if(n=this.transformSingleQuoteToTwoQuotes(n),r){var a=e(this.endSheetId);if(a=this.transformSingleQuoteToTwoQuotes(a),n&&a){var o=!(0,i.isSheetNameValidateForCrossSheet)(n)||!(0,i.isSheetNameValidateForCrossSheet)(a);t+=(o?"'":"")+n+":"+a+(o?"'":"")+"!"}else t+="#REF!"}else t+=n?(0,i.getSheetNameForCorssSheet)(n)+"!":"#REF!"}}else t+="#REF!";return t}},{key:"transformSingleQuoteToTwoQuotes",value:function(e){return e.replace(/'/g,"''")}},{key:"updateAfterFormulaPositionChange",value:function(e){var t=e.oldRow,r=e.oldCol,n=e.newRow,a=e.newCol,o=e.keepRelativeRelationship,i=o?1:-1;if(!this.isColArray){var s=(n-t)*i;this.isStartRowRelative!==o&&(this.startRowIndex+=s),this.isEndRowRelative!==o&&(this.endRowIndex+=s)}if(!this.isRowArray){var u=(a-r)*i;this.isStartColRelative!==o&&(this.startColIndex+=u),this.isEndColRelative!==o&&(this.endColIndex+=u)}}},{key:"toStringWithoutSheetName",value:function(e,t){var r="";return this.isCellRangeReferenceCorrect?(r+=c(this.startRowIndex,this.startColIndex,this.isStartRowRelative,this.isStartColRelative,this.isRowArray,this.isColArray,e,t),(this.startRowIndex!==this.endRowIndex||this.startColIndex!==this.endColIndex||this.isStartRowRelative!==this.isEndRowRelative||this.isStartColRelative!==this.isEndColRelative||this.isColArray||this.isRowArray)&&(r+=":",r+=c(this.endRowIndex,this.endColIndex,this.isEndRowRelative,this.isEndColRelative,this.isRowArray,this.isColArray,e,t)),r):"#REF!"}},{key:"isCrossSheetReference",get:function(){return!!(this.startSheetId&&this.endSheetId&&this.isSheetReferenceCorrect)}},{key:"isReferenceCorrect",get:function(){return this.isCellRangeReferenceCorrect&&this.isSheetReferenceCorrect}},{key:"isSheetReferenceCorrect",get:function(){return"#REF!"!==this.startSheetId&&"#REF!"!==this.endSheetId}},{key:"isThreeDimensionalReference",get:function(){return this.isCrossSheetReference&&this.startSheetId!==this.endSheetId}}],[{key:"deserialize",value:function(t){return new e({startRowIndex:t[0],endRowIndex:t[1],startColIndex:t[2],endColIndex:t[3],isStartRowRelative:!!t[4],isEndRowRelative:!!t[5],isStartColRelative:!!t[6],isEndColRelative:!!t[7],isRowArray:!!t[8],isColArray:!!t[9],isPositionRely:!!t[10],startSheetId:t[11]||"",endSheetId:t[12]||"",isCellRangeReferenceCorrect:!!t[13]})}}]),e}()).protoMap={0:{name:"startRowIndex",dataType:Number},1:{name:"endRowIndex",dataType:Number},2:{name:"startColIndex",dataType:Number},3:{name:"endColIndex",dataType:Number},4:{name:"isStartRowRelative",dataType:Boolean},5:{name:"isEndRowRelative",dataType:Boolean},6:{name:"isStartColRelative",dataType:Boolean},7:{name:"isEndColRelative",dataType:Boolean},8:{name:"isRowArray",dataType:Boolean},9:{name:"isColArray",dataType:Boolean},10:{name:"isPositionRely",dataType:Boolean},11:{name:"startSheetId",dataType:String},12:{name:"endSheetId",dataType:String},13:{name:"isCellRangeReferenceCorrect",dataType:Boolean}}},1311:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a=r(9),o=(n=a)&&n.__esModule?n:{default:n};t.formulaAutofix=function(e,t,r){if(!(0,i.isFormula)(e))return e;var n=e;n=(0,i.fixRightBracket)(n);var a=/(\".*?\")/;if(a.test(n)){var o=n.split(a)||[];o.forEach(function(e,n){var i=a.test(e);o[n]=i?e:c(e,t,r)}),n=o.join("")}else n=c(n,t,r);return n};var i=r(44),s=r(246),u=r(369);var l={"\uff1d":{reg:/[\uff1d]/g,target:"="},"\uff08":{reg:/[\uff08]/g,target:"("},"\uff09":{reg:/[\uff09]/g,target:")"},"\uff0c":{reg:/[\uff0c]/g,target:","},"\uff1a":{reg:/[\uff1a]/g,target:":"},"\uff1b":{reg:/[\uff1b]/g,target:";"},"\uff01":{reg:/[\uff01]/g,target:"!"},"\uff0f":{reg:/[\uff0f]/g,target:"/"},"\u3000":{reg:/[\u3000]/g,target:" "}};function d(e,t,r){return e=function(e){return e=~e.indexOf(" (")?e.replace(/[A-Z]+\s+\(/g,function(e){return e.replace(/\s+/,"")}):e}(e=function(e,t){return(0,o.default)(l).forEach(function(r){t.indexOf(r)>=0||(e=e.replace(l[r].reg,l[r].target))}),e}(e,r)),e=function(e,t){return t.forEach(function(t){e=(e=e.split(t.toUpperCase()+"!").join(t+"!")).split(t.toUpperCase()+":").join(t+":")}),e}(e=function(e){var t=e;try{if(t.match(/ID/i)){var r=/ID\(\s*((\d{17}x)|(\d{18})|(\d{15})|([a-zA-Z]\d+))s*,\s*\)/gi,n=t.match(r);n&&n.map(function(e){var r=(e.match(/(\d+x|\d+)\s*,/i)||[])[0];t=t.replace(r,r+"0")}),r=/ID\(\s*((\d{17}x)|(\d{18})|(\d{15}|([a-zA-Z]\d+)))\s*\)/gi,(n=t.match(r))&&n.map(function(e){var r=(e.match(/(\d+x|\d+)\s*/i)||[])[0];t=t.replace(r,r+",0")})}}catch(a){console.log(a)}return t}(e=function(e){var t=e;if(t.match(/STOCK/i)){var r=t.match(/STOCK\(\s*(\d+\.\w+)\s*(,\s*)?\)/gi);r&&r.map(function(e){t=t.replace(/(\d+\.\w+)\s*(,\s*)?\)/i,function(e){return e.replace(/(,\s*)?\)/i,",0)")})})}return t}(e=function(e){if(!~e.indexOf(","))return e;var t=e.split(",");return t.forEach(function(e,r){(0===r||e.trim())&&(t[r]=e.replace(/(\s+$)/,""))}),t.join(",")}(e=(0,u.makeSelectionInOrder)(e)))),t)}function c(e,t,r){e=function(e,t,r){var n=e,a=/'\*'!(([a-zA-Z]*\d*)(:[a-zA-Z]*\d*)?)/,o=n.match(a);for(;o;){var i=o[1];if(!i||0===i.length)break;var u=(0,s.getSheetsSyntaxFromAsteriskWildcard)(t,r,i);n=n.replace("'*'!"+i,u),o=n.match(a)}var l=/'(.*\?.*)'!(([a-zA-Z]*\d*)(:[a-zA-Z]*\d*)?)/,d=n.match(l);for(;d;){var c=d[1],h=d[2];if(!h||0===h.length)break;var f=(0,s.getSheetsSyntaxFromQuestionMarkWildcard)(t,r,c,h);n=n.replace("'"+c+"'!"+h,f),d=n.match(l)}return n}(e=function(e,t){var r=e;if(-1===r.indexOf("!"))return r;for(var n=t.filter(function(e){return!(0,s.isSheetNameValidateForCrossSheet)(e)}).sort(function(e,t){return e.length<t.length?1:-1}),a=function(e){for(var a=n[e],o=a.toUpperCase(),i=r.indexOf(o+"!"),s=void 0;i>=0&&s!==i;){var u=r.slice(0,i);if(u.length>0&&":"===u[u.length-1]){for(var l=!1,d=0;d<t.length;d++){var c=t[d],h=c.toUpperCase(),f=u.lastIndexOf(h);if(f>=0&&f+c.length+1===u.length){var m=r.split("");m.splice(f,h.length,"'"+c),r=m.join(""),l=!0;break}}r=l?r.replace(o+"!",function(){return a+"'!"}):r.replace(o+"!",function(){return"'"+a+"'!"})}else if(u.length>0){for(var p=""+u+o,R=!1,g=0;g<t.length;g++){var v=t[g];if(!(v.length<=a.length)){var N=v.toUpperCase(),T=p.lastIndexOf(N);if(T>=0&&T+v.length===p.length){R=!0;break}}}R||(r=r.replace(o+"!",function(){return"'"+a+"'!"}))}else r=r.replace(o+"!",function(){return"'"+a+"'!"});s=i,i=r.indexOf(o+"!")}},o=0;o<n.length;o++)a(o);return r}(e=function(e){return e.toUpperCase()}(e),t),t,r);var n=t.filter(function(e){return(0,s.isSheetNameValidateForCrossSheet)(e)}),a=t.join(""),o=/('.*?'!)/;if(o.test(e)){var i=e.split(o)||[];i.forEach(function(e,r){o.test(e)?(t.forEach(function(t){var r=t.toUpperCase();e=(e=(e=e.replace("'"+r+":",function(){return"'"+t+":"})).replace(":"+r+"'!",function(){return":"+t+"'!"})).replace("'"+r+"'!",function(){return"'"+t+"'!"})}),i[r]=e):i[r]=d(e,n,a)}),e=i.join("")}else e=d(e,n,a);return e}},136:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=t.AST_TYPE=void 0;!function(e){e.CELL="CELL",e.EMPTY_CELL="EMPTY_CELL",e.FUNCTION="FUNCTION",e.VARIABLE="VARIABLE",e.CELL_RANGE="CELL_RANGE",e.CELL_RANGE_BINARY="CELL_RANGE_BINARY"}(n||(t.AST_TYPE=n={}));var a=t.CROSS_TABLE_TYPE=void 0;!function(e){e.NONE="NONE",e.NORMAL="NORMAL",e.THREE_DIMENSION="THREE_DIMENSION"}(a||(t.CROSS_TABLE_TYPE=a={}));var o=t.VARIABLE_TYPE=void 0;!function(e){e.VARIABLE="VARIABLE",e.BINARY="BINARY",e.STR="STR",e.NUM="NUM",e.PLACEHOLDER="PLACEHOLDER",e.BOOL="BOOL",e.TIME="TIME",e.ERROR="ERROR"}(o||(t.VARIABLE_TYPE=o={}));var i=t.CELL_RANGE_TYPE=void 0;!function(e){e.NORMAL="NORMAL",e.ROW="ROW",e.COL="COL",e.USER_RANGE="USER_RANGE",e.CELL="CELL"}(i||(t.CELL_RANGE_TYPE=i={}));var s=t.RANGE_BINARY_TYPE=void 0;!function(e){e.INTERSECTION="INTERSECTION",e.CONCAT="CONCAT"}(s||(t.RANGE_BINARY_TYPE=s={}))},1453:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=O(r(41)),a=O(r(16)),o=O(r(226)),i=O(r(31)),s=O(r(114)),u=O(r(25)),l=O(r(14)),d=O(r(9)),c=O(r(0)),h=O(r(1)),f=O(r(47)),m=r(1454),p=r(44),R=r(201),g=O(r(121)),v=O(r(220)),N=O(r(11)),T=O(r(60)),y=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(435)),C=O(r(7)),E=O(r(78)),I=r(160),A=O(r(15)),S=O(r(749)),w=r(57),M=r(48),F=r(1594),x=r(371);function O(e){return e&&e.__esModule?e:{default:e}}var k=function(e,t,r,n){return new(r||(r=f.default))(function(a,o){function i(e){try{u(n.next(e))}catch(t){o(t)}}function s(e){try{u(n.throw(e))}catch(t){o(t)}}function u(e){e.done?a(e.value):new r(function(t){t(e.value)}).then(i,s)}u((n=n.apply(e,t||[])).next())})},D=window,_=null;var U=function(){function e(t){var r=this,n=t.isPreview,a=void 0!==n&&n,o=t.getRealCellValue,i=t.getRealCellFormat,h=t.countRows,f=t.countCols,g=t.getSheetIdBySheetName,v=t.getSheetIdsAmongTwoSheets,N=t.isCellHidden,T=t.getCellData,y=t.getSheetBySheetId,C=t.getActiveSheetId,E=t.sheetFormulaLayerStatusMap,I=t.sendNoOperationMutationCallBackFromWorker,A=t.isGridRangeInVisbleArea,S=t.isInRowColMove,M=t.getCellEditValue,x=t.updateSingleCellFromFormula,O=t.updateCellsFromFormula,D=t.getSetRangeMutationsFromCells;(0,c.default)(this,e),this.SCHEDULE_UPDATE_INTERVAL_TIME=6e4,this.SCHEDULE_UPDATE_INTERVAL=null,this.nodesNeedToCalculateAfterRowColMove=[],this.addCustomFormulaNodeAndGenerateDependency=function(e){var t=e.formulaModel,n=e.row,a=e.col,o=e.sheetId,i=e.customType,s=e.handleByPositionCenter,u=void 0!==s&&s,l=(0,p.getGraphNodeIdByRowCol)(n,a,o,{customType:i}),d={row:n,col:a,sheetId:o,formulaModel:t,customType:i,id:l,handleByPositionCenter:u};r.addNodeValueAndGenerateDependency(d),r.isSheetComputable(o)&&(r.uncalculatedCustomNodes.push(l),(0,p.delayWithST)().then(function(){var e=r.uncalculatedCustomNodes;0!==e.length&&(r.uncalculatedCustomNodes=[],r.updateGraphFromNodes(e))}))},this.calculateScheduleFormulas=function(){var e=(0,d.default)(r.scheduleUpdateNodesMap);e.length>0&&r.updateGraphFromNodes(e,{isAfterMutationRun:!1})},this.addSingleEdgeDynamically=function(e,t){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).isPositionRely,a=void 0!==n&&n,o=e.id,i=r.node(o);return!!(0,p.isFormulaNode)(i)&&(!r.graph.hasEdge(t,o)&&(r.addNodeValueAndGenerateDependency(e),a?r.addNodePositionDependency(e,t):r.addNodeValueDependency(e,t),r.dynamicChangedNodesMap[o]=!0,!0))},this.addEdgesDynamically=function(e,t){var n=t.rowsEnd,a=t.rowsStart,o=t.colsEnd,i=t.colsStart,s=t.isCell,u=t.sheetId,l=t.isPositionRely,d=void 0!==l&&l,c=r.node(e.id);if(!(0,p.isFormulaNode)(c))return!1;var h=s?"":(0,p.getVirtualRangeNodeIdFromInfo)({sheetId:u,rowsEnd:n,rowsStart:a,colsEnd:o,colsStart:i}),f=h&&r.hasNode(h);if(a<0||i<0)return!1;for(var m=r.graph,R=!1,g=a;g<=n;g++)for(var v=i;v<=o;v++){var N=(0,p.getGraphNodeIdByRowCol)(g,v,u);if(s||!h||f||(R=!0,r.setEdge(N,h)),d){if(m.hasEdge((0,p.getPositionNodeName)(h||N),e.id))continue;R=!0,r.addNodePositionDependency(e,h||N)}else{if(m.hasEdge(h||N,e.id))continue;R=!0,r.addNodeValueDependency(e,h||N)}}return!!R&&(r.dynamicChangedNodesMap[e.id]=!0,!0)},this.addEdgesDynamicallyOnRowCol=function(e,t){var n=t.endIndex,a=t.startIndex,o=t.sheetId,i=t.isPositionRely,s=void 0!==i&&i,u=t.isRow,l=r.node(e.id);if(!(0,p.isFormulaNode)(l))return!1;var d=r.addRowsColsDependency({element:e,startIndex:a,endIndex:n,isRow:u,sheetId:o,isPositionRely:s});return d&&(r.dynamicChangedNodesMap[e.id]=!0),d},this.getItemByRowColOnCurrentSheet=function(e,t){var n=(0,p.getGraphNodeIdByRowCol)(e,t,r.externalMethods.getActiveSheetId());return r.node(n)},this.getUnfinishedCalculationNodesBySheetId=function(e){var t=[];return r.nodes().forEach(function(n){if(0===n.indexOf(e)){var a=r.node(n);if((0,p.isFormulaNode)(a)&&!a.customType){var o=a.row,i=a.col,s=a.formulaModel,u=r.externalMethods.getRealCellValue(o,i,e);null!==u&&"undefined"!==typeof u||t.push({row:o,col:i,sheetId:e,formula:s.toString(o,i)})}}}),t},this.getResultBySingleFormula=function(e,t){r.initCalculationEnvironment();var n=t+"!DATA_VALIDATION";e=e.replace(/^=/,"").trim();var a={sheetId:t,id:n,row:-1,col:-1},o={rowCount:r.externalMethods.countRows(t),colCount:r.externalMethods.countCols(t)};r.plugin.cellMap.toggleCacheStatus(!1);var i=r.plugin.parse(e,(0,l.default)(a,o)),s=void 0,d=!1;if((0,R.isCellNode)(i))try{s=i.bodyCalc()}catch(f){console.error("\u51fd\u6570\u8ba1\u7b97\u65f6\u51fa\u73b0\u9519\u8bef",f),s="object"===("undefined"===typeof f?"undefined":(0,u.default)(f))?f.message:p.error.error}else s=i.error,d=!0;r.plugin.cellMap.toggleCacheStatus(!0);var c={result:(0,p.fixNumber)(s,15)};(0,p.dealWithRangeRef)(i,c,t,r.getValueByTopCellPosition.bind(r)),(0,p.hasError)(c.result)&&(c.error=c.result),(0,p.isCircle)(c.result)&&(c.result=p.error.ref,c.error=p.error.ref);var h=(0,p.getLegalValueResultInfo)(c.result);return"string"===typeof h.result&&(0,p.hasError)(h.result)&&(d=!0),(0,l.default)({},h,{isError:d})},this.getValueByTopCellPosition=function(e,t,n,a){if((0,R.isCalcRef)(e)){var o=void 0,i=void 0;if(1===e.identities.length)i=e.identities[0];else{for(var s=0;s<e.identities.length;s++){var u=e.identities[s];u.sheetId===a&&(i=u)}void 0===i&&(i=e.identities[0])}if(1===i.colCount){if(t>i.row+i.rowCount-1||t<i.row)return p.error.value;var l=i.col,d=t;o=r.plugin.helper.getCellValueByData(d,l,a)}else if(1===i.rowCount){if(n>i.col+i.colCount-1||n<i.col)return p.error.value;var c=i.row,h=n;o=r.getCellValue(c,h,a)}return void 0!==o?o:p.error.value}},this.markNodeToRecalculateAfterNetworkChange=function(e,t){var n=r.node(e);(0,p.isFormulaNode)(n)&&(r.updateNodeValue(e,{needRecalcuateWhenNetWorkerOnline:!0}),r.needRecalculateWhenNetworkOnlineFunctionNodeIds.push(t))},this.removeCustomFormulaNode=function(e){var t=e.row,n=e.col,a=e.sheetId,o=e.customType,i=(0,p.getGraphNodeIdByRowCol)(t,n,a,{customType:o});r.removeNode(i)},this.removeCustomFormulaNodeByType=function(e){var t="!-"+e+"-";r.nodes().forEach(function(e){e.indexOf(t)>-1&&r.removeNode(e)})},this.triggerAutoUpdateFormulaUpdate=function(){return k(r,void 0,void 0,s.default.mark(function e(){var t;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((0,d.default)(this.alwaysNeedToUpdateNodesMap).length){e.next=3;break}return e.abrupt("return");case 3:return t=this.graphUpdateTimes,e.next=6,(0,p.delayWithST)(100);case 6:if(t===this.graphUpdateTimes){e.next=8;break}return e.abrupt("return");case 8:this.updateGraphFromNodes([],{isAfterMutationRun:!1});case 9:case"end":return e.stop()}},e,this)}))},this.getCellValue=function(e,t,n){var a=r.getItemByRowCol(e,t,n);if((0,p.isFormulaNode)(a)){var o="undefined"!==typeof a.oriValue?a.oriValue:"undefined"!==typeof a.error?a.error:a.value;if("undefined"!==typeof o)return o}return r.externalMethods.getRealCellValue(e,t,n)},this.getCellFormat=function(e,t,n){var a=r.getItemByRowCol(e,t,n);if((0,p.isFormulaNode)(a)){var o=a.userEnteredNumberFormat||a.effectiveFormatNumberFormat;if("undefined"!==typeof o)return o}return r.externalMethods.getRealCellFormat(e,t,n)},this.recalculateNodesWhenNetWorkChanged=function(){if(r.isFirstNetworkChanged)r.isFirstNetworkChanged=!1;else if(0!==r.needRecalculateWhenNetworkOnlineFunctionNodeIds.length){var e=r.nodes().reduce(function(e,t){var n=r.node(t);return(0,p.isFormulaNode)(n)&&n.needRecalcuateWhenNetWorkerOnline&&e.push(t),e},[]);r.needRecalculateWhenNetworkOnlineFunctionNodeIds=[],e.length&&r.updateGraphFromNodes(e)}},this.calculationEnvironomentInited=!1,_&&clearInterval(_);var U=(0,F.ruleJS)();U.init(),this.plugin=U,this.isPreview=a,U.bindCustomMethod({cellValue:o,cellFormat:i,getValueByTopCellPosition:this.getValueByTopCellPosition,countRows:h,countCols:f,getLegalValueResultInfo:p.getLegalValueResultInfo,getSheetIdBySheetName:g,getSheetIdsAmongTwoSheets:v,isNumeric:w.isNumeric,isCellHidden:N,parseValueWithStyle:w.parseValueWithStyle,markNodeToRecalculateAfterNetworkChange:this.markNodeToRecalculateAfterNetworkChange,cellEditValue:M,addSingleEdgeDynamically:this.addSingleEdgeDynamically,addEdgesDynamicallyOnRowCol:this.addEdgesDynamicallyOnRowCol,addEdgesDynamically:this.addEdgesDynamically}),this.externalMethods={getRealCellValue:o,getRealCellFormat:i,countRows:h,countCols:f,getSheetIdBySheetName:g,getSheetIdsAmongTwoSheets:v,isCellHidden:N,getCellData:T,getSheetBySheetId:y,getActiveSheetId:C,sheetFormulaLayerStatusMap:E,sendNoOperationMutationCallBackFromWorker:I,isGridRangeInVisbleArea:A,isInRowColMove:S,getCellEditValue:M,updateSingleCellFromFormula:x,updateCellsFromFormula:O,getSetRangeMutationsFromCells:D},this.keyframeCalculationConsistentNumbersMap={},this.initCalculationEnvironment(),this.graph=new m.Graph({compound:!0}),this.cellCalculationPromiseMap={},this.graphUpdateTimes=0,this.alwaysNeedToUpdateNodesMap={},this.scheduleUpdateNodesMap={},this.isEdgeGeneratedMap={},this.virtualCrossSheetReferenceMap={},this.sheetDataTranformTime={},this.dynamicChangedNodesMap={},this.uncalculatedCustomNodes=[],this.nodesNeedToCalculateAfterRowColMove=[],this.isFirstNetworkChanged=!0,this.needRecalculateWhenNetworkOnlineFunctionNodeIds=[]}return(0,h.default)(e,[{key:"destroy",value:function(){this.SCHEDULE_UPDATE_INTERVAL&&clearInterval(this.SCHEDULE_UPDATE_INTERVAL),this.plugin.cellMap.destroy()}},{key:"addNodeValueAndGenerateDependency",value:function(e){var t=this,r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).isInit,n=void 0!==r&&r;if((0,p.isFormulaNode)(e))if(this.isEdgeGeneratedMap[e.sheetId]){if(e.formulaModel){var a=e.row,o=e.col,i=e.sheetId;e.formulaModel.autofix(a,o,i)}var s=e.sheetId,u=e.row,l=e.col,d=e.formulaModel;if(n||this.clearInEdges(e.id),this.setNode(e.id,e),!d.hasReferenceError){d.getAllCellRangeWithFixedInfo().forEach(function(r){if(r.isReferenceCorrect){var n=r.isColArray,a=r.isRowArray,o=r.startSheetId,i=r.endSheetId,d=r.isPositionRely;t.externalMethods.getSheetIdsAmongTwoSheets(o||s,i||s).forEach(function(o){if(t.isSheetLoadedByDataLayer(o))if(n||a){var i=n?l:u,s=n?r.getAbsoluteStartCol(i):r.getAbsoluteStartRow(i),c=n?r.getAbsoluteEndCol(i):r.getAbsoluteEndRow(i);t.addRowsColsDependency({element:e,startIndex:s,endIndex:c,isRow:a,sheetId:o,isPositionRely:d})}else{if(t.externalMethods.getSheetBySheetId(o)){var h=r.getAbsoluteStartCol(l),f=r.getAbsoluteEndCol(l),m=r.getAbsoluteStartRow(u),R=r.getAbsoluteEndRow(u),g=Math.min(m,R),v=Math.min(h,f),N=Math.min(Math.max(m,R),t.externalMethods.countRows(o)),T=Math.min(Math.max(h,f),t.externalMethods.countCols(o)),y=g===N&&v===T,C=y?"":(0,p.getVirtualRangeNodeIdFromInfo)({sheetId:o,rowsEnd:N,rowsStart:g,colsEnd:T,colsStart:v});if(!(g<0||v<0))for(var E=g;E<=N;E++)for(var I=v;I<=T;I++){var A=(0,p.getGraphNodeIdByRowCol)(E,I,o);!y&&C&&t.setEdge(A,C),d?t.addNodePositionDependency(e,C||A):t.addNodeValueDependency(e,C||A)}}}})}})}}else this.setNode(e.id,e)}},{key:"getAbandonedRowColReference",value:function(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var s,u=(0,i.default)((0,d.default)(e));!(n=(s=u.next()).done);n=!0){var l=s.value,c=e[l],h=!0,f=!1,m=void 0;try{for(var R,g=(0,i.default)((0,d.default)(c));!(h=(R=g.next()).done);h=!0){var v=R.value,N=parseInt(v),T=(0,p.getVirtualRowColIdFromInfo)({num:N,sheetId:l,isRow:t}),y=this.node(T);(0,p.isCrossSheetRowColNode)(y)||r.push({num:N,sheetId:l})}}catch(C){f=!0,m=C}finally{try{!h&&g.return&&g.return()}finally{if(f)throw m}}}}catch(C){a=!0,o=C}finally{try{!n&&u.return&&u.return()}finally{if(a)throw o}}return r}},{key:"calculateSingleCellFormula",value:function(e){var t=e.row,r=e.col,n=e.id,a=e.sheetId,o=e.formulaModel,i=e.graphUpdateTimes,u=e.mutationQueueIdRelatedSheetId,d=e.isInCycle,c=e.customType,h=e.syncFormulaNodeIdMap,f=e.forceSync;return k(this,void 0,void 0,s.default.mark(function e(){var m,g,v,N,T,C,E,I,A,S,w,M,F,O,k;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(m=o.toString(t,r),g=m.replace(/^=/,"").trim(),v=Date.now(),N=this.getItem(n)||this.updateNodeValue(n,{sheetId:a,formulaModel:o,row:t,col:r,id:n}),T=g,C=(0,l.default)(N,{rowCount:this.externalMethods.countRows(a),colCount:this.externalMethods.countCols(a)}),E=this.plugin.cellMap.getCell(a,t,r),I=void 0===E||!E.equalsFormula(T),A=Date.now(),I?E=this.plugin.parse(T,C):this.plugin.utils.setElement(C),S=Date.now()-A,y.setFormulaPerformence(i,{parseDuration:y.getFormulaPerformence(i).parseDuration+S}),y.setFormulaPerformence(i,{formulaCount:y.getFormulaPerformence(i).formulaCount+1}),!E){e.next=29;break}if(w=void 0,M=void 0,F=void 0,!(0,R.isCellNode)(E)||!E.body){e.next=27;break}return E.reportLongTime(S,x.CellMap.REPORT_TYPE.PARSE),e.next=21,this.calculateAsyncNodes({ast:E,graphUpdateTimes:i});case 21:O=this.runSyncCalculation({ast:E,isInCycle:d,graphUpdateTimes:i,formula:T}),w=O.newValue,M=O.userEnteredNumberFormat,F=O.effectiveFormatNumberFormat,e.next=28;break;case 27:w={result:""===g?"=":p.error.error};case 28:this.runPostProcessingOfCalculation({newValue:w,row:t,col:r,id:n,sheetId:a,formulaModel:o,formula:T,userEnteredNumberFormat:M,graphUpdateTimes:i,mutationQueueIdRelatedSheetId:u,effectiveFormatNumberFormat:F,syncFormulaNodeIdMap:h,ast:E,customType:c,forceSync:f});case 29:k=Date.now()-v,y.setFormulaPerformence(i,{calculateSingleDuration:y.getFormulaPerformence(i).calculateSingleDuration+k});case 31:case"end":return e.stop()}},e,this)}))}},{key:"calculateSingleCellFormulaSync",value:function(e){var t=e.row,r=e.col,n=e.id,a=e.sheetId,o=e.formulaModel,i=e.graphUpdateTimes,s=e.mutationQueueIdRelatedSheetId,u=e.isInCycle,d=e.customType,c=e.syncFormulaNodeIdMap,h=e.forceSync,f=o.toString(t,r).replace(/^=/,"").trim(),m=Date.now(),g=this.getItem(n)||this.updateNodeValue(n,{sheetId:a,formulaModel:o,row:t,col:r,id:n}),v=f,N=(0,l.default)(g,{rowCount:this.externalMethods.countRows(a),colCount:this.externalMethods.countCols(a)}),T=this.plugin.cellMap.getCell(a,t,r),C=void 0===T||!T.equalsFormula(v),E=Date.now();C?T=this.plugin.parse(v,N):this.plugin.utils.setElement(N);var I=Date.now()-E;if(y.setFormulaPerformence(i,{parseDuration:y.getFormulaPerformence(i).parseDuration+I}),y.setFormulaPerformence(i,{formulaCount:y.getFormulaPerformence(i).formulaCount+1}),T){var A=void 0,S=void 0,w=void 0;if((0,R.isCellNode)(T)&&T.body){T.reportLongTime(I,x.CellMap.REPORT_TYPE.PARSE);var M=this.runSyncCalculation({ast:T,isInCycle:u,graphUpdateTimes:i,formula:v});A=M.newValue,S=M.userEnteredNumberFormat,w=M.effectiveFormatNumberFormat}else A={result:""===f?"=":p.error.error};this.runPostProcessingOfCalculation({newValue:A,row:t,col:r,id:n,sheetId:a,formulaModel:o,formula:v,userEnteredNumberFormat:S,graphUpdateTimes:i,mutationQueueIdRelatedSheetId:s,effectiveFormatNumberFormat:w,syncFormulaNodeIdMap:c,ast:T,customType:d,forceSync:h})}var F=Date.now()-m;y.setFormulaPerformence(i,{calculateSingleDuration:y.getFormulaPerformence(i).calculateSingleDuration+F})}},{key:"extendAffectedNodesAfterRowColMove",value:function(e){var t={};return e.forEach(function(e){t[e]=!0}),this.nodesNeedToCalculateAfterRowColMove.forEach(function(e){var r=e.id;t[r]=!0}),this.nodesNeedToCalculateAfterRowColMove=[],(0,d.default)(t)}},{key:"getAllVirtualRowColNodes",value:function(){return this.nodes().filter(function(e){return(0,p.isVirtualRowNodeId)(e)||(0,p.isVirtualColNodeId)(e)})}},{key:"getAllVirtualNodes",value:function(){return this.nodes().filter(function(e){return(0,p.isVirtualNodeId)(e)})}},{key:"getCycles",value:function(){var e=this.graph;return this.hasCycle()?m.alg.findCycles(e):[]}},{key:"getDirectImpactFormulaNodeFromRowColDel",value:function(e){var t=this,r=e.index,n=e.amount,a=e.isRow,o=e.sheetId;return this.nodes().reduce(function(e,i){var s=t.node(i);if(!(0,p.isFormulaNode)(s))return e;var u=s.sheetId,l=s.row,d=s.col,c=s.formulaModel;return s.customType?e:u!==o?e:(c.isAffectedByRowColDel({index:r,amount:n,isRow:a,sheetId:o,nodeSheetId:u,row:l,col:d})&&e.push(s),e)},[])}},{key:"getDirectImpactFormulaNodeFromRowReorder",value:function(e){var t=this,r=e.sheetId,n=e.migrationMap;return this.nodes().reduce(function(e,a){var o=t.node(a);if(!(0,p.isFormulaNode)(o))return e;if(o.customType)return e;var i=o.sheetId,s=o.row;return i!==r?e:(n[s]&&e.push(o),e)},[])}},{key:"getFormulaCountsBySheetId",value:function(e){var t=this;return this.nodes().reduce(function(r,n){var a=t.node(n);return(0,p.isFormulaNode)(a)&&a.sheetId===e&&r++,r},0)}},{key:"getItem",value:function(e){return this.node(e)}},{key:"getItemByRowCol",value:function(e,t,r){var n=(0,p.getGraphNodeIdByRowCol)(e,t,r);return this.node(n)}},{key:"getItemFromSheet",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.externalMethods.getActiveSheetId();return this.node((0,p.getGraphNodeId)(e,t))}},{key:"getItemsAccordingToCustomTypeAndPosition",value:function(e){var t=this;return e.map(function(e){var r=e.row,n=e.col,a=e.sheetId,o=e.customTypes;return{row:r,col:n,sheetId:a,results:o.reduce(function(e,o){var i=(0,p.getGraphNodeIdByRowCol)(r,n,a,{customType:o}),s=t.node(i);return(0,p.isFormulaNode)(s)?e[i]=(0,p.getExtendedValueByFormulaNode)(s):e[i]=null,e},{})}})}},{key:"getInheritanceFormatByAST",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return r||((0,R.walk)(e,function(e,n){if(r)return{stopAll:!0};var a=n.length>2&&n[n.length-2],o=(0,R.isFunctionNodeButNotBinaryNode)(a);if((0,R.isFunctionNodeButNotBinaryNode)(e)){if(e.formatType&&"string"===typeof e.formatType)return r=new g.default({pattern:e.formatType}),{stopAll:!0};var i=e.funcName.toUpperCase();if(!(["SUM","AVERAGE","MIN","MAX","ROUND","TRUNC"].indexOf(i)>-1))return{stopSearchingDown:!0,stopParallelTraversal:o}}if((0,R.isCellNode)(e)){var s=e.row,u=e.col,l=e.sheetId,d=t.getCellFormat(s,u,l);return d&&!(0,M.isGeneralCell)(d)?(r=d,{stopAll:!0}):{stopSearchingDown:!0,stopParallelTraversal:o}}if((0,R.isCellRangeNode)(e)&&!(0,R.isCellRangeNodeCrossTableThreeDimension)(e)){var c=e.start,h=e.cellRangeType,f=e.sheetIds[0],m=void 0;if("COL"===h){var v=c;m=t.getCellFormat(0,(0,p.colIdToCol)(v),f)}else if("ROW"===h){var N=c;m=t.getCellFormat((0,p.rowIdToRow)(N),0,f)}else if("NORMAL"===h){var T=e.scope,y=T.row,C=T.col;m=t.getCellFormat(y,C,f)}return m&&!(0,M.isGeneralCell)(m)?(r=m,{stopAll:!0}):{stopSearchingDown:!0,stopParallelTraversal:!0}}return{stopParallelTraversal:o}},{preorder:!0}),r)}},{key:"getNodeRelationByRowCol",value:function(e,t,r){var n=(0,p.getGraphNodeIdByRowCol)(e,t,r),a=this.node(n),o=(0,p.isFormulaNode)(a)?a:void 0;return{hasRelatedNode:this.hasNode(n),formulaNodeOrVoid:o}}},{key:"hasNode",value:function(e){var t=this.graph.hasNode(e);if((0,p.isVirtualNodeId)(e)||t)return t;var r=(0,p.getRowColFromGraphNodeId)(e),n=r.row,a=r.col,o=r.sheetId,i=(0,p.getVirtualRowColIdFromInfo)({num:a,sheetId:o,isRow:!1});if(this.hasNode(i))return!0;var s=(0,p.getVirtualRowColIdFromInfo)({num:n,sheetId:o,isRow:!0});return!!this.hasNode(s)}},{key:"hasCycle",value:function(){return!m.alg.isAcyclic(this.graph)}},{key:"hasFormula",value:function(e){var t=this,r=this.nodes().reduce(function(r,n){var a=t.node(n);if(!(0,p.isFormulaNode)(a))return r;var o=a.sheetId;return e===o||r},!1);return r||!1}},{key:"hasAlwaysNeedToUpdateNodes",value:function(){return(0,d.default)(this.alwaysNeedToUpdateNodesMap).length>0}},{key:"isSheetComputable",value:function(e){return this.isEdgeGeneratedMap[e]||!1}},{key:"initCalculationEnvironment",value:function(){var e=this;this.calculationEnvironomentInited||(this.calculationEnvironomentInited=!0,r.e("bundle_calculation-environment").then(r.t.bind(null,1661,7)).then(function(t){var r=t.formulajs;e.plugin.formulas=r}))}},{key:"recalculateAfterInitial",value:function(e){return k(this,void 0,void 0,s.default.mark(function t(){var r,n,a,o,i,u,l,d,c=this;return s.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.isEdgeGenerateable()){t.next=2;break}return t.abrupt("return");case 2:return this.isEdgeGeneratedMap[e]=!1,t.next=5,this.externalMethods.sheetFormulaLayerStatusMap.getWaitingPromise(e);case 5:return this.isEdgeGeneratedMap[e]=!0,r=[],n=Date.now(),this.nodes().forEach(function(t){if(!(t.indexOf(e)<0)){var n=c.node(t);(0,p.isFormulaNode)(n)&&(c.addNodeValueAndGenerateDependency(n,{isInit:!0}),r.push(t))}}),S.default.setMutationQueueId(-1,e),this.initCalculationEnvironment(),t.next=13,this.updateGraphFromNodes(r,{sheetId:e});case 13:this.externalMethods.sheetFormulaLayerStatusMap.isSheetCalculating(e)&&this.externalMethods.sheetFormulaLayerStatusMap.setIntializedDone(e),a=Date.now(),o=y.getTimeWhenBuildGraphEndForOpenSheet(),i=a-n,u=o-n,l=a-o,d=this.hasFormula(e),y.openSheetReport({hasFormula:d,graphAndCalculateDuration:i,buildGraphDuration:u,calculateDuration:l,sheetId:e}),this.SCHEDULE_UPDATE_INTERVAL&&clearInterval(this.SCHEDULE_UPDATE_INTERVAL),this.SCHEDULE_UPDATE_INTERVAL=setInterval(this.calculateScheduleFormulas,this.SCHEDULE_UPDATE_INTERVAL_TIME),(0,p.delayWithST)().then(function(){c.getNodesDistributionInfoBySheetId(e)});case 24:case"end":return t.stop()}},t,this)}))}},{key:"removeCrossSheetNodesWhenNewSheetLoadedInMainThread",value:function(e){var t=this;this.nodes().forEach(function(r){var n=t.node(r);if((0,p.isVirtualCrossSheetReference)(n)){if(n.sheetId!==e)return;n.status="NEED_REFRESH",t.updateNodeValue(r,n)}if((0,p.isCrossSheetNode)(n)||(0,p.isCrossSheetRowColNode)(n)){if(n.sheetId!==e)return;var a=t.parent(r);if(a)t.successors(r).forEach(function(e){t.setEdge(a,e)});t.removeNode(r)}})}},{key:"resetSheet",value:function(e){var t=this;this.nodes().forEach(function(r){try{(0,p.getRowColFromGraphNodeId)(r).sheetId===e&&t.removeNode(r)}catch(n){return}}),delete this.isEdgeGeneratedMap[e]}},{key:"syncNewCalculationResultToMainThread",value:function(e){var t=this,r=e.mutationQueueIdRelatedSheetId,n=e.isFinalMutationToCurrentMutationQueueFromFormula,a=e.needToSyncFormulaNodeIdMap,o={},i=(0,d.default)(a).reduce(function(e,r){var n=t.node(r);return(0,p.isFormulaNode)(n)?n.customType?(o[n.customType]=o[n.customType]||[],o[n.customType].push(n),e):(e.push(n),e):e},[]);if(this.notifyCustomTypesToUpdate(o,"customTypeResultChange",r),0!==i.length){var s=this.externalMethods.getSetRangeMutationsFromCells(i);S.default.syncNonPersistentMutationsToMainThread({mutations:s,isFromFormula:!0,mutationQueueIdRelatedSheetId:r,isFinalMutationToCurrentMutationQueueFromFormula:n})}else S.default.syncNonPersistentMutationsToMainThread({mutations:[],isFromFormula:!0,mutationQueueIdRelatedSheetId:r,isFinalMutationToCurrentMutationQueueFromFormula:n})}},{key:"toJSON",value:function(){return m.json.write(this.graph)}},{key:"updateNodeValue",value:function(e,t){if("string"!==typeof e)return!1;if("object"!==("undefined"===typeof t?"undefined":(0,u.default)(t)))return!1;var r=t.needRecalculate,n=this.node(e);if(!(0,p.isFormulaNode)(n))return!!(0,p.isFormulaNode)(t)&&(r&&delete t.needRecalculate,this.setNode(e,t),t);r&&(delete t.needRecalculate,delete n.value,delete n.error);var a=(0,l.default)(n,t);return this.setNode(e,a),a}},{key:"updateGraphFromNodes",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.sheetId,n=void 0===r?S.default.mutationQueueIdRelatedSheetId:r,a=t.isAfterMutationRun,o=void 0===a||a,i=t.forceSync,u=void 0!==i&&i;return k(this,void 0,void 0,s.default.mark(function t(){var r,a,i,l,c,h,m,p,R,g,v,N,T,C,E,I,A,w,M,F,x,O,k,D=this;return s.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==e.length||this.hasAlwaysNeedToUpdateNodes()){t.next=3;break}return this.externalMethods.sendNoOperationMutationCallBackFromWorker(n),t.abrupt("return");case 3:if(r=+new Date,this.graphUpdateTimes++,a=this.graphUpdateTimes,i=S.default.mutationQueueIdRelatedSheetId,(l=!this.externalMethods.sheetFormulaLayerStatusMap.isSheetInitialized(n))&&y.setTimeWhenBuildGraphEndForOpenSheet(),c=y.getAndResetMutationSubscribeTime()||0,y.updateGraphEnd({mutationSubscribeTime:c,isInitSheet:l,isAfterMutationRun:o}),h=Date.now(),m=this.getAllAffectedNodesListFromNodes(e.concat((0,d.default)(this.alwaysNeedToUpdateNodesMap))),p=m.affectedNodesMap,R=m.asyncNodesMap,g=m.affectedSinks,v=this.getTopsortResultAndNodesInCylce(p,g),N=v.idsSortArray,T=v.nodesInCycle,this.plugin.cellMap.startCalc(),C=Date.now()-h,l&&y.setUpdateTimeForOpenSheet(n,a),y.setFormulaPerformence(a,{nodeSortDuration:y.getFormulaPerformence(a).nodeSortDuration+C}),this.dynamicChangedNodesMap={},E={},T.forEach(function(e){D.calculateFormulaSync({idBeforeCalculation:e,graphUpdateTimes:a,mutationQueueIdRelatedSheetId:i,isInCycle:!0,syncFormulaNodeIdMap:E,forceSync:u})}),I=[],N.forEach(function(e){if(R[e]){var t=D.calculateFormulaAsync({idBeforeCalculation:e,graphUpdateTimes:a,mutationQueueIdRelatedSheetId:i,isInCycle:!1,asyncNodesMap:R,forceSync:u});I.push(t)}else D.calculateFormulaSync({idBeforeCalculation:e,graphUpdateTimes:a,mutationQueueIdRelatedSheetId:i,isInCycle:!1,syncFormulaNodeIdMap:E,forceSync:u})}),A=Date.now(),w=(0,d.default)(this.dynamicChangedNodesMap),M=w.length>0,this.syncNewCalculationResultToMainThread({mutationQueueIdRelatedSheetId:i,isFinalMutationToCurrentMutationQueueFromFormula:0===I.length&&!M,needToSyncFormulaNodeIdMap:E}),y.setFormulaPerformence(a,{syncRangeResultDuration:y.getFormulaPerformence(a).syncRangeResultDuration+(Date.now()-A)}),!I.length){t.next=36;break}return t.next=31,f.default.all(I);case 31:F=Date.now(),x=(0,d.default)(this.dynamicChangedNodesMap),M=x.length>0,this.syncNewCalculationResultToMainThread({mutationQueueIdRelatedSheetId:i,isFinalMutationToCurrentMutationQueueFromFormula:!M,needToSyncFormulaNodeIdMap:R}),y.setFormulaPerformence(a,{syncRangeResultDuration:y.getFormulaPerformence(a).syncRangeResultDuration+(Date.now()-F)});case 36:return M&&this.updateGraphFromNodes(w,{forceSync:!0}),O=Date.now(),k=O-r,y.updateGraphFromNodes({calculateDuration:k,graphUpdateTimes:a,isInitSheet:l,mutationSubscribeTime:c,isAfterMutationRun:o}),y.reportAllFormulaParserErrorInfo({isInitSheet:l}),y.reportAllFormulaErrorInfo({isInitSheet:l}),t.abrupt("return");case 43:case"end":return t.stop()}},t,this)}))}},{key:"updateNodeAndGetAffectedNodes",value:function(e){var t=e.id,r=e.row,n=e.col,a=e.newValue,o=e.sheetId,i=this.hasNode(t),s=a instanceof T.default;if(!s&&!i)return[];var u=!0,l=this.node(t);if(i&&!s&&this.isIsolatedNode(t))return u=!1,this.removeNode(t),(0,p.isFormulaNode)(l)&&this.clearNumberFormatsGeneratedByFormula(t,l),[];if(u)if(s){var d={row:r,col:n,id:t,sheetId:o,formulaModel:a};this.addNodeValueAndGenerateDependency(d)}else{this.setNode(t,void 0),this.clearInEdges(t);var c=this.externalMethods.getRealCellValue(r,n,o);this.plugin.utils.cellToConstantAndNotifyUpdate(c,o,r,n),(0,p.isFormulaNode)(l)&&this.clearNumberFormatsGeneratedByFormula(t,l)}return[t]}},{key:"updateGraphAfterNodesChange",value:function(e,t){var r=this,n={};if(e.forEach(function(e){r.updateNodeAndGetAffectedNodes(e).forEach(function(e){n[e]=!0})}),this.isSheetComputable(t)&&!this.externalMethods.isInRowColMove()){var a=(0,d.default)(n);return this.updateGraphFromNodes(a)}}},{key:"updateGraphAfterRowColAdd",value:function(e){var t=this,r=e.index,n=e.amount,a=e.isRow,i=e.sheetId,s=e.isFromVirtualCrossSheet,u=this.nodes(),l=[],c={},h={},f=[],m=a?p.isVirtualRowNodeId:p.isVirtualColNodeId,R={},g=[],v=u.reduce(function(e,o){if(m(o)){var u=(0,p.getInfoFromVirtualRowColId)(o),d=u.num,v=u.sheetId;if(v===i&&d>=r){var N=d+n,T=(0,p.getVirtualRowColIdFromInfo)({num:N,sheetId:v,isRow:a});e[o]=(0,p.getMigrationInfoByRowColMigrationInfo)({num:d,newNum:N,id:o,newId:T,isRow:a,sheetId:v})}return e}if((0,p.isVirtualRangeNodeId)(o)){var y=(0,p.getInfoFromVirtualRangeNodeId)(o),C=y.sheetId,E=y.rowsEnd,I=y.colsEnd,A=y.rowsStart,S=y.colsStart,w=a?A:S;if(C===i&&(a?E:I)>=r){var M=a&&A>=r?A+n:A,F=a&&E>=r?E+n:E,x=!a&&S>=r?S+n:S,O=!a&&I>=r?I+n:I,k=(0,p.getVirtualRangeNodeIdFromInfo)({sheetId:C,rowsStart:M,rowsEnd:F,colsStart:x,colsEnd:O});e[o]=(0,p.getMigrationInfoByRowColMigrationInfo)({num:-1,newNum:-1,id:o,newId:k,isRow:a,sheetId:C}),w<r&&(t.clearInEdges(o),g.push(k))}return e}if((0,p.isVirtualNodeId)(o))return e;var D=(0,p.getRowColFromGraphNodeId)(o),_=D.row,U=D.col,B=D.sheetId,L=t.node(o);if(B===i&&(a?_:U)>=r){if(s&&(0,p.isCrossSheetNode)(L))return f.push(o),e;if((0,p.isFormulaNode)(L)&&L.handleByPositionCenter)return h[o]=!0,e;var P=a?_+n:_,b=a?U:U+n,V=(0,p.getGraphNodeIdByRowCol)(P,b,B,{customType:(0,p.isFormulaNode)(L)?L.customType:""});e[o]={id:o,row:_,col:U,newRow:P,newCol:b,newId:V,sheetId:B,newSheetId:B}}if((0,p.isFormulaNode)(L)&&(t.doesFormulaNodeNeedToDealWithThisMutation(L,i)||s)){var G=L.formulaModel&&L.formulaModel.clone(),Y=G.updateAfterRowColAdd({sheetId:i,index:r,amount:n,isRow:a,row:_,col:U,nodeSheetId:B}),H=Y.isFormulaChanged,W=Y.isValueChanged,K=Y.isDependencyChanged,j=e[o]||{newRow:_,newCol:U,newSheetId:B,newId:o},z=j.newRow,$=j.newCol,Q=j.newSheetId,X=j.newId;if(H||e[o]){t.updateNodeValue(o,{formulaModel:G});var q={id:X,row:z,col:$,sheetId:Q,formulaModel:G,customType:L.customType,handleByPositionCenter:L.handleByPositionCenter};L.customType?(c[L.customType]=c[L.customType]||[],c[L.customType].push(q)):l.push(q)}K&&(t.updateNodeValue(o,{needGenerateDependency:!0}),h[X]=!0),W&&(t.updateNodeValue(o,{needRecalculate:!0}),R[X]=!0,t.externalMethods.isInRowColMove()&&t.nodesNeedToCalculateAfterRowColMove.push(L))}return e},{}),N=(0,o.default)(v).sort(function(e,t){return a?t.row-e.row:t.col-e.col});this.updateGraphWithBatchMoveAndRemoveUselessFormulaOnDataLayer({nodesNeedToMoveArray:N}),this.externalMethods.updateCellsFromFormula(l,{formulaOnly:!0}),this.notifyCustomTypesToUpdate(c,"customTypeFormulaModelChange",i),this.regenerateDependencyForRangeIds(g),this.regenerateDependencyForNodes((0,d.default)(h));var T=a?r:0,y=a?0:r;if(!this.externalMethods.getSheetBySheetId(i))throw new Error("graph \u64cd\u4f5c\u8fc7\u7a0b\u4e2d\uff0c\u8868\u683c "+i+" \u7a81\u7136\u4e0d\u89c1\u4e86\u3002");var C=this.externalMethods.countRows(i),E=this.externalMethods.countCols(i);this.plugin.cellMap.cleanAllAstNodes(i,T,C,y,E);var I=(0,d.default)(R);if((this.isSheetComputable(i)||s)&&!this.externalMethods.isInRowColMove())return this.updateGraphFromNodes(I)}},{key:"updateGraphAfterRowColDel",value:function(e){var t=this,r=e.index,n=e.amount,a=e.isRow,i=e.sheetId,s=e.isFromVirtualCrossSheet,u=this.nodes(),l=[],c={},h={},m=[],R=[],g=a?p.isVirtualRowNodeId:p.isVirtualColNodeId,v={},N=[],T=u.reduce(function(e,o){if(g(o)){var u=(0,p.getInfoFromVirtualRowColId)(o),d=u.num,f=u.sheetId;if(d<r||f!==i)return e;if(d>=r&&d<r+n)return m.push(o),e;if(d>=r+n){var T=d-n,y=(0,p.getVirtualRowColIdFromInfo)({num:T,isRow:a,sheetId:f});e[o]=(0,p.getMigrationInfoByRowColMigrationInfo)({num:d,newNum:T,id:o,newId:y,isRow:a,sheetId:f})}return e}if((0,p.isVirtualRangeNodeId)(o)){var C=(0,p.getInfoFromVirtualRangeNodeId)(o),E=C.sheetId,I=C.rowsEnd,A=C.colsEnd,S=C.rowsStart,w=C.colsStart;if(E!==i||(a?I:A)<r)return e;var M=r+n;if(E===i&&(a?S:w)>=M){var F=a&&S>=M?S-n:S,x=a&&I>=M?I-n:I,O=!a&&w>=M?w-n:w,k=!a&&A>=M?A-n:A,D=(0,p.getVirtualRangeNodeIdFromInfo)({sheetId:E,rowsStart:F,rowsEnd:x,colsStart:O,colsEnd:k});return e[o]=(0,p.getMigrationInfoByRowColMigrationInfo)({num:-1,newNum:-1,id:o,newId:D,isRow:a,sheetId:E}),e}return N.push(o),e}if((0,p.isVirtualNodeId)(o))return e;var _=(0,p.getRowColFromGraphNodeId)(o),U=_.row,B=_.col,L=_.sheetId,P=a?U:B,b=t.node(o);if(L===i&&P>=r&&P<r+n)return(0,p.isFormulaNode)(b)&&b.handleByPositionCenter?(h[o]=!0,e):(m.push(o),e);if(L===i&&P>=r+n){var V=a?U-n:U,G=a?B:B-n;if(s&&(0,p.isCrossSheetNode)(b))return R.push(o),e;if((0,p.isFormulaNode)(b)&&b.handleByPositionCenter)return h[o]=!0,e;var Y=(0,p.getGraphNodeIdByRowCol)(V,G,L,{customType:(0,p.isFormulaNode)(b)?b.customType:""});e[o]={id:o,row:U,col:B,newRow:V,newCol:G,newId:Y,sheetId:L,newSheetId:L}}if((0,p.isFormulaNode)(b)&&(t.doesFormulaNodeNeedToDealWithThisMutation(b,i)||s)){var H=b.formulaModel&&b.formulaModel.clone(),W=H.updateAfterRowColDel({sheetId:i,index:r,amount:n,isRow:a,row:U,col:B,nodeSheetId:L}),K=W.isFormulaChanged,j=W.isValueChanged,z=W.isDependencyChanged,$=e[o]||{newRow:U,newCol:B,newSheetId:L,newId:o},Q=$.newRow,X=$.newCol,q=$.newSheetId,Z=$.newId;if(K||e[o]){t.updateNodeValue(o,{formulaModel:H});var J={id:Z,row:Q,col:X,sheetId:q,formulaModel:H,customType:b.customType,handleByPositionCenter:b.handleByPositionCenter};b.customType?(c[b.customType]=c[b.customType]||[],c[b.customType].push(J)):l.push(J)}z&&(t.updateNodeValue(o,{needGenerateDependency:!0}),h[Z]=!0),j&&(t.updateNodeValue(o,{needRecalculate:!0}),v[Z]=!0)}return e},{}),y=(0,o.default)(T).sort(function(e,t){return a?e.row-t.row:e.col-t.col});s&&this.deleteCrossSheetNodesAndMarkDependencyChangeNodes(R,{nodesNeedToMoveMap:T,needNewDependencyNodesMap:h}),this.deleteAffectedVirtualRangeNodesAndMarkDependencyChangeNodes(N,{nodesNeedToMoveMap:T,needNewDependencyNodesMap:h}),m.forEach(function(e){return t.removeNode(e)}),this.updateGraphWithBatchMoveAndRemoveUselessFormulaOnDataLayer({nodesNeedToMoveArray:y}),this.externalMethods.updateCellsFromFormula(l,{formulaOnly:!0}),this.notifyCustomTypesToUpdate(c,"customTypeFormulaModelChange",i),this.regenerateDependencyForNodes((0,d.default)(h));var C=this.plugin.cellMap,E=a?r:0,I=a?0:r;if(!this.externalMethods.getSheetBySheetId(i))throw new Error("graph \u64cd\u4f5c\u8fc7\u7a0b\u4e2d\uff0c\u8868\u683c "+i+" \u7a81\u7136\u4e0d\u89c1\u4e86\u3002");var A=this.externalMethods.countRows(i),S=this.externalMethods.countCols(i);C.cleanAllAstNodes(i,E,A,I,S);var w=(0,d.default)(v);return this.isSheetComputable(i)||s?(this.externalMethods.isInRowColMove()&&(w=this.extendAffectedNodesAfterRowColMove(w)),this.updateGraphFromNodes(w)):f.default.resolve()}},{key:"updateGraphAfterRowColCutMove",value:function(e){var t=this,r=e.migrationMap,n=e.sourceSheetId,a=e.isRow,i=e.isFromVirtualCrossSheet,s=e.upperBoundOfAffectedArea,u=e.lowerBoundOfAffectedArea,l=this.nodes(),c=[],h={},f={},m=[],R=a?p.isVirtualRowNodeId:p.isVirtualColNodeId,g={},v=[],N=l.reduce(function(e,o){if(R(o)){var l=(0,p.getInfoFromVirtualRowColId)(o),d=l.num,N=l.sheetId;if(N!==n||!r[d])return e;var T=r[d].num,y=(0,p.getVirtualRowColIdFromInfo)({num:T,sheetId:N,isRow:a});e[o]=(0,p.getMigrationInfoByRowColMigrationInfo)({num:d,newNum:T,id:o,newId:y,isRow:a,sheetId:N})}if((0,p.isVirtualRangeNodeId)(o)){var C=(0,p.getInfoFromVirtualRangeNodeId)(o),E=C.sheetId,I=C.rowsEnd,A=C.colsEnd,S=C.rowsStart,w=C.colsStart;return E===n&&!((a?S:w)>s||(a?I:A)<u)&&v.push(o),e}if((0,p.isVirtualNodeId)(o))return e;var M=(0,p.getRowColFromGraphNodeId)(o),F=M.row,x=M.col,O=M.sheetId,k=t.node(o);if(O===n){var D=a?F:x;if(r[D]){if(i&&(0,p.isCrossSheetNode)(k))return m.push(o),e;if((0,p.isFormulaNode)(k)&&k.handleByPositionCenter)return f[o]=!0,e;var _=r[D],U=_.num,B=_.destinationSheetId,L=a?U:F,P=a?x:U,b=(0,p.getGraphNodeIdByRowCol)(L,P,B,{customType:(0,p.isFormulaNode)(k)?k.customType:""});e[o]={id:o,row:F,col:x,newRow:L,newCol:P,newId:b,sheetId:O,newSheetId:B}}}if((0,p.isFormulaNode)(k)&&(t.doesFormulaNodeNeedToDealWithThisMutation(k,n)||i)){var V=k.formulaModel&&k.formulaModel.clone(),G=V.updateAfterRowColCutMove({migrationMap:r,isRow:a,row:F,col:x,nodeSheetId:O,sourceSheetId:n,upperBoundOfAffectedArea:s,lowerBoundOfAffectedArea:u}),Y=G.isFormulaChanged,H=G.isValueChanged,W=G.isDependencyChanged,K=e[o]||{newRow:F,newCol:x,newSheetId:O,newId:o},j=K.newRow,z=K.newCol,$=K.newSheetId,Q=K.newId;if(Y){t.updateNodeValue(o,{formulaModel:V});var X={id:Q,row:j,col:z,sheetId:$,formulaModel:V,customType:k.customType,handleByPositionCenter:k.handleByPositionCenter};k.customType?(h[k.customType]=h[k.customType]||[],h[k.customType].push(X)):c.push(X)}W&&(t.updateNodeValue(o,{needGenerateDependency:!0}),f[Q]=!0),H&&(t.updateNodeValue(o,{needRecalculate:!0}),g[Q]=!0,t.externalMethods.isInRowColMove()&&t.nodesNeedToCalculateAfterRowColMove.push(k))}return e},{}),T=(0,o.default)(N);i&&this.deleteCrossSheetNodesAndMarkDependencyChangeNodes(m,{nodesNeedToMoveMap:N,needNewDependencyNodesMap:f}),this.deleteAffectedVirtualRangeNodesAndMarkDependencyChangeNodes(v,{nodesNeedToMoveMap:N,needNewDependencyNodesMap:f}),this.updateGraphWithBatchMoveAndRemoveUselessFormulaOnDataLayer({nodesNeedToMoveArray:T}),this.externalMethods.updateCellsFromFormula(c,{formulaOnly:!0}),this.notifyCustomTypesToUpdate(h,"customTypeFormulaModelChange",n),this.regenerateDependencyForNodes((0,d.default)(f));var y=this.plugin.cellMap,C=a?s:0,E=a?0:s,I=a?u:0,A=a?0:u;if(!this.externalMethods.getSheetBySheetId(n))throw new Error("graph \u64cd\u4f5c\u8fc7\u7a0b\u4e2d\uff0c\u8868\u683c "+n+" \u7a81\u7136\u4e0d\u89c1\u4e86\u3002");y.cleanAllAstNodes(n,C,I,E,A);var S=(0,d.default)(g);if((this.isSheetComputable(n)||i)&&!this.externalMethods.isInRowColMove())return this.updateGraphFromNodes(S)}},{key:"updateGraphAfterRowReorder",value:function(e){var t=this,r=e.migrationMap,n=e.sourceSheetId,a=e.endColIndex,o=e.startColIndex,s=e.minRow,u=e.maxRow,c=this.nodes(),h={},m={},R=[],g={},v=c.reduce(function(e,i){if((0,p.isVirtualNodeId)(i)&&!(0,p.isVirtualRowNodeId)(i))return e;var s=(0,p.getRowColFromGraphNodeId)(i),u=s.row,l=s.col,d=s.sheetId;if(d!==n)return e;if(!r[u]||(l<o||l>a)&&-1!==l)return e;var c=r[u],f=c.num,v=c.destinationSheetId,N=t.node(i),T=(0,p.isFormulaNode)(N)&&N;if(T&&T.handleByPositionCenter)return h[i]=!0,e;var y=(0,p.getGraphNodeIdByRowCol)(f,l,d,{customType:T?T.customType:""}),C=void 0;if(T){var E=(C=T.formulaModel).clone();if(E.updateAfterRowReoder({row:u,newRow:f}).isFormulaChanged){C=E;var I={id:y,row:f,col:l,sheetId:v,formulaModel:E,customType:T.customType,handleByPositionCenter:T.handleByPositionCenter},A=T.customType;A?(g[A]=g[A]||[],g[A].push(I)):R.push(I)}}var S={id:i,row:u,col:l,newRow:f,newCol:l,newId:y,sheetId:d,newSheetId:v,newFormulaModel:C};return t.getAllSuccessors(i).forEach(function(e){if((0,p.isVirtualRangeNodeId)(e))return t.getAllSuccessors(e).forEach(function(e){var i=(0,p.getRowColFromGraphNodeId)(e),s=i.row,u=i.col;i.sheetId===n&&r[s]&&(u>=o&&u<=a||-1===u)||(h[e]=!0,(0,p.isFormulaNode)(l)&&t.updateNodeValue(e,{needGenerateDependency:!0}))}),void t.removeNode(e);var i=(0,p.getRowColFromGraphNodeId)(e),s=i.row,u=i.col;if(i.sheetId!==n||!r[s]||!(u>=o&&u<=a||-1===u)){h[e]=!0;var l=t.node(e);(0,p.isFormulaNode)(l)&&t.updateNodeValue(e,{needGenerateDependency:!0})}}),T&&(m[i]=T,h[y]=!0),t.removeNode(i),e[i]=S,e},{});this.externalMethods.updateCellsFromFormula(R,{formulaOnly:!0}),this.notifyCustomTypesToUpdate(g,"customTypeFormulaModelChange",n);var N=!0,T=!1,y=void 0;try{for(var C,E=(0,i.default)((0,d.default)(v));!(N=(C=E.next()).done);N=!0){var I=C.value,A=v[I];if(A.newFormulaModel){var S=A.newFormulaModel,w=A.newRow,M=A.newCol,F=A.newSheetId,x=A.newId,O=m[I]||{},k=(0,l.default)(O,{formulaModel:S,row:w,col:M,sheetId:F,id:x,needGenerateDependency:!0});this.setNode(x,k)}}}catch(U){T=!0,y=U}finally{try{!N&&E.return&&E.return()}finally{if(T)throw y}}var D=this.plugin.cellMap;if(!this.externalMethods.getSheetBySheetId(n))throw new Error("graph \u64cd\u4f5c\u8fc7\u7a0b\u4e2d\uff0c\u8868\u683c "+n+" \u7a81\u7136\u4e0d\u89c1\u4e86\u3002");D.cleanAllAstNodes(n,s,u,o,a),this.regenerateDependencyForNodes((0,d.default)(h));var _=(0,d.default)(h);return this.isSheetComputable(n)?this.updateGraphFromNodes(_):f.default.resolve()}},{key:"updateGraphAfterShowHideDimension",value:function(e){var t=this,r=e.ranges,n=e.sheetId;if(this.isSheetComputable(n)){var a=this.nodes(),o=/(SUBTOTAL)/i,i=r[0],s=i.dimension===A.default.ROWS,u=a.reduce(function(e,r){var n=t.node(r);if(!(0,p.isFormulaNode)(n))return e;if(n.formulaModel.getParts().some(function(e){return"string"===typeof e&&!!e.match(o)})){var a=t.plugin.cellMap.getCell(n.sheetId,n.row,n.col);a?(0,R.walk)(a,function(n,a,u){var l=u.walkContext;if((0,R.isFunctionNode)(n)&&o.test(n.funcName))return{walkContext:l={nearestSubtotalNode:n}};if((0,R.isCellRangeNode)(n)||(0,R.isCellNode)(n)){if(!l.nearestSubtotalNode)return{stopSearchingDown:!0};if((0,R.isCellNode)(n)){var d=n.row,c=n.col;if(n.sheetId!==i.sheetId)return{stopSearchingDown:!0};var h=s?d:c;if(h<i.startIndex||h>i.endIndex)return{stopSearchingDown:!0}}else{var f=n.startSheetId;n.endSheetId!==n.startSheetId&&(f+=":"+n.endSheetId);var m=n.scope,p=m.row,g=void 0!==m.rowCount?m.row+m.rowCount-1:t.externalMethods.countRows(n.startSheetId)-1,v=m.col,N=void 0!==m.colCount?m.col+m.colCount-1:t.externalMethods.countCols(n.startSheetId)-1;if(f!==i.sheetId)return{stopSearchingDown:!0};var T=s?g:N;if((s?p:v)>i.endIndex||T<i.startIndex)return{stopSearchingDown:!0}}return e[r]||(t.updateNodeValue(r,{needRecalculate:!0}),e[r]=!0),{stopSearchingDown:!0,stopParallelTraversal:!0}}}):(t.updateNodeValue(r,{needRecalculate:!0}),e[r]=!0)}return e},{}),l=(0,d.default)(u);return this.updateGraphFromNodes(l)}}},{key:"updateGraphAfterFilterDimension",value:function(e){var t=this;if(this.isSheetComputable(e)){var r=this.nodes(),n=/(SUBTOTAL)/i,a=r.reduce(function(e,r){var a=t.node(r);return(0,p.isFormulaNode)(a)?(a.formulaModel.getParts().some(function(e){return"string"===typeof e&&!!e.match(n)})&&(t.updateNodeValue(r,{needRecalculate:!0}),e[r]=!0),e):e},{}),o=(0,d.default)(a);this.updateGraphFromNodes(o)}}},{key:"updateGraphAfterCrossSheetNodesChangeAndGetAbandonedCrossSheetNodes",value:function(e){var t=this,r={},n=[];e.forEach(function(e){var a=e.row,o=e.col,i=e.sheetId,s=e.effectiveValue,u=e.numberFormat,l=e.editValue,d=(0,p.getGraphNodeIdByRowCol)(a,o,i),c=t.node(d);if((0,p.isCrossSheetNode)(c)){var h=s?(0,I.deserialize)(s,E.default):null,f=u?(0,I.deserialize)(u,g.default):null;t.setNode(d,{row:a,col:o,sheetId:i,effectiveValue:h,renderNumberFormat:f,editValue:l,type:"CrossSheetNode"}),t.getAllSuccessors(d).forEach(function(e){r[e]=!0}),t.plugin.utils.cellToConstantAndNotifyUpdate(h?h.value:null,i,a,o)}else n.push({row:a,col:o,sheetId:i})});var a=(0,d.default)(r);return this.updateGraphFromNodes(a).then(function(){return n})}},{key:"updateGraphAfterSheetDeleted",value:function(e){var t=this,r=e.sheetId,n=e.originSheetIndex,a=[],o={},i={};return this.nodes().forEach(function(e){if((0,p.getRowColFromGraphNodeId)(e).sheetId!==r){var s=t.node(e);if((0,p.isFormulaNode)(s)){var u=s.formulaModel,l=u.updateAfterSheetDeleted({sheetId:r,originSheetIndex:n}),d=l.isFormulaChanged,c=l.isValueChanged;if(d){t.updateNodeValue(e,{formulaModel:u});var h=t.node(e);if((0,p.isFormulaNode)(h)){var f=h.customType;f?(o[f]=o[f]||[],o[f].push(h)):a.push(h)}}c&&(t.updateNodeValue(e,{needRecalculate:!0}),i[e]=!0)}}else t.removeNode(e)}),this.externalMethods.updateCellsFromFormula(a,{formulaOnly:!0}),this.notifyCustomTypesToUpdate(o,"customTypeFormulaModelChange",r),this.isSheetComputable(r)?this.updateGraphFromNodes((0,d.default)(i)):f.default.resolve()}},{key:"updateGraphgAfterSheetRenamed",value:function(e){var t=this,r=[],n={};this.nodes().forEach(function(a){var o=t.node(a);if((0,p.isFormulaNode)(o)){var i=o.formulaModel;if(i.updateAfterSheetRenamed(e).isFormulaChanged){t.updateNodeValue(a,{formulaModel:i});var s=t.node(a);if((0,p.isFormulaNode)(s)){var u=s.customType;u?(n[u]=n[u]||[],n[u].push(s)):r.push(s)}}}}),this.externalMethods.updateCellsFromFormula(r,{formulaOnly:!0}),this.notifyCustomTypesToUpdate(n,"customTypeFormulaModelChange",e.sheetId)}},{key:"updateGraphAfterSheetInserted",value:function(e){var t=this,r={},n=[];return this.nodes().forEach(function(a){var o=t.node(a);if((0,p.isFormulaNode)(o)){var i=o.formulaModel.updateAfterSheetInserted(e),s=i.isValueChanged,u=i.isDependencyChanged;s&&(t.updateNodeValue(a,{needRecalculate:!0}),r[a]=!0),u&&(t.updateNodeValue(a,{needGenerateDependency:!0}),n.push(a))}}),this.regenerateDependencyForNodes(n),this.isSheetComputable(e.sheetId)?this.updateGraphFromNodes((0,d.default)(r)):f.default.resolve()}},{key:"addNodeValueDependency",value:function(e,t){var r=this.hasNode(t);return this.setEdge(t,e.id),r||this.addLinkBetweenNodeAndVirtualRowCol(t),e}},{key:"addNodePositionDependency",value:function(e,t){var r=this.graph,n=this.hasNode(t),a=(0,p.getPositionNodeName)(t);return r.hasNode(a)||(r.setNode(a),r.setParent(a,t)),n||this.addLinkBetweenNodeAndVirtualRowCol(t),this.addNodeValueDependency(e,a)}},{key:"addLinkBetweenNodeAndVirtualRowCol",value:function(e){var t=this;if(!(0,p.isVirtualNodeId)(e)){var r=(0,p.getRowColFromGraphNodeId)(e),n=r.row,a=r.col,o=r.sheetId;[(0,p.getVirtualRowColIdFromInfo)({num:n,isRow:!0,sheetId:o}),(0,p.getVirtualRowColIdFromInfo)({num:a,isRow:!1,sheetId:o})].forEach(function(r){t.hasNode(r)&&t.setEdge(e,r)})}}},{key:"addRowsColsDependency",value:function(e){for(var t=this,r=e.element,n=e.startIndex,a=e.endIndex,o=e.isRow,i=e.sheetId,s=e.isPositionRely,u={},l=!1,d=n;d<=a;d++){var c=(0,p.getVirtualRowColIdFromInfo)({num:d,sheetId:i,isRow:o});this.hasNode(c)||(u[i]=u[i]||{},u[i][d]=c,this.setNode(c,void 0),l=!0),s?this.addNodePositionDependency(r,c):this.addNodeValueDependency(r,c)}return!!l&&(this.nodes().forEach(function(e){if(!(0,p.isVirtualNodeId)(e)){var r=(0,p.getRowColFromGraphNodeId)(e),n=r.row,a=r.col,s=r.sheetId;if(s===i){var l=o?n:a;u[s]&&u[s][l]&&t.setEdge(e,u[i][l])}}}),!0)}},{key:"calculateFormulaAsync",value:function(e){var t=e.idBeforeCalculation,r=e.graphUpdateTimes,n=e.mutationQueueIdRelatedSheetId,a=e.isInCycle,o=e.asyncNodesMap,i=e.forceSync;return k(this,void 0,void 0,s.default.mark(function e(){var u,l,d,c,h,m,R,g,v,N,T,y,C,E,I,A,S,w=this;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(u=this.node(t),(0,p.isFormulaNode)(u)){e.next=4;break}return((0,p.isVirtualColNodeId)(t)||(0,p.isVirtualRowNodeId)(t)||(0,p.isVirtualRangeNodeId)(t))&&(l=this.predecessors(t),d=l.map(function(e){return w.cellCalculationPromiseMap[e]}),c=f.default.all(d),this.setNodeCalculationPromise(t,c)),e.abrupt("return");case 4:return this.updateNodeValue(t,{graphUpdateTimes:r}),h=function(){},m=new f.default(function(e){h=e}),R=this.predecessors(t),g=R.map(function(e){return w.cellCalculationPromiseMap[e]}),this.setNodeCalculationPromise(t,m),e.next=12,f.default.all(g);case 12:if(v=u.id,!(N=this.isThisCalculationObsolete(v,r))){e.next=19;break}return(T=new Error("\u5728\u4f9d\u8d56\u8ba1\u7b97\u7684\u7b49\u5f85\u540e\u653e\u5f03\uff0c\u56e0\u4e3a\uff1a"+N)).name="NOT_LATEST_CALCULATION",h(T),e.abrupt("return");case 19:if(y=this.node(v),(0,p.isFormulaNode)(y)){e.next=22;break}throw new Error(v+" \u5bf9\u5e94\u7684\u8282\u70b9\u5c45\u7136\u4e0d\u662f\u51fd\u6570\u8282\u70b9\uff01\uff01\u5230\u8fd9\u91cc\u7684\u8bdd\u65e0\u8bba\u5982\u4f55\u90fd\u8981\u662f\u51fd\u6570\u8282\u70b9\u4e86\uff0c\u5982\u679c\u8fd8\u4e0d\u662f\uff0c\u90a3\u7edd\u5bf9\u662f\u7f16\u7801\u51fa\u9519\u4e86");case 22:return C=y.row,E=y.col,I=y.id,A=y.formulaModel,S=y.sheetId,e.next=25,this.calculateSingleCellFormula({row:C,col:E,id:I,sheetId:S,formulaModel:A,graphUpdateTimes:r,mutationQueueIdRelatedSheetId:n,isInCycle:a,customType:u.customType,syncFormulaNodeIdMap:o,forceSync:i});case 25:return h(),e.abrupt("return");case 27:case"end":return e.stop()}},e,this)}))}},{key:"calculateFormulaSync",value:function(e){var t=e.idBeforeCalculation,r=e.graphUpdateTimes,n=e.mutationQueueIdRelatedSheetId,a=e.isInCycle,o=e.syncFormulaNodeIdMap,i=e.forceSync,s=this.node(t);if((0,p.isFormulaNode)(s)){var u=s.row,l=s.col,d=s.id,c=s.formulaModel,h=s.sheetId;o[d]=!0,this.calculateSingleCellFormulaSync({row:u,col:l,id:d,sheetId:h,formulaModel:c,graphUpdateTimes:r,mutationQueueIdRelatedSheetId:n,isInCycle:a,customType:s.customType,syncFormulaNodeIdMap:o,forceSync:i})}}},{key:"calculateAsyncNodes",value:function(e){var t=e.ast,r=e.graphUpdateTimes;return k(this,void 0,void 0,s.default.mark(function e(){var n,a,o,u,l,d,c,h;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=this.plugin.cellMap.getAsyncFunctionNodeList(),t.setAsyncFunctionNodeList(n),this.plugin.cellMap.cleanAsyncFunctionNodeList(),a=t.getAsyncFunctionNodeList(),y.setFormulaPerformence(r,{asyncFormulaCount:y.getFormulaPerformence(r).asyncFormulaCount+a.length}),o=!0,u=!1,l=void 0,e.prev=8,d=(0,i.default)(a);case 10:if(o=(c=d.next()).done){e.next=17;break}return h=c.value,e.next=14,h.asyncCalculate();case 14:o=!0,e.next=10;break;case 17:e.next=23;break;case 19:e.prev=19,e.t0=e.catch(8),u=!0,l=e.t0;case 23:e.prev=23,e.prev=24,!o&&d.return&&d.return();case 26:if(e.prev=26,!u){e.next=29;break}throw l;case 29:return e.finish(26);case 30:return e.finish(23);case 31:case"end":return e.stop()}},e,this,[[8,19,23,31],[24,,26,30]])}))}},{key:"children",value:function(e){return this.graph.children(e)||[]}},{key:"clearNumberFormatsGeneratedByFormula",value:function(e,t){if(t){var r=t.row,n=t.col,a=t.sheetId;if(!t.customType&&(0,p.hasTextInheritFunction)(t.formulaModel.toString(r,n))){var o={userEnteredNumberFormat:new g.default(p.DEFAULT_NUMBER_FORMAT_INFO),gridRange:new N.default(a,r,r,n,n)};this.externalMethods.updateSingleCellFromFormula(o)}}}},{key:"clearInEdges",value:function(e){var t=this;this.inEdges(e).forEach(function(e){var r=e.v,n=e.w;return t.removeEdge(r,n)})}},{key:"deleteCrossSheetNodesAndMarkDependencyChangeNodes",value:function(e,t){var r=this,n=t.nodesNeedToMoveMap,a=t.needNewDependencyNodesMap;e.forEach(function(e){r.successors(e).forEach(function(e){r.updateNodeValue(e,{needGenerateDependency:!0});var t=n[e]?n[e].newId:e;a[t]=!0});var t=r.parent(e);t&&r.removeNode(t),r.removeNode(e)})}},{key:"deleteAffectedVirtualRangeNodesAndMarkDependencyChangeNodes",value:function(e,t){var r=this,n=t.nodesNeedToMoveMap,a=t.needNewDependencyNodesMap;e.forEach(function(e){r.successors(e).forEach(function(e){r.updateNodeValue(e,{needGenerateDependency:!0});var t=n[e]?n[e].newId:e;a[t]=!0}),r.removeNode(e)})}},{key:"doesFormulaNodeNeedToDealWithThisMutation",value:function(e,t){return e.sheetId===t||!!this.externalMethods.sheetFormulaLayerStatusMap.isSheetInitialized(t)}},{key:"getAllAffectedNodesListFromNodes",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={},a={},o={},s=this.graph;if(!e||!e.length)return{affectedNodesMap:a,asyncNodesMap:n,affectedSinks:o};for(var u=[].concat(e),l=function(e){var i=u[e];if(a[i])return"continue";var l=t.node(i),d=l&&(0,p.isFormulaNode)(l)&&l.hasAsyncFormula||n[i];d&&(n[i]=!0),a[i]=!0;var c=s.successors(i);if(c&&0!==c.length){var h=!0;c.forEach(function(e){r[e]||(h=!1),d&&(n[e]=!0),a[e]||u.push(e)}),h&&(o[i]=!0)}else o[i]=!0},c=0;c<u.length;c++)l(c);var h=!0,f=!1,m=void 0;try{for(var R,g=(0,i.default)((0,d.default)(r));!(h=(R=g.next()).done);h=!0){var v=R.value;delete a[v],delete n[v],delete o[v]}}catch(N){f=!0,m=N}finally{try{!h&&g.return&&g.return()}finally{if(f)throw m}}return{affectedNodesMap:a,asyncNodesMap:n,affectedSinks:o}}},{key:"getNodesInCycleMap",value:function(e){var t={},r=this.graph;return this.tarjan(e).forEach(function(e){if(e.length>1)e.forEach(function(e){t[e]=!0});else if(1===e.length){var n=e[0];!t[n]&&r.hasEdge(n,n)&&(t[n]=!0)}}),t}},{key:"getNodesDistributionInfoBySheetId",value:function(e){var t=this;if(this.externalMethods.getSheetBySheetId(e)){var r=this.externalMethods.countRows(e),n=this.externalMethods.countCols(e),o=0,i=0,s=0,u=0,d=0,c=0,h=0,f=0,m=0,R=this.nodes(),g=this.graph.edges();R.forEach(function(a){if(-1!==a.indexOf(e))if((0,p.isVirtualColNodeId)(a)||(0,p.isVirtualRowNodeId)(a)){d++;var l=t.successors(a),R=t.predecessors(a);c+=l.length;var g=(0,p.isVirtualColNodeId)(a)?n:r;h+=g*l.length-R.length-1}else{if((0,p.isVirtualRangeNodeId)(a)){i++;var v=t.predecessors(a),N=t.successors(a);return s+=N.length,void(u+=(N.length-1)*v.length-1)}if(!(0,p.isVirtualPositionNodeId)(a)){var T=t.node(a);return(0,p.isFormulaNode)(T)?(o++,void("dv"===T.customType&&m++)):void 0}f++}});var v={sheetId:e,formulaNodesCount:o,rangeNodesCount:i,rangeNodesReferencedTimes:s,edgesCountSavedByRangeNodes:u,rowColNodesCount:d,rowColNodesReferencedTimes:c,edgesCountSavedByRowColNodes:h,positionNodesCount:f,nodesCount:R.length,edgesCount:g.length,dvNodesCount:m,keyframeCalculationConsistentNumber:this.keyframeCalculationConsistentNumbersMap[e]||0};(0,l.default)(v,window.formulaReportInfo),window.nodes_distribution_info=v,o>0&&D.reportProxy.tdwReport({opername:"excel_performance",module:"formula_worker",action:"nodes_distribution_info",ver5:(0,a.default)(v)})}}},{key:"getAllSuccessors",value:function(e){var t=this,r=this.successors(e),n=this.children(e).reduce(function(e,r){return e.concat(t.successors(r))},[]);return r.concat(n)}},{key:"getAllErrorValueBySheetId",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.externalMethods.getActiveSheetId(),r=[];return this.nodes().forEach(function(n){if(0===n.indexOf(t)){var a=e.node(n);if((0,p.isFormulaNode)(a)){var o=a.row,i=a.col,s=a.sheetId,u=e.externalMethods.getCellData(o,i,s);if(u){var d=u.getEffectiveValue();if(d){var c=d.value;if(c instanceof v.default)return void r.push((0,l.default)({},a,{value:c.displayText||void 0}))}}}}}),r.sort(function(e,t){return e.row===t.row?e.col-t.col:e.row-t.row}),r}},{key:"getTopsortResultAndNodesInCylce",value:function(e,t){var r=(0,d.default)(t);try{return{idsSortArray:this.topsort(e,r),nodesInCycle:[]}}catch(s){}var n=this.getNodesInCycleMap(e),a=this.getAllAffectedNodesListFromNodes((0,d.default)(e),n),o=a.affectedNodesMap,i=a.affectedSinks;return{idsSortArray:this.topsort(o,(0,d.default)(i)),nodesInCycle:(0,d.default)(n)}}},{key:"getInheritFormat",value:function(e){var t=e.formula,r=e.ast,n=void 0;if((0,p.hasTextInheritFunction)(t))return{userEnteredNumberFormat:n=new g.default({pattern:"@"})};if(n)return{userEnteredNumberFormat:n};if(/(today|now|date)\([^\)]*\)/i.test(t)&&!t.replace(/\s/g,"").replace(/(today|now|date)\([^\)]*\)/i,"").replace(/\+|-/g,"").replace(/\d+(\.\d+)?([Ee][+-]?\d+)?/g,"")){var a=t.toLowerCase();return{effectiveFormatNumberFormat:new g.default({pattern:a.indexOf("today")>-1||a.indexOf("date")>-1?"yyyy/m/d":"yyyy/m/d h:mm:ss;@"})}}var o=this.getInheritanceFormatByAST(r);return{effectiveFormatNumberFormat:o||new g.default(p.DEFAULT_NUMBER_FORMAT_INFO)}}},{key:"isCurrentCellDataConsistentWithNewData",value:function(e){var t=e.row,r=e.col,n=e.sheetId,a=e.effectiveValue,o=e.userEnteredNumberFormat,i=e.effectiveFormatNumberFormat;if(this.isPreview)return!1;var s=!this.isPreview,u=this.externalMethods.getCellData(t,r,n);if(!this.isPreview&&u){if(a){var l=u.getEffectiveValue();s=!!l&&a.equals(l)}if(s){if(o){var d=u.getUserEnteredFormat();if(d){var c=d.getNumberFormat();s=!!c&&o.equals(c)}else s=!1}if(s&&i){var h=u.getEffectiveFormat();if(h){var f=h.getNumberFormat();s=!!f&&f.equals(i)}else s=!1}}}return s}},{key:"isIsolatedNode",value:function(e){var t=this;if("string"!==typeof e)return!0;if(!this.hasNode(e))return!0;var r=this.predecessors(e),n=this.successors(e),a=this.children(e).reduce(function(e,r){return e?0===t.successors(r).length:e},!0);return 0===r.length&&0===n.length&&a}},{key:"isSheetLoadedByDataLayer",value:function(e){var t=this.externalMethods.getSheetBySheetId(e);return!!t&&t.isLoaded}},{key:"isThisCalculationObsolete",value:function(e,t){var r=this.node(e);return(0,p.isFormulaNode)(r)?r.graphUpdateTimes&&r.graphUpdateTimes>t?"\u8be5\u6b21\u8ba1\u7b97\u4e0d\u662f\u8282\u70b9"+e+"\u7684\u6700\u65b0\u66f4\u65b0\uff0c\u8be5\u8282\u70b9\u5df2\u7ecf"+(r?"\u66f4\u65b0\u5230"+r.graphUpdateTimes:"\u88ab\u79fb\u9664")+"\uff0c\u800c\u8be5\u6b21\u66f4\u65b0\u4e3a"+t+"\u3002":void 0:"\u8282\u70b9"+e+"\u5df2\u7ecf\u88ab\u79fb\u9664\u4e86"}},{key:"isEdgeGenerateable",value:function(){return!1}},{key:"inEdges",value:function(e){return this.graph.inEdges(e)||[]}},{key:"node",value:function(e){return this.graph.node(e)}},{key:"nodes",value:function(){return this.graph.nodes()||[]}},{key:"notifyCustomTypesToUpdate",value:function(e,t,r){var n=!0,a=!1,o=void 0;try{for(var s,u=(0,i.default)((0,d.default)(e));!(n=(s=u.next()).done);n=!0){var l=s.value,c=e[l];C.default.event.formula.trigger(t,{customType:l,datas:c,options:{mutationQueueIdRelatedSheetId:r}})}}catch(h){a=!0,o=h}finally{try{!n&&u.return&&u.return()}finally{if(a)throw o}}}},{key:"outEdges",value:function(e){return this.graph.outEdges(e)||[]}},{key:"parent",value:function(e){return this.graph.parent(e)}},{key:"predecessors",value:function(e){return this.graph.predecessors(e)||[]}},{key:"regenerateDependencyForNodes",value:function(e){var t=this;e.forEach(function(e){var r=t.node(e);(0,p.isFormulaNode)(r)&&(t.addNodeValueAndGenerateDependency(r),t.updateNodeValue(e,{needGenerateDependency:void 0}))})}},{key:"regenerateDependencyForRangeIds",value:function(e){var t=this;0!==e.length&&e.forEach(function(e){if((0,p.isVirtualRangeNodeId)(e))for(var r=(0,p.getInfoFromVirtualRangeNodeId)(e),n=r.rowsStart,a=r.rowsEnd,o=r.colsStart,i=r.colsEnd,s=r.sheetId,u=n;u<=a;u++)for(var l=o;l<=i;l++){var d=(0,p.getGraphNodeIdByRowCol)(u,l,s);t.setEdge(d,e)}})}},{key:"regenerateDependencyForRowColIds",value:function(e){var t=this;if(0!==e.length){var r={},n={};e.forEach(function(e){var t=(0,p.isVirtualColNodeId)(e)?n:(0,p.isVirtualRowNodeId)(e)?r:void 0;if("undefined"!==typeof t){var a=(0,p.getInfoFromVirtualRowColId)(e),o=(a.isRow,a.num),i=a.sheetId;t[i]=t[i]||{},t[i][o]=e}}),this.nodes().forEach(function(e){if(!(0,p.isVirtualNodeId)(e)){var a=(0,p.getRowColFromGraphNodeId)(e),o=a.row,i=a.col,s=a.sheetId;r[s]&&r[s][o]?t.setEdge(e,r[s][o]):n[s]&&n[s][i]&&t.setEdge(e,n[s][i])}})}}},{key:"removeEdge",value:function(e,t){var r=this.graph;if(r.hasEdge(e,t))return r.removeEdge(e,t)}},{key:"removeNode",value:function(e){var t=this.graph;if(t.hasNode(e)){this.children(e).forEach(function(e){return t.removeNode(e)});var r=this.node(e);if(t.removeNode(e),delete this.alwaysNeedToUpdateNodesMap[e],delete this.scheduleUpdateNodesMap[e],(0,p.isVirtualCrossSheetReferenceId)(e))delete this.virtualCrossSheetReferenceMap[e];else if((0,p.isFormulaNode)(r))this.plugin.cellMap.deleteCell(r.sheetId,r.row,r.col);else if(!(0,p.isVirtualNodeId)(e)){var n=(0,p.getRowColFromGraphNodeId)(e),a=n.sheetId,o=n.row,i=n.col;this.plugin.cellMap.deleteCell(a,o,i)}}}},{key:"runPostProcessingOfCalculation",value:function(e){var t=e.newValue,r=e.row,n=e.col,a=e.id,o=e.sheetId,i=e.formulaModel,s=e.formula,u=e.userEnteredNumberFormat,d=e.graphUpdateTimes,c=e.mutationQueueIdRelatedSheetId,h=e.effectiveFormatNumberFormat,f=e.syncFormulaNodeIdMap,m=e.ast,R=e.customType,g=e.forceSync;this.runPostProcessingOfCalculationOnCellMap({ast:m,newValue:t,sheetId:o,customType:R,row:r,col:n});var v=Date.now(),T=(0,p.getLegalValueResultInfo)(t.result);(0,l.default)(t,T);var C={value:t.result,oriValue:t.oriValue,error:t.error,row:r,col:n,id:a,sheetId:o,formulaModel:i,userEnteredNumberFormat:u,effectiveFormatNumberFormat:h};C.error&&y.addFormulaError(C.error,s),this.updateNodeValue(a,C),y.setFormulaPerformence(d,{formatDuration:y.getFormulaPerformence(d).formatDuration+(Date.now()-v)});var E=new N.default(o,r,r,n,n),I=(0,p.getExtendedValueByFormulaNode)(C);if(!g&&!R&&this.isCurrentCellDataConsistentWithNewData({row:r,col:n,sheetId:o,effectiveFormatNumberFormat:h,userEnteredNumberFormat:u,effectiveValue:I})){this.keyframeCalculationConsistentNumbersMap[o]=this.keyframeCalculationConsistentNumbersMap[o]||0,this.keyframeCalculationConsistentNumbersMap[o]++,delete f[a];var A=Date.now();y.setFormulaPerformence(d,{resultToSpreadsheetDuration:y.getFormulaPerformence(d).resultToSpreadsheetDuration+(Date.now()-A)})}else if(this.shouldSyncToDataLayer()||this.externalMethods.isGridRangeInVisbleArea(E)){var S=Date.now(),w={effectiveValue:I,userEnteredNumberFormat:u,effectiveFormatNumberFormat:h,gridRange:E};if(!R)this.externalMethods.updateSingleCellFromFormula(w,{needToSyncInVisibleArea:!0,mutationQueueIdRelatedSheetId:c,graphUpdateTimes:d,runInWorker:this.shouldSyncToDataLayer()})&&delete f[a];y.setFormulaPerformence(d,{resultToSpreadsheetDuration:y.getFormulaPerformence(d).resultToSpreadsheetDuration+(Date.now()-S)})}else{var M=Date.now();y.setFormulaPerformence(d,{resultToSpreadsheetDuration:y.getFormulaPerformence(d).resultToSpreadsheetDuration+(Date.now()-M)})}}},{key:"runSyncCalculation",value:function(e){var t=e.ast,r=e.isInCycle,n=e.graphUpdateTimes,a=e.formula,o=void 0;if(r)o=p.error.circle;else try{var i=Date.now();o=t.body.calculate();var s=Date.now()-i;y.setFormulaPerformence(n,{calculateDuration:y.getFormulaPerformence(n).calculateDuration+s}),t.reportLongTime(s,x.CellMap.REPORT_TYPE.CALCULATE)}catch(m){console.error("\u51fd\u6570\u8ba1\u7b97\u65f6\u51fa\u73b0\u9519\u8bef",m),o="object"===("undefined"===typeof m?"undefined":(0,u.default)(m))?m.message:p.error.error}var l={result:(0,p.fixNumber)(o,15)};if(y.setFormulaPerformence(n,{calculateCount:y.getFormulaPerformence(n).calculateCount+1}),!r){var d=Date.now(),c=this.getInheritFormat({formula:a,ast:t}),h=c.userEnteredNumberFormat,f=c.effectiveFormatNumberFormat;return y.setFormulaPerformence(n,{inheritFormatDuration:y.getFormulaPerformence(n).inheritFormatDuration+(Date.now()-d)}),{newValue:l,userEnteredNumberFormat:h,effectiveFormatNumberFormat:f}}return{newValue:l}}},{key:"runPostProcessingOfCalculationOnCellMap",value:function(e){var t=e.ast,r=e.newValue,n=e.sheetId,a=e.customType,o=e.row,i=e.col;(0,p.dealWithRangeRef)(t,r,n,this.getValueByTopCellPosition.bind(this)),(0,p.hasError)(r.result)&&(r.error=r.result),this.plugin.cellMap.setCellValueCache(a?n+"-"+a+"-":n,o,i,r.result),(0,p.isCircle)(r.result)&&(r.result=p.error.ref,r.error=p.error.ref)}},{key:"setEdge",value:function(e,t){var r=this.graph;if(!r.hasEdge(e,t))return r.setEdge(e,t)}},{key:"setNode",value:function(e,t){if("string"!==typeof e)return!1;var r=this.graph;if((0,p.isFormulaNode)(t)&&t.formulaModel){var n=t.formulaModel.toString(t.row,t.col);(n.indexOf("RAND()")>-1||n.indexOf("NOW()")>-1||n.match(/RANDBETWEEN\([^\(\)]*\)/))&&(this.alwaysNeedToUpdateNodesMap[e]=!0),t.hasAsyncFormula=n.indexOf("STOCK")>-1,/STOCK\(\s*(\w+(\.\w+)*)\.([A-Z]+)\s*,\s*8\s*\)/i.test(n)?this.scheduleUpdateNodesMap[e]=!0:delete this.scheduleUpdateNodesMap[e]}(0,p.isVirtualNodeId)(e)?(0,p.isVirtualCrossSheetReferenceId)(e)&&(this.virtualCrossSheetReferenceMap[e]=!0):this.addLinkBetweenNodeAndVirtualRowCol(e),r.setNode(e,t)}},{key:"setNodeCalculationPromise",value:function(e,t){"string"===typeof e&&((0,p.isPromise)(t)&&(this.cellCalculationPromiseMap[e]=t))}},{key:"shouldSyncToDataLayer",value:function(){return!0}},{key:"successors",value:function(e){var t=this.graph.successors(e)||[];if(t.length>0||(0,p.isVirtualNodeId)(e))return t;var r=[],n=(0,p.getRowColFromGraphNodeId)(e),a=n.row,o=n.col,i=n.sheetId,s=(0,p.getVirtualRowColIdFromInfo)({num:o,sheetId:i,isRow:!1});this.hasNode(s)&&r.push(s);var u=(0,p.getVirtualRowColIdFromInfo)({num:a,sheetId:i,isRow:!0});return this.hasNode(u)&&r.push(u),r}},{key:"topsort",value:function(e,t){if(0===t.length&&0!==(0,d.default)(e).length)throw new Error("\u56fe\u4e2d\u6709\u73af");var r={},n={},a=[],o=this.graph;if(t.forEach(function t(i){if(e[i]){if(n[i])throw new Error("\u56fe\u4e2d\u6709\u73af");if(!r[i]){n[i]=!0,r[i]=!0;var s=o.predecessors(i);s&&s.forEach(t),delete n[i],a.push(i)}}}),(0,d.default)(r).length!==(0,d.default)(e).length)throw new Error("\u56fe\u4e2d\u6709\u73af");return a}},{key:"tarjan",value:function(e){var t=0,r=[],n={},a=this.graph,o=[];return(0,d.default)(e).forEach(function(i){n[i]||function i(s){var u={onStack:!0,lowlink:t,index:t++};if(n[s]=u,r.push(s),(a.successors(s)||[]).forEach(function(t){e[t]&&(n[t]?n[t].onStack&&(u.lowlink=Math.min(u.lowlink,n[t].index)):(i(t),u.lowlink=Math.min(u.lowlink,n[t].lowlink)))}),u.lowlink===u.index){for(var l=[],d=void 0;s!==d;)d=r.pop(),n[d].onStack=!1,l.push(d);o.push(l)}}(i)}),o}},{key:"updateGraphWithBatchMoveAndRemoveUselessFormulaOnDataLayer",value:function(e){var t=this,r=e.nodesNeedToMoveArray,a=this.graph;r.forEach(function(e){var r=e.id,o=e.newRow,i=e.newCol,s=e.newId,u=e.newSheetId,d=t.node(r),c=s;if((0,p.isFormulaNode)(d)){var h=(0,l.default)(d,{row:o,col:i,id:s,sheetId:u});t.setNode(c,h)}else t.setNode(c,void 0);(t.children(r).forEach(function(e){var r=e.split("-"),o=(0,n.default)(r,1)[0]+"-"+s;a.setParent(o,c),t.outEdges(e).forEach(function(e){e.v;var r=e.w;t.setEdge(o,r)})}),(0,p.isFormulaNode)(d)&&d.needGenerateDependency)||t.inEdges(r).forEach(function(e){var r=e.v;t.setEdge(r,c)});t.outEdges(r).forEach(function(e){var r=e.w;t.setEdge(c,r)}),t.removeNode(r)})}}]),e}();t.default=U},1594:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ruleJS=void 0;var n=v(r(25)),a=v(r(31)),o=v(r(41)),i=v(r(1595)),s=r(447),u=v(s),l=r(371),d=r(136),c=r(201),h=r(44),f=v(r(757)),m=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(435)),p=r(1596),R=v(p),g=r(57);function v(e){return e&&e.__esModule?e:{default:e}}var N=window.location.href.indexOf("showFormulaLog=1")>=0;t.ruleJS=function(){var e=[1,26,676],t=[1,10,100,1e3,1e4,1e5,1e6,1e6],r=this,v={},T=function(e){var t=new R.default(e);return t.setObj=function(e){t.yy.obj=e},t.yy={},t.yy.quickParserStatus=!1,t.toggleQuickParserStatus=function(e){t.yy.quickParserStatus=e},t.getQuickParserStatus=function(){return t.yy.quickParserStatus},t},y={setElement:function(e){v.setObj(e)},toNum:function(e){return(0,h.colIdToCol)(e)},cellCoords:function(r){for(var n=r.length,a={row:-1,col:-1},o=!1,i=!1,s=0;s<n;s++){var u=s,l=r[s],d=0;if((0,h.isLetter)(l)&&!o){do{++s<n&&(l=r[s])}while(s<n&&(0,h.isLetter)(l));if(s-u>3)return{row:-1,col:-1};for(var c=s-1,f=c;f>=u;f--)d+=((32|r[f].charCodeAt(0))-96)*e[c-f];if(!(d<=16384))return{row:-1,col:-1};a.col=d-1,o=!0,s--}else{if(!(0,h.isNumberString)(l)||"0"===l||i){if("$"===l)continue;return{row:-1,col:-1}}do{++s<n&&(l=r[s])}while(s<n&&(0,h.isNumberString)(l));if(s-u>7)return{row:-1,col:-1};for(var m=s-1,p=0;m>=u;m--,p++)d+=(r[m].charCodeAt(0)-48)*t[p];d<=1048576&&(a.row=d-1),i=!0,s--}}return a},getRangeValue:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],r=t.sheetId,n=t.row,a=t.col,o=t.rowCount,i=t.colCount,s=void 0;1===o&&1===i?((s=[C.getCellValueByData(n,a,r)]).rangeCount=1,s.row=n,s.col=a,s.rowCount=o,s.colCount=i):((s=y.calcRangeValue(e,r,n,a,o,i)).rangeCount=1,s.row=n,s.col=a,s.rowCount=o,s.colCount=i);return s},calcRangeValue:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],r=arguments[2],n=arguments[3],a=arguments[4],o=arguments[5],i=e.newLine,s=0,u=void 0,l=[];l.error=[];for(var d=r+a,c=n+o,f=r;f<d;f++)for(var m=n;m<c;m++)if(u=C.getCellValueByData(f,m,t),(0,h.hasError)(u)&&l.error.push(u),"undefined"!==typeof i){var p=Math.floor(s/i);void 0===l[p]&&(l[p]=[]),l[p].push(u),s++}else l.push(u);return l},calcColsAndRows:function(e,t,n,a){var o=void 0,i=void 0,s=void 0,u=void 0;switch(a){case d.CELL_RANGE_TYPE.NORMAL:var l=y.cellCoords(e),c=y.cellCoords(t),h=l.row,f=l.col,m=c.row,p=c.col;if(h>m){var R=[m,h];h=R[0],m=R[1]}if(f>p){var g=[p,f];f=g[0],p=g[1]}o=h,s=m-h+1,i=f,u=p-f+1;break;case d.CELL_RANGE_TYPE.ROW:if("$"===e[0]&&(e=e.slice(1)),"$"===t[0]&&(t=t.slice(1)),(e=Number(e))>(t=Number(t))){var v=[t,e];e=v[0],t=v[1]}o=e-1,s=t-e+1,i=0,u=void 0;break;case d.CELL_RANGE_TYPE.COL:if("$"===e[0]&&(e=e.slice(1)),"$"===t[0]&&(t=t.slice(1)),(e=r.utils.toNum(e))>(t=r.utils.toNum(t))){var N=[t,e];e=N[0],t=N[1]}o=0,s=void 0,i=e,u=t-e+1}return{row:o,col:i,rowCount:s,colCount:u}},delIdAbsoluteRef:function(e){return e.includes("$")&&(e=e.replace(/\$/g,"")),e},cellToConstantAndNotifyUpdate:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments[1],n=arguments[2],a=arguments[3],o=r.cellMap,i=o.getCell(t,n,a);e=r.helper.number(e),i&&o.deleteCell(t,n,a),o.setCellValueCache(t,n,a,e)},getCellNode:function(e,t,r,n){t=t||v.yy.obj.sheetId;var a=y.cellCoords(e);return new u.default.CellNode(e,a.row,a.col,t,r,n)},getCellRangeBinaryNode:function(e,t,r,n){return new u.default.CellRangeBinaryNode(e,t,r,n)},getFunctionNode:function(e,t,n){var a=new u.default.FunctionNode(e,t,n);return"STOCK"===e&&r.cellMap.addAsyncFunctionNodeList(a),a},getVariableNode:function(e,t,r,n){return new u.default.VariableNode(e,t,r,n)},getThreeDimensionNode:function(e,t,r,n,a,i,s){var u=n.split(":"),l=(0,o.default)(u,2),d=l[0],c=l[1],f=y.transformSheetNameToId(d,h.error.name),m=y.transformSheetNameToId(c,h.error.name);return y.getCellRangeNode(e,t,f,m,r,a,i,s)},getCellRangeNode:function(e,t,n,a,o,i,s,l){var d=[n=n||v.yy.obj.sheetId];(a=a||v.yy.obj.sheetId)!==n&&(d=r.custom.getSheetIdsAmongTwoSheets(n,a));var c=r.utils.calcColsAndRows(e,t,d,i);return new u.default.CellRangeNode(n,a,e,t,c,d,i,s,o,l)},clearSheetName:function(e){if(""===e)return e;var t=0,r=e.length;return"'"===e[0]&&t++,"!"===e[e.length-1]&&r--,"'"===e[r-1]&&r--,e.slice(t,r)},transformSheetNameToId:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h.error.ref,n=y.clearSheetName(e);n=n.replace(/''/g,"'");var a=r.custom.getSheetIdBySheetName(n);if(!a)throw new Error(t);return a},addSheetId:function(e){return 0!==e.indexOf(v.yy.obj.sheetId)&&(e=v.yy.obj.sheetId+"!"+e),e},removeSheetId:function(e){return e.lastIndexOf("!")>-1&&(e=e.slice(e.lastIndexOf("!")+1)),e},compareSheetIds:function(e,t){if(e.length===t.length){var r={},n=!0,o=!1,i=void 0;try{for(var s,u=(0,a.default)(e);!(n=(s=u.next()).done);n=!0){r[s.value]=!0}}catch(m){o=!0,i=m}finally{try{!n&&u.return&&u.return()}finally{if(o)throw i}}var l=!0,d=!1,c=void 0;try{for(var h,f=(0,a.default)(t);!(l=(h=f.next()).done);l=!0){if(!r[h.value])return!1}}catch(m){d=!0,c=m}finally{try{!l&&f.return&&f.return()}finally{if(d)throw c}}return!0}return!1}},C={number:function(e){return(0,c.isCalcRef)(e)&&(e=e.toArray()[0]),r.custom.isNumeric(e)?"number"===typeof e?e:"string"===typeof e?(0,g.parseValueWithStyle)(e).value:e:e},parseNumber:function(e){if("string"===typeof e&&!(0,h.isEmptyString)(e)){var t=Number(e).valueOf();return isNaN(t)?e:t}return e},numberFormat:function(e){return r.custom.isNumeric(e)?(e=(0,g.parseValueWithStyle)(e).value,e=r.helper.number(e)):e},boolean:function(e){switch("undefined"===typeof e?"undefined":(0,n.default)(e)){case"boolean":return e;case"string":if("TRUE"===e.toUpperCase())return!0;if("FALSE"===e.toUpperCase())return!1}return e},string:function(e){var t=(e=e.slice(1,e.length-1)).length-1;if("("===e[0]&&")"===e[t]){var r=(0,p.readNumber)(e,1);r.isError||r.end!==t||(e=C.numberInverted(r.result))}return e},numberInverted:function(e){(0,c.isCalcRef)(e)&&(e=e.isCell?e.toArray()[0]:e.toArray());var t=void 0;if(Array.isArray(e))(t=e.map(function(e){return e.map(function(e){return e.map(function(e){return-1*(0,g.parseValueWithStyle)(e).value})})})).__isUserWrite=e.__isUserWrite;else{if(t=C.number(e),isNaN(t))return h.error.value;t*=-1}return t},percentNumber:function(e){var t=C.number(e);return isNaN(t)?h.error.value:t*=.01},specialMatch:function(e,t,r,n,a){return C.callFunction("specialMatch",[e,t,r],n,a)},logicMatch:function(e,t,r,n,a){return C.callFunction("logicMatch",[e,t,r],n,a)},mathMatch:function(e,t,r,n,a){return C.callFunction("mathMatch",[e,t,r],n,a)},callFunction:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments[2],a=arguments[3];e=e.toUpperCase();var o=v.yy.obj,i=r.formulas[e];if(i)return f.default._astNodes=n,f.default._funcNode=a,f.default._element={row:o.row,col:o.col,rowCount:o.rowCount,colCount:o.colCount,id:o.id,sheetId:o.sheetId},f.default._instance=r,(0,h.fixNumber)(i(t),15);throw console.log(e+"\u51fd\u6570\u4e0d\u5b58\u5728\u6216\u8fd8\u65e0\u6cd5\u4f7f\u7528"),new Error(h.error.name)},callVariable:function(e){return e?"TRUE"===(e=e.toUpperCase())||"FALSE"!==e&&h.error.name:h.error.name},cellValue:function(e,t,r){var n={sheetId:t,row:r.row,col:r.col,rowCount:1,colCount:1,refType:d.CELL_RANGE_TYPE.CELL};return new s.CalcRef([n],!0,C.cellValueCalcFunc)},cellValueCalcFunc:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];var e,t=this.identities[0],r=void 0;e=C.getCellValueByData(t.row,t.col,t.sheetId),(0,h.hasError)(e)&&(r=[e]);var n=[e];return n.error=r,n.rowCount=t.rowCount,n.colCount=t.colCount,n.rangeCount=1,n},getCellValueByData:function(e,t,n){var a=f.default._funcNode,o=a&&a.funcName||"",i=r.cellMap,s=i.getCellValueCache(n,e,t),u=void 0;s&&(u=s.v);var l={ID:!0,MID:!0}[o];if(void 0===u||l){var d=!l;(u=r.custom.cellValue(e,t,n))&&u.displayText?u=u.displayText:""===u?u=null:l||(u=C.parseNumber(u)),d&&i.setCellValueCache(n,e,t,u)}return u},cellRangeIntersection:function(e,t){if((0,c.isCalcRef)(e)&&(0,c.isCalcRef)(t)){var r=e.identities[0],n=t.identities[0],a=r,o=n;r.row>n.row&&(o=r,a=n);var i=r,u=n;if(r.col>n.col&&(u=r,i=n),o.row>=a.row+a.rowCount||u.col>=i.col+i.colCount)return h.error.null;var l=u.col,f=o.row,m=r;r.row+r.rowCount>n.row+n.rowCount&&(r,m=n);var p=r;r.col+r.colCount>n.col+n.colCount&&(r,p=n);var R=m.row+m.rowCount-o.row,g=p.col+p.colCount-u.col,v=1===R&&1===g,N=v?C.cellValueCalcFunc:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return y.getRangeValue(e,this.identities[0])},T=[{sheetId:r.sheetId,row:f,col:l,rowCount:R,colCount:g,refType:d.CELL_RANGE_TYPE.NORMAL}];return new s.CalcRef(T,v,N)}},cellRangeConcat:function(e,t){var r=[];return Array.prototype.push.apply(r,e.identities),Array.prototype.push.apply(r,t.identities),new s.CalcRef(r,!1,C.cellRangeCalcFunc)},transpose:function(e){for(var t=[],r=0;r<e.length;r++)for(var n=0;n<e[r].length;n++)Array.isArray(t[n])||(t[n]=[]),t[n].push(e[r][n]);return t},getUserRangeTextAndValue:function(e){for(var t=e.split(";"),r=[],n=0;n<t.length;n++){for(var a=t[n].split(","),o=0;o<a.length;o++){var i=a[o].trim(),s=Number(i);if(isNaN(s))if('"'===i[0]&&'"'===i[i.length-1])a[o]=i.slice(1,-1);else{if("TRUE"!==i&&"FALSE"!==i&&"true"!==i&&"false"!==i)throw new Error(h.error.value);a[o]="TRUE"===i.toUpperCase()}else a[o]=s}r.push(a)}return[r]},getCalcRef:function(e,t,r){return r=r||C.cellRangeCalcFunc,new s.CalcRef(e,t,r)},cellRangeCalcFunc:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];var e=r.cellMap,t=e.getCacheStatus(),a=v.yy.obj,o=a.colCount,i=a.rowCount,s=this.identities,u=void 0,l=void 0,d=void 0,c=void 0,f=void 0,m=void 0,p=void 0,R=t?e.cell:{},g=void 0,N=void 0,T=[],y=void 0,E=void 0,I=void 0,A=void 0,S=t?e.rangeCache:{};T.error=[];for(var w=s.length,M=0;M<w;M++){var F=s[M];d=F.row,c=F.col,u=F.rowCount,l=F.colCount,p=F.sheetId,f=Math.min(d+u,i),m=Math.min(c+l,o);var x=void 0;if((I=u*l>1500)&&(x=S[A=d+"_"+c+"_"+u+"_"+l+"_"+p]),x)Array.prototype.push.apply(T,x);else{R[p]||(R[p]=[]),g=R[p];for(var O=d;O<f;O++){g[O]||(g[O]=[]),E=g[O];for(var k=c;k<m;k++){if((N=E[k])&&void 0!==N.v)y=N.v;else{var D=!0;if((y=r.custom.cellValue(O,k,p))&&y.displayText)y=y.displayText;else if(""===y)y=null;else{var _="undefined"===typeof y?"undefined":(0,n.default)(y);("undefined"===typeof(y=C.parseNumber(y))?"undefined":(0,n.default)(y))!==_&&y.toString().length>16&&(D=!1)}D&&(N?E[k].v=y:N=E[k]={v:y})}(0,h.hasError)(y)&&T.error.push(y),T.push(y)}}I&&(S[A]=T)}}return T.rowCount=u,T.colCount=l,T.rangeCount=w,T.row=d,T.col=c,T},fixedCellRangeValue:function(e){for(var t=v.yy.obj,r=t.rowCount,n=t.colCount,a=e.scope,o=a.row,i=a.col,u=a.rowCount,l=void 0===u?r-o:u,d=a.colCount,c=void 0===d?n-i:d,h=e.sheetIds,f=[],m=0;m<h.length;m++){var p=h[m];f.push({row:o,col:i,rowCount:Math.min(l,r-o),colCount:Math.min(c,n-i),sheetId:p,refType:e.cellRangeType})}return new s.CalcRef(f,!1,C.cellRangeCalcFunc)}},E=(0,i.default)(window.reportProxy.monitor,300);return{init:function(){v=new T(r=this),r.cellMap=new l.CellMap,window.cellMap=r.cellMap,r.AstNode=u.default,r.NODE_TYPE={AST_TYPE:d.AST_TYPE,CROSS_TABLE_TYPE:d.CROSS_TABLE_TYPE,CELL_RANGE_TYPE:d.CELL_RANGE_TYPE,VARIABLE_TYPE:d.VARIABLE_TYPE,RANGE_BINARY_TYPE:d.RANGE_BINARY_TYPE},r.custom={}},version:"0.0.3",custom:{},utils:y,helper:C,parse:function(e,t){var n=void 0,a=null;try{v.setObj(t);var o=y.removeSheetId(t.id),i=function(e){var t=e;e.indexOf("STOCK")>-1&&/(stock)(?=\()/gi.test(t)&&(t=t.replace(/STOCK\((\w+(\.\w+)+),([^\)]+)\)/i,'STOCK("$1",$3)'));try{t.indexOf("ID(")>-1&&(t=function(e){var t=e.match(/ID\(\s*((\d{17}x)|(\d{18})|(\d{15}))\s*,/gi);return t&&t.map(function(t){var r=t.match(/(\d+x|\d+)/i)[0];e=e.replace(r,'"'+r+'"')}),e}(t))}catch(r){console.error("\u9000\u51fa\u8eab\u4efd\u8bc1\u89e3\u6790",r)}return t}(e);n=v.parse(i);var s=y.getCellNode(o,t.sheetId,d.CROSS_TABLE_TYPE.NONE,void 0);s.setBody(n),r.cellMap.setCell(t.sheetId,t.row,t.col,s),s.setFormula(e),n=s}catch(u){N&&console.log("\u51fd\u6570\u5c42\u51fa\u73b0\u9519\u8bef",u),a=(0,h.getErrorMsg)(u.message),m.addFormulaParserError(e),E&&E(3429247),n={error:a,errorProp:u.prop,value:n}}return n},bindCustomMethod:function(e){this.custom=e}}}},1596:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.readNumber=t.parseTokens=void 0;var n=l(r(0)),a=l(r(1)),o=l(r(25)),i=l(r(226)),s=r(1597),u=r(44);function l(e){return e&&e.__esModule?e:{default:e}}var d=(0,i.default)(u.error),c=1048576;function h(e){return e>=48&&e<=57}function f(e){return"."===e}function m(e){return e>=97&&e<=122||e>=65&&e<=90}function p(e){return e>=97&&e<=122||e>=65&&e<=90}function R(e){return{"&":!0,"=":!0,"<":!0,">":!0,"+":!0,"-":!0,"*":!0,"/":!0,"%":!0,"^":!0,":":!0,"(":!0,")":!0,",":!0," ":!0,"!":!0}[e]}function g(e,t){for(;" "===t[e];)e++;return e-1}var v=t.parseTokens=function(){var e="",t=[],r=0,n="",a=[{match:function(e,t){return m(t)},action:function(t){e+=t}},{match:function(e,t){return h(t)||f(e)},action:function(a){if(e.length>0)e+=a;else{var o=y(n,r);if(o.isError)throw new Error("number parse error\uff0c "+n.slice(r));r=o.end-1;var i=new s.Token(o.result,s.TokenType.NUMBER);t.push(i)}}},{match:function(e,t){return 34===t},action:function(a){if(e.length>0)throw new Error("\u65e0\u6cd5\u88ab\u8bc6\u522b\u7684token:"+e+a);var o=C(n,r,'"','"');if(o.isError)throw new Error("\u65e0\u6cd5\u88ab\u8bc6\u522b\u7684token:"+n.slice(r,o.end));r=o.end;var i=new s.Token(o.result,s.TokenType.STRING);t.push(i)}},{match:function(e,t){return R(e)},action:function(a){if(e.length>0){var o=T(e);if(o.isError)throw new Error("\u65e0\u6cd5\u88ab\u8bc6\u522b\u7684token:"+e);var i=new s.Token(e,o.tokenType);t.push(i)}if(" "===a){r=g(r+1,n);var u=n[r+1];R(u)&&(a=u,r++)}var l=new s.Token(a,s.TokenType.SEPARATOR);t.push(l),e="",r=g(r+1,n)}},{match:function(e,t){return 123===t},action:function(a){if(e.length>0)throw new Error("\u65e0\u6cd5\u88ab\u8bc6\u522b\u7684token:"+e+a);var o=C(n,r,"{","}");if(o.isError)throw new Error("\u65e0\u6cd5\u88ab\u8bc6\u522b\u7684token:"+n.slice(r,o.end));r=o.end;var i=new s.Token(o.result,s.TokenType.USERARRAY);t.push(i)}},{match:function(e,t){return 39===t},action:function(a){if(e.length>0)throw new Error("\u65e0\u6cd5\u88ab\u8bc6\u522b\u7684token:"+e+a);var o=C(n,r,"'","'"),i=n[o.end+1].charCodeAt(0);if(o.isError)throw new Error("\u65e0\u6cd5\u88ab\u8bc6\u522b\u7684token:"+n.slice(r,o.end));if(!p(i))throw new Error("\u65e0\u6cd5\u88ab\u8bc6\u522b\u7684token:"+n.slice(r,o.end+1));r=o.end+1;var u=new s.Token(o.result,s.TokenType.SHEET);t.push(u)}},{match:function(e,t){return p(t)},action:function(r){var n=new s.Token(e,s.TokenType.SHEET);t.push(n),e=""}},{match:function(e,t){return 35===t},action:function(a){if(e.length>0)throw new Error("\u65e0\u6cd5\u88ab\u8bc6\u522b\u7684token:"+e+a);var o=function(e,t){for(var r=d.length,n=!0,a="",o=0;o<r;o++){var i=d[o];if(t+i.length<=e.length){var s=e.slice(t,t+i.length);if(s===i){t+=i.length,a=s,n=!1;break}}}return{result:a,end:t,isError:n}}(n,r);if(o.isError)throw new Error("\u65e0\u6cd5\u88ab\u8bc6\u522b\u7684token:"+n.slice(r));r=o.end-1;var i=new s.Token(o.result,s.TokenType.ERROR);t.push(i)}},{match:function(e,t){return 13===t||10===t},action:function(e){}},{match:function(e,t){return!0},action:function(t){e+=t}}];return function(o){var i=o.length;for(n=o,r=0,t=[],e="";r<i;r++)for(var u=n[r],l=u.charCodeAt(0),d=0;d<a.length;d++){var c=a[d];if(c.match(u,l)){c.action(u);break}}if(e.length>0){var h=T(e);if(h.isError)throw new Error("\u65e0\u6cd5\u88ab\u8bc6\u522b\u7684token:"+e);var f=new s.Token(e,h.tokenType);t.push(f)}return t}}();function N(e,t,r,n,a){for(var o=e.length,i=0;r<o;r++){if(!t(e[r].charCodeAt(0)))break;i++}return{accept:i>=n&&i<=a,end:r}}var T=function(){var e=0,t=0;function r(t){var r=N(t,m,e+1,0,2),n=1;return r.accept||(n=6),e=r.end-1,n}var n=[[r,2,,6],[,5,function(t){var r=N(t,h,e+1,0,5),n=7;return r.end-e>=7&&Number(t.slice(e,r.end))>c&&(n=6),e=r.end-1,n},6],[r,,function(t){var r=N(t,h,e+1,0,5);return e=r.end-1,8}],[],[],[,,function(t){var r=N(t,h,e+1,0,5);return e=r.end-1,7}],[6,,6,6],[6,,,6],[]],a={1:s.TokenType.COL,6:s.TokenType.VARIABLE,7:s.TokenType.CELL,8:s.TokenType.ROW};return function(r){t=0,e=0;for(var i=!1,l=r.length;e<l;e++){var d=r[e],c=void 0;c=m(d.charCodeAt(0))?0:(0,u.isNumberString)(d)?2:"$"===d?1:3;var h=n[t][c],f="undefined"===typeof h?"undefined":(0,o.default)(h);if("number"===f)t=h;else{if("function"!==f){i=!0;break}var p=h(r);if(void 0===p){i=!0;break}t=p}}return{tokenType:a[t]||s.TokenType.UNKNOW,isError:i}}}(),y=t.readNumber=function(){var e=[[1,2],[1,2,4],[3,,4],[3,,4],[6,,,5],[6],[6]],t={1:!0,3:!0,6:!0},r=0;return function(n,a){r=0;for(var o="",i=n.length,s=a;s<i;s++){var u=n[s],l=-1;l=h(u.charCodeAt(0))?0:f(u)?1:"E"===u||"e"===u?2:"+"===u||"-"===u?3:4;var d=e[r][l];if(void 0===d)break;o+=u,r=d}return{result:o,end:s--,isError:!t[r]}}}();function C(e,t,r,n){for(var a=e.length,o="",i=!0,s=!1;t<a;t++){var u=e[t];if(s||u!==r){if(s&&u===n){if(e[t+1]===u){t++,o+=u;continue}i=!1;break}s&&(o+=u)}else s=!0}return{result:o,end:t,isError:i}}var E=function(){function e(t){(0,n.default)(this,e),this.context=t}return(0,a.default)(e,[{key:"parse",value:function(e){return this.idx=0,this.stack=[],this.tokens=v(e),this.expression(!0),this.stack[this.stack.length-1]}},{key:"llkMatchType",value:function(e,t){var r=this.tokens[this.idx+t];return r&&r.type===e}},{key:"llkMatchTypeAndChar",value:function(e,t,r){var n=this.tokens[this.idx+r];return n&&n.value===t&&n.type===e}},{key:"matchType",value:function(e){var t=this.tokens[this.idx];return t&&t.type===e}},{key:"matchTypeAndChar",value:function(e,t){var r=this.tokens[this.idx];return r&&r.value===t&&r.type===e}},{key:"throwError",value:function(){}},{key:"advance",value:function(){this.idx++}},{key:"currentTokenValue",value:function(){return this.tokens[this.idx].value}},{key:"expression",value:function(e){this.expression1(),this.expression0(e)}},{key:"expression1",value:function(){this.expression2(),this.expression21()}},{key:"expression0",value:function(e){if(this.matchPriorityOperation0()){var t=this.currentTokenValue();if(this.advance(),this.idx>=this.tokens.length)throw new Error("expected expression\uff0cbut got empty");var r=this.currentTokenValue();if((">"===t&&"="===r||"<"===t&&("="===r||">"===r))&&(this.advance(),t+=r),this.expression1(),this.stack.length<2)throw new Error("expected expression\uff0cbut got empty");var n=this.context.utils.getVariableNode(t,this.context.NODE_TYPE.VARIABLE_TYPE.BINARY,function(){return t}),a=this.stack[this.stack.length-2],o=this.stack[this.stack.length-1],i=this.context.utils.getFunctionNode("LOGICMATCH",[a,o,n],this.context.helper.callFunction);this.stack.pop(),this.stack.pop(),this.stack.push(i),this.expression0()}else if(e&&this.idx!==this.tokens.length)throw new Error("expected operation, but got "+this.currentTokenValue())}},{key:"expression21",value:function(){if(this.matchTypeAndChar(s.TokenType.SEPARATOR,"&")){var e=this.currentTokenValue();if(this.advance(),this.expression2(),this.stack.length<2)throw new Error("expected expression\uff0cbut got empty");var t=this.context.utils.getVariableNode(e,this.context.NODE_TYPE.VARIABLE_TYPE.BINARY,function(){return e}),r=this.stack[this.stack.length-2],n=this.stack[this.stack.length-1],a=this.context.utils.getFunctionNode("SPECIALMATCH",[r,n,t],this.context.helper.callFunction);this.stack.pop(),this.stack.pop(),this.stack.push(a),this.expression21()}}},{key:"expression2",value:function(){this.expression3(),this.expression31()}},{key:"expression31",value:function(){if(this.matchTypeAndChar(s.TokenType.SEPARATOR,"+")||this.matchTypeAndChar(s.TokenType.SEPARATOR,"-")){var e=this.currentTokenValue();if(this.advance(),this.expression3(),this.stack.length<2)throw new Error("expected expression\uff0cbut got empty");var t=this.context.utils.getVariableNode(e,this.context.NODE_TYPE.VARIABLE_TYPE.BINARY,function(){return e}),r=this.stack[this.stack.length-2],n=this.stack[this.stack.length-1],a=this.context.utils.getFunctionNode("MATHMATCH",[r,n,t],this.context.helper.callFunction);this.stack.pop(),this.stack.pop(),this.stack.push(a),this.expression31()}}},{key:"expression3",value:function(){this.expression4(),this.expression41()}},{key:"expression41",value:function(){if(this.matchTypeAndChar(s.TokenType.SEPARATOR,"*")||this.matchTypeAndChar(s.TokenType.SEPARATOR,"/")){var e=this.currentTokenValue();if(this.advance(),this.expression4(),this.stack.length<2)throw new Error("expected expression\uff0cbut got empty");var t=this.context.utils.getVariableNode(e,this.context.NODE_TYPE.VARIABLE_TYPE.BINARY,function(){return e}),r=this.stack[this.stack.length-2],n=this.stack[this.stack.length-1],a=this.context.utils.getFunctionNode("MATHMATCH",[r,n,t],this.context.helper.callFunction);this.stack.pop(),this.stack.pop(),this.stack.push(a),this.expression41()}}},{key:"expression4",value:function(){if(this.matchTypeAndChar(s.TokenType.SEPARATOR,"-")||this.matchTypeAndChar(s.TokenType.SEPARATOR,"+")){var e=this.currentTokenValue();this.advance(),this.expression4();var t=this.stack[this.stack.length-1],r="-"===e?this.context.helper.numberInverted:this.context.helper.number,n=this.context.utils.getVariableNode(t,this.context.NODE_TYPE.VARIABLE_TYPE.NUM,r,function(e,t){e.push("-"),this.originValueNode.toString(e,t)});this.stack.pop(),this.stack.push(n)}else this.expression5(),this.expression51()}},{key:"expression51",value:function(){if(this.matchTypeAndChar(s.TokenType.SEPARATOR,"%")){this.advance();var e=this.stack[this.stack.length-1],t=this.context.utils.getVariableNode(e,this.context.NODE_TYPE.VARIABLE_TYPE.NUM,this.context.helper.percentNumber,function(e,t){this.originValueNode.toString(e,t),e.push("%")});this.stack.pop(),this.stack.push(t),this.expression51()}else if(this.matchTypeAndChar(s.TokenType.SEPARATOR,"^")){var r=this.currentTokenValue();if(this.advance(),this.expression5(),this.stack.length<2)throw new Error("expected expression\uff0cbut got empty");var n=this.context.utils.getVariableNode(r,this.context.NODE_TYPE.VARIABLE_TYPE.BINARY,function(){return r}),a=this.stack[this.stack.length-2],o=this.stack[this.stack.length-1],i=this.context.utils.getFunctionNode("MATHMATCH",[a,o,n],this.context.helper.callFunction);this.stack.pop(),this.stack.pop(),this.stack.push(i),this.expression51()}}},{key:"expression5",value:function(){this.expression6(),this.expression61()}},{key:"expression61",value:function(){}},{key:"expression6",value:function(){if(this.matchTypeAndChar(s.TokenType.SEPARATOR,"("))this.advance(),this.expression7();else if(this.lfFunction())this.function();else if(this.lfReference())this.reference(),this.matchTypeAndChar(s.TokenType.SEPARATOR," ")&&this.cellRangeIntersectionSeq();else if(this.matchType(s.TokenType.STRING)){var e=this.context.utils.getVariableNode('"'+this.currentTokenValue()+'"',this.context.NODE_TYPE.VARIABLE_TYPE.STR,this.context.helper.string);this.stack.push(e),this.advance()}else if(this.matchType(s.TokenType.NUMBER)){var t=this.context.utils.getVariableNode(this.currentTokenValue(),this.context.NODE_TYPE.VARIABLE_TYPE.NUM,this.context.helper.number);this.stack.push(t),this.advance()}else if(this.lfVariable())this.variable();else if(this.matchType(s.TokenType.ERROR)){var r=this.context.utils.getVariableNode(this.currentTokenValue(),this.context.NODE_TYPE.VARIABLE_TYPE.ERROR,function(e){return e});this.stack.push(r),this.advance()}}},{key:"cellRangeIntersectionSeq",value:function(){this.cellRangeIntersectionSeq1()}},{key:"cellRangeIntersectionSeq1",value:function(){this.matchTypeAndChar(s.TokenType.SEPARATOR," ")&&(this.stack.push(this.currentTokenValue()),this.advance(),this.reference(),this.newCellRangeIntersection(),this.cellRangeIntersectionSeq1())}},{key:"newCellRangeIntersection",value:function(){var e=this.context.NODE_TYPE.RANGE_BINARY_TYPE.INTERSECTION,t=this.context.helper.cellRangeIntersection,r=this.stack[this.stack.length-3],n=this.stack[this.stack.length-1],a=this.context.utils.getCellRangeBinaryNode(r,n,e,t);return this.stack.pop(),this.stack.pop(),this.stack.pop(),this.stack.push(a),a}},{key:"function",value:function(){if(this.stack.push(this.currentTokenValue()),this.advance(),!this.matchTypeAndChar(s.TokenType.SEPARATOR,"("))throw new Error("expected (\uff0cbut got"+this.currentTokenValue());if(this.stack.push(this.currentTokenValue()),this.advance(),this.matchTypeAndChar(s.TokenType.SEPARATOR,")"))this.stack.push([]),this.stack.push(this.currentTokenValue()),this.advance(),this.newFunctionNode();else{if(this.expseq(),!this.matchTypeAndChar(s.TokenType.SEPARATOR,")"))throw new Error("expected )\uff0cbut got"+this.currentTokenValue());this.stack.push(this.currentTokenValue()),this.advance(),this.newFunctionNode()}}},{key:"newFunctionNode",value:function(){var e=this.stack[this.stack.length-4],t=this.stack[this.stack.length-2],r=this.context.utils.getFunctionNode(e,t,this.context.helper.callFunction);this.stack.pop(),this.stack.pop(),this.stack.pop(),this.stack.pop(),this.stack.push(r)}},{key:"variable",value:function(){if(!this.matchType(s.TokenType.VARIABLE)&&!this.matchType(s.TokenType.COL))throw new Error("expected VARIABLE or COL\uff0cbut got"+this.currentTokenValue());var e=this.currentTokenValue(),t=this.context.utils.getVariableNode(e,this.context.NODE_TYPE.VARIABLE_TYPE.VARIABLE,this.context.helper.callVariable);this.stack.push(t),this.advance()}},{key:"expression7",value:function(){if(this.lfCell()&&this.llkMatchTypeAndChar(s.TokenType.SEPARATOR,",",1)||this.lfCellRange()&&this.llkMatchTypeAndChar(s.TokenType.SEPARATOR,",",3)?this.cellRangeConcatSeq():this.expression(),!this.matchTypeAndChar(s.TokenType.SEPARATOR,")"))throw new Error("expected )\uff0cbut got"+this.currentTokenValue());this.advance();var e=this.stack[this.stack.length-1],t=this.context.utils.getVariableNode(e,this.context.NODE_TYPE.VARIABLE_TYPE.NUM,function(e){return e},function(e,t){e.push("("),this.originValueNode.toString(e,t),e.push(")")});this.stack.pop(),this.stack.push(t)}},{key:"cellRangeConcatSeq",value:function(){this.reference(),this.cellRangeConcatSeq1()}},{key:"reference",value:function(){this.matchType(s.TokenType.CELL)&&!this.llkMatchTypeAndChar(s.TokenType.SEPARATOR,":",1)?this.newCellNode():this.cellRange()}},{key:"cellRangeConcatSeq1",value:function(){this.matchTypeAndChar(s.TokenType.SEPARATOR,",")&&(this.stack.push(this.currentTokenValue()),this.advance(),this.reference(),this.newCellRangeConcatSeq(),this.cellRangeConcatSeq1())}},{key:"newCellRangeConcatSeq",value:function(){var e=this.context.NODE_TYPE.RANGE_BINARY_TYPE.CONCAT,t=this.context.helper.cellRangeConcat,r=this.stack[this.stack.length-3],n=this.stack[this.stack.length-1],a=this.context.utils.getCellRangeBinaryNode(r,n,e,t);return this.stack.pop(),this.stack.pop(),this.stack.pop(),this.stack.push(a),a}},{key:"newCellNode",value:function(){var e=this.tokens[this.idx].value,t=this.context.NODE_TYPE.CROSS_TABLE_TYPE.NONE,r=this.context.helper.cellValue,n=this.context.utils.getCellNode(e,"",t,r);this.stack.push(n),this.advance()}},{key:"cellRange",value:function(){this.localCellRange()}},{key:"localCellRange",value:function(){if(this.matchType(s.TokenType.CELL)&&this.llkMatchTypeAndChar(s.TokenType.SEPARATOR,":",1)&&this.llkMatchType(s.TokenType.CELL,2)){var e=this.context.NODE_TYPE.CELL_RANGE_TYPE.NORMAL,t=this.context.NODE_TYPE.CROSS_TABLE_TYPE.NONE;this.newCellRangeNode(e,t)}else if(this.matchType(s.TokenType.COL)&&this.llkMatchTypeAndChar(s.TokenType.SEPARATOR,":",1)&&this.llkMatchType(s.TokenType.COL,2)){var r=this.context.NODE_TYPE.CELL_RANGE_TYPE.COL,n=this.context.NODE_TYPE.CROSS_TABLE_TYPE.NONE;this.newCellRangeNode(r,n)}else if((this.matchType(s.TokenType.NUMBER)||this.matchType(s.TokenType.ROW))&&this.llkMatchTypeAndChar(s.TokenType.SEPARATOR,":",1)&&this.llkMatchType(s.TokenType.NUMBER,2)||this.llkMatchType(s.TokenType.ROW,2)){var a=this.context.NODE_TYPE.CELL_RANGE_TYPE.ROW,o=this.context.NODE_TYPE.CROSS_TABLE_TYPE.NONE;this.newCellRangeNode(a,o)}else{if(!this.matchType(s.TokenType.USERARRAY))throw new Error("expected cellRange\uff0cbut got"+this.currentTokenValue());var i=this.currentTokenValue(),u=this.context.NODE_TYPE.CELL_RANGE_TYPE.USER_RANGE,l=this.context.NODE_TYPE.CROSS_TABLE_TYPE.NONE,d="{"+i+"}",c=this.context.utils.getCellRangeNode(d,d,"","",d,u,l,function(){return this.value}),h=this.context.helper.getUserRangeTextAndValue(i);c.setValue(h),this.stack.push(c),this.advance()}}},{key:"newCellRangeNode",value:function(e,t){this.stack.push(this.currentTokenValue()),this.advance(),this.stack.push(this.currentTokenValue()),this.advance(),this.stack.push(this.currentTokenValue()),this.advance();var r=this.stack[this.stack.length-3],n=this.stack[this.stack.length-2],a=this.stack[this.stack.length-1],o=r+n+a,i=this.context.helper.fixedCellRangeValue,s=this.context.utils.getCellRangeNode(r,a,"","",o,e,t,i);this.stack.pop(),this.stack.pop(),this.stack.pop(),this.stack.push(s)}},{key:"expseq",value:function(){var e=this.stack;if(this.stack=[],this.expression(),this.expseq1(),this.llkMatchTypeAndChar(s.TokenType.SEPARATOR,",",-1)){var t=this.context.utils.getVariableNode("",this.context.NODE_TYPE.VARIABLE_TYPE.PLACEHOLDER,function(){return""});this.stack.push(t)}e.push(this.stack),this.stack=e}},{key:"expseq1",value:function(){if(this.matchTypeAndChar(s.TokenType.SEPARATOR,",")){if(this.llkMatchTypeAndChar(s.TokenType.SEPARATOR,"(",-1)||this.llkMatchTypeAndChar(s.TokenType.SEPARATOR,",",-1)){var e=this.context.utils.getVariableNode("",this.context.NODE_TYPE.VARIABLE_TYPE.PLACEHOLDER,function(){return""});this.stack.push(e)}this.advance(),this.expression(),this.expseq1()}}},{key:"lfCell",value:function(){return this.matchType(s.TokenType.CELL)&&!this.llkMatchTypeAndChar(s.TokenType.SEPARATOR,":",1)}},{key:"lfCellRange",value:function(){return this.matchType(s.TokenType.CELL)&&this.llkMatchTypeAndChar(s.TokenType.SEPARATOR,":",1)&&this.llkMatchType(s.TokenType.CELL,2)||this.matchType(s.TokenType.COL)&&this.llkMatchTypeAndChar(s.TokenType.SEPARATOR,":",1)&&this.llkMatchType(s.TokenType.COL,2)||this.matchType(s.TokenType.NUMBER)&&this.llkMatchTypeAndChar(s.TokenType.SEPARATOR,":",1)&&this.llkMatchType(s.TokenType.NUMBER,2)}},{key:"lfFunction",value:function(){return(this.matchType(s.TokenType.VARIABLE)||this.matchType(s.TokenType.COL)||this.matchType(s.TokenType.CELL))&&this.llkMatchTypeAndChar(s.TokenType.SEPARATOR,"(",1)}},{key:"lfVariable",value:function(){return this.matchType(s.TokenType.VARIABLE)||this.matchType(s.TokenType.COL)&&!this.llkMatchTypeAndChar(s.TokenType.SEPARATOR,":",1)}},{key:"lfReference",value:function(){return this.matchType(s.TokenType.CELL)||this.matchType(s.TokenType.COL)&&this.llkMatchTypeAndChar(s.TokenType.SEPARATOR,":",1)||(this.matchType(s.TokenType.NUMBER)||this.matchType(s.TokenType.ROW))&&this.llkMatchTypeAndChar(s.TokenType.SEPARATOR,":",1)||this.matchType(s.TokenType.USERARRAY)}},{key:"matchPriorityOperation0",value:function(){var e=this.tokens[this.idx];return e&&("="===e.value||"<"===e.value||">"===e.value)}}]),e}();t.default=E,window.parseTokens=v},1597:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Token=t.TokenType=void 0;var n,a=r(0),o=(n=a)&&n.__esModule?n:{default:n};var i=t.TokenType=void 0;!function(e){e.CELL="CELL",e.COL="COL",e.ROW="ROW",e.VARIABLE="VARIABLE",e.STRING="STRING",e.ERROR="ERROR",e.NUMBER="NUMBER",e.SHEET="SHEET",e.SEPARATOR="SEPARATOR",e.USERARRAY="USERARRAY",e.UNKNOW="UNKNOW"}(i||(t.TokenType=i={}));t.Token=function e(t,r){(0,o.default)(this,e),this.value=t,this.type=r}},1598:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(14)),a=i(r(0)),o=i(r(1));function i(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(){(0,a.default)(this,e),this.infoMap={}}return(0,o.default)(e,[{key:"updateInfoBySheetId",value:function(e,t){this.infoMap[e]=this.infoMap[e]||{},(0,n.default)(this.infoMap[e],t)}},{key:"getMaxRowsBySheetId",value:function(e){var t=this.infoMap[e];return t?t.maxRows:0}},{key:"getMaxColsBySheetId",value:function(e){var t=this.infoMap[e];return t?t.maxCols:0}}]),e}();t.default=new s},1599:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SheetFormulaLayerStatusMap=void 0;var n=l(r(9)),a=l(r(31)),o=l(r(47)),i=l(r(0)),s=l(r(1)),u=r(44);function l(e){return e&&e.__esModule?e:{default:e}}t.SheetFormulaLayerStatusMap=function(){function e(){(0,i.default)(this,e),this.statusMap={}}return(0,s.default)(e,[{key:"getInitialPromise",value:function(e){var t=this.statusMap[e];return t&&(0,u.isPromise)(t.initialized)?t.initialized:o.default.reject()}},{key:"getCurrentStatusMap",value:function(){var e={},t=!0,r=!1,o=void 0;try{for(var i,s=(0,a.default)((0,n.default)(this.statusMap));!(t=(i=s.next()).done);t=!0){var u=i.value;e[u]=this.isSheetInitialized(u)?"initialized":this.isSheetCalculating(u)?"calculating":this.isSheetWaiting(u)?"waiting":"loaded"}}catch(l){r=!0,o=l}finally{try{!t&&s.return&&s.return()}finally{if(r)throw o}}return e}},{key:"getWaitingPromise",value:function(e){var t=this.statusMap[e];return t&&(0,u.isPromise)(t.waiting)?t.waiting:o.default.reject()}},{key:"isSheetLoaded",value:function(e){return!!this.statusMap[e]}},{key:"isSheetWaiting",value:function(e){var t=this.statusMap[e];return!(!t||!(0,u.isPromise)(t.waiting)||(0,u.isPromise)(t.initialized))}},{key:"isSheetCalculating",value:function(e){var t=this.statusMap[e];return!(!t||t.ready||!(0,u.isPromise)(t.initialized))}},{key:"isSheetInitialized",value:function(e){var t=this.statusMap[e];return!(!t||!t.ready)}},{key:"resetSheet",value:function(e){delete this.statusMap[e]}},{key:"setWaitingStart",value:function(e){if(!this.statusMap[e]){var t=(0,u.getOutScopeControlledPromise)(),r=t.promise,n=t.reject,a=t.resolve;this.statusMap[e]={waiting:r,waitingReject:n,waitingResolve:a}}}},{key:"setWaitingDone",value:function(e){var t=this.statusMap[e];if(!t||!(0,u.isPromise)(t.waiting)||(0,u.isPromise)(t.initialized))throw new Error(e+" \u8bbe\u7f6e waiting \u72b6\u6001\u7684\u65f6\u673a\u6709\u8bef");if(!t.waitingResolve)throw new Error(e+" waiting resolve function miss");t.waitingResolve();var r=(0,u.getOutScopeControlledPromise)(),n=r.promise,a=r.reject,o=r.resolve;t.initialized=n,t.initializedReject=a,t.initializedResolve=o}},{key:"setIntializedDone",value:function(e){var t=this.statusMap[e];if(!t||!(0,u.isPromise)(t.initialized))throw new Error(e+" \u8bbe\u7f6e initialized \u7684\u65f6\u673a\u6709\u8bef");if(!t.initializedResolve)throw new Error(e+" resolve function miss");t.initializedResolve(),t.ready=!0}}]),e}()},184:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(r(47)),a=s(r(0)),o=s(r(1)),i=s(r(7));function s(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(){(0,a.default)(this,e),this.calculateParentFunctionNode=void 0,this.calculateTopCell=void 0}return(0,o.default)(e,[{key:"setCalculateTopCell",value:function(e){this.calculateTopCell=e}},{key:"setCalculateParentFunctionNode",value:function(e){this.calculateParentFunctionNode=e}},{key:"setValue",value:function(e){this.value=e}},{key:"reportLongTime",value:function(e,t){e>0&&i.default.window.cellMap.addLongTimeNode({type:t,nodeType:this.nodeType,time:e})}},{key:"toString",value:function(e,t){}},{key:"calculate",value:function(){return console.error("\u5b50\u7c7b\u91cd\u5199"),""}},{key:"asyncCalculate",value:function(){return console.error("\u5b50\u7c7b\u91cd\u5199"),n.default.resolve("")}}]),e}();t.default=u},201:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LIKE_SUMPRODUCT=void 0;var n=r(763);Object.defineProperty(t,"LIKE_SUMPRODUCT",{enumerable:!0,get:function(){return n.LIKE_SUMPRODUCT}}),t.isASTNode=i,t.isCalcRef=function(e){return e&&e instanceof o.CalcRef},t.isCell=function(e){return e&&(e.nodeType===a.AST_TYPE.CELL||e.nodeType===a.AST_TYPE.EMPTY_CELL)},t.isCellNode=s,t.isCrossTableCellNode=function(e){if(s(e))return e.crossTableType===a.CROSS_TABLE_TYPE.NORMAL;return!1},t.isCellNodeCrossTable=function(e){return e&&e.crossTableType===a.CROSS_TABLE_TYPE.NORMAL},t.isCrossTableCellRangeNode=function(e){if(l(e))return e.crossTableType!==a.CROSS_TABLE_TYPE.NONE;return!1},t.isUserRange=function(e){if(l(e))return e.cellRangeType===a.CELL_RANGE_TYPE.USER_RANGE;return!1},t.isCellRangeNodeCrossTable=function(e){return e&&e.crossTableType!==a.CROSS_TABLE_TYPE.NONE},t.isCellRangeNodeCrossTableThreeDimension=function(e){return e&&e.crossTableType===a.CROSS_TABLE_TYPE.THREE_DIMENSION},t.isCellRangeBinaryNode=u,t.isCellRangeNode=l,t.isFunctionNode=d,t.isFunctionNodeButNotBinaryNode=function(e){return d(e)&&"MATHMATCH"!==e.funcName&&"LOGICMATCH"!==e.funcName&&"SPECIALMATCH"!==e.funcName},t.isVariableNode=c,t.isCurrentNodeInPositionRelyFunction=function(e){if(!e||!e.length)return!1;if(e.length>1){var t=e[e.length-2],r=e[e.length-1];if(d(t)&&"OFFSET"===t.funcName&&0===t.args.indexOf(r))return!0}for(var n=["ROW","COLUMN"],a=e.length-1;a>-1;a--){var o=e[a];if(d(o)&&n.indexOf(o.funcName)>-1)return!0}return!1},t.walk=function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=n.preorder,o=void 0!==a&&a,f=n.walkContext,m=void 0===f?{}:f;var p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];p.length||p.push(t);if(s(t)){if(!t.body)return{stopAll:!1};var R=p.concat([t.body]),g=r(t.body,R,{walkContext:m})||h,v=g.stopSearchingDown,N=void 0!==v&&v,T=g.stopAll,y=void 0!==T&&T,C=g.walkContext;return y?{stopAll:!0}:!0!==N?e(t.body,r,{preorder:o,walkContext:C||m},R):{stopAll:y}}if(d(t)){for(var E=t.args,I=o?0:E.length-1,A=o?E.length-1:0,S=I;o?S<=A:S>=A;o?S++:S--){var w=E[S],M=p.concat(w),F=r(w,M,{walkContext:m})||h,x=F.stopSearchingDown,O=void 0!==x&&x,k=F.stopParallelTraversal,D=void 0!==k&&k,_=F.stopAll,U=void 0!==_&&_,B=F.walkContext;if(U)return{stopAll:U};if(!0!==O){var L=e(w,r,{preorder:o,walkContext:B||m},M),P=L.stopAll;if(P)return{stopAll:!0}}if(!0===D)break}return{stopAll:!1}}if(l(t)){return{stopAll:!1}}if(c(t)){var b=t.originValueNode;if(i(b)){var V=p.concat([b]),G=r(b,V,{walkContext:m})||h,Y=G.stopSearchingDown,H=void 0!==Y&&Y,W=G.stopAll,K=void 0!==W&&W,j=G.walkContext;return K?{stopAll:!0}:!0!==H?e(b,r,{preorder:o,walkContext:j||m},V):{stopAll:K}}return{stopAll:!1}}if(u(t)){var z={rightRange:p.concat([t.rightRange]),leftRange:p.concat([t.leftRange])},$=o?["leftRange","rightRange"]:["rightRange","leftRange"],Q=!1,X=!1;return $.forEach(function(n){if(!Q&&!X){var a=r(t[n],z[n],{walkContext:m})||h,i=a.stopSearchingDown,s=void 0!==i&&i,u=a.stopParallelTraversal,l=void 0!==u&&u,d=a.stopAll,c=void 0!==d&&d,f=a.walkContext;if(c)X=c;else if(Q=!!l,!0===s)Q=l;else{var p=e(t[n],r,{preorder:o,walkContext:f||m},z[n]),R=p.stopAll;X=R}}}),{stopAll:X}}return{stopAll:!1}};var a=r(136),o=r(447);function i(e){return!!e&&"string"!==typeof e&&void 0!==e.nodeType&&null!==e.nodeType}function s(e){return!!e&&e.nodeType===a.AST_TYPE.CELL}function u(e){return e&&e.nodeType===a.AST_TYPE.CELL_RANGE_BINARY}function l(e){return e&&e.nodeType===a.AST_TYPE.CELL_RANGE}function d(e){return"boolean"!==typeof e&&e&&e.nodeType===a.AST_TYPE.FUNCTION}function c(e){return e&&e.nodeType===a.AST_TYPE.VARIABLE}var h={stopSearchingDown:!1,stopParallelTraversal:!1,stopAll:!1,walkContext:{}}},371:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CellMap=void 0;var n=s(r(31)),a=s(r(83)),o=s(r(0)),i=s(r(1));function s(e){return e&&e.__esModule?e:{default:e}}var u={CALCULATE:"CALCULATE",PARSE:"PARSE",MINI_AST:"MINI_AST"},l=t.CellMap=function(){function e(){(0,o.default)(this,e),this.asyncFuncNodeList=[],this.longTime=[],this.cell={},this.rangeCache={},this.cacheStatus=!0}return(0,i.default)(e,[{key:"cleanAllAstNodes",value:function(e,t,r,n,a){for(var o=t;o<=r;o++)for(var i=n;i<=a;i++)this.deleteCell(e,o,i)}},{key:"destroy",value:function(){this.cell={},this.rangeCache={},delete this.asyncFuncNodeList}},{key:"getCellValueCache",value:function(e,t,r){if(this.cacheStatus){var n=this.cell[e];if(void 0!==n){var a=n[t];if(void 0!==a)return a[r]}}}},{key:"setCellValueCache",value:function(e,t,r,n){this.cacheStatus&&(void 0===this.cell[e]&&(this.cell[e]=[]),void 0===this.cell[e][t]&&(this.cell[e][t]=[]),""===n&&(n=null),void 0===this.cell[e][t][r]?this.cell[e][t][r]={v:n}:this.cell[e][t][r].v=n)}},{key:"toggleCacheStatus",value:function(e){this.cacheStatus=e}},{key:"getCacheStatus",value:function(){return this.cacheStatus}},{key:"addLongTimeNode",value:function(e){this.longTime.push(e)}},{key:"getLongTimeNodeList",value:function(){return this.longTime}},{key:"setCell",value:function(e,t,r,n){if(this.cacheStatus){var a=this.cell[e];void 0===a&&(a=this.cell[e]=[]),void 0===a[t]&&(a[t]=[]),void 0===a[t][r]?a[t][r]={n:n}:a[t][r].n=n}}},{key:"getCell",value:function(e,t,r){if(this.cacheStatus){var n=this.cell[e],a=n&&n[t];return a&&a[r]&&a[r].n}}},{key:"deleteCell",value:function(e,t,r){this.cell[e]&&this.cell[e][t]&&this.cell[e][t][r]&&delete this.cell[e][t][r]}},{key:"addAsyncFunctionNodeList",value:function(e){this.asyncFuncNodeList.push(e)}},{key:"getAsyncFunctionNodeList",value:function(){return this.asyncFuncNodeList}},{key:"cleanAsyncFunctionNodeList",value:function(){this.asyncFuncNodeList&&this.asyncFuncNodeList.length>0&&(this.asyncFuncNodeList=[])}},{key:"startCalc",value:function(){this.rangeCache={}}},{key:"longTimeToString",value:function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,o=this.getLongTimeNodeList().sort(function(e,t){return t.time-e.time}),i=(e={},(0,a.default)(e,u.CALCULATE,"color:red"),(0,a.default)(e,u.PARSE,"color:blue"),(0,a.default)(e,u.MINI_AST,"color:red"),e),s=(t={},(0,a.default)(t,u.CALCULATE,0),(0,a.default)(t,u.PARSE,0),(0,a.default)(t,u.MINI_AST,0),t),l=!0,d=!1,c=void 0;try{for(var h,f=(0,n.default)(o);!(l=(h=f.next()).done);l=!0){var m=h.value;s[m.type]+=m.time,m.time>r&&(console.info("%c -------"+m.type+"-----------------------------------------------------------------",i[m.type]),console.info("\u8282\u70b9\u7c7b\u578b\uff1a %c "+m.nodeType,i[m.type]),console.info("\u6d88\u8017\u65f6\u95f4\uff1a %c "+m.time,i[m.type]))}}catch(p){d=!0,c=p}finally{try{!l&&f.return&&f.return()}finally{if(d)throw c}}console.info("%c ----\u9996\u5c4f\u52a0\u8f7d----","color:green"),console.info("%c \u5feb\u901f\u89e3\u6790\u8017\u65f6 "+s[u.MINI_AST],"color:green"),console.info("%c \u89e3\u6790\u8017\u65f6 "+s[u.PARSE],"color:green"),console.info("%c \u8ba1\u7b97\u8017\u65f6 "+s[u.CALCULATE],"color:green")}}]),e}();l.REPORT_TYPE=u,l.asyncFunctions={STOCK:!0}},416:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=k(r(226)),a=k(r(9)),o=k(r(31)),i=k(r(0)),s=k(r(1)),u=k(r(40)),l=k(r(17)),d=r(48),c=k(r(1453)),h=r(44),f=k(r(11)),m=k(r(60)),p=k(r(43)),R=k(r(67)),g=k(r(220)),v=k(r(29)),N=k(r(18)),T=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(435)),y=k(r(32)),C=r(415),E=(k(r(749)),k(r(1598))),I=r(70),A=r(174),S=r(1599),w=k(r(1600)),M=k(r(39)),F=k(r(1601)),x=r(437),O=r(55);function k(e){return e&&e.__esModule?e:{default:e}}var D=function(){function e(t){var r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=n.isPreview,d=void 0!==s&&s,p=n.previewMainThreadWorker;(0,i.default)(this,e),this.countRows=function(e){if(!e||"string"!==typeof e)throw new Error("\u83b7\u53d6\u884c\u6570\u91cf\u5fc5\u987b\u8981\u63d0\u4f9b sheetId");var t=r.getSheetBySheetId(e);return t?t.isLoaded?t.getRowCount():E.default.getMaxRowsBySheetId(e):0},this.countCols=function(e){if(!e||"string"!==typeof e)throw new Error("\u83b7\u53d6\u5217\u6570\u91cf\u5fc5\u987b\u8981\u63d0\u4f9b sheetId");var t=r.getSheetBySheetId(e);return t?t.isLoaded?t.getColCount():E.default.getMaxColsBySheetId(e):0},this.getActiveSheetId=function(){return r.spreadsheet.getActiveSheetId()},this.getSheetBySheetId=function(e){return e=e||r.currentSheetId,r.spreadsheet.getSheetBySheetId(e)},this.getSheetIdBySheetName=function(e){var t=r.spreadsheet.getSheetBySheetTitle(e);return t?t.getSheetId():""},this.getSheetIdsAmongTwoSheets=function(e,t){return r.spreadsheet.getSheetIdsAmongTwoSheets(e,t)},this.getCellData=function(e,t,n){var a=r.getSheetBySheetId(n);return a?a.getCellDataAtPosition(e,t):null},this.getRealCellValue=function(e,t,n){if(!n||"string"!==typeof n)throw new Error("\u83b7\u53d6 cellValue \u5fc5\u987b\u8981\u63d0\u4f9b sheetId");var a=r.getSheetBySheetId(n);if(a&&a.isLoaded){var o=a.getCellDataAtPosition(e,t)||null;if(!o)return null;var i=o.getEffectiveValue();return i&&void 0!==i.value?i.value:null}return null},this.getCellEditValue=function(e,t,n){if(!n||"string"!==typeof n)throw new Error("\u83b7\u53d6 cellEditValue \u5fc5\u987b\u8981\u63d0\u4f9b sheetId");var a=r.getSheetBySheetId(n);if(a&&a.isLoaded){var o=a.getCellDataAtPosition(e,t)||null;return o?o.getEditValue():null}return null},this.getRealCellFormat=function(e,t,n){if(!n||"string"!==typeof n)throw new Error("\u83b7\u53d6 cellFormat \u5fc5\u987b\u8981\u63d0\u4f9b sheetId");var a=r.getSheetBySheetId(n);if(a&&a.isLoaded){var o=a.getCellDataAtPosition(e,t)||null;if(!o)return null;var i=(0,O.getExportFormat)(o);return i?i.getNumberFormat():null}var s=r.formulaGraph.getItemByRowCol(e,t,n);return(0,h.isCrossSheetNode)(s)?s.renderNumberFormat:null},this.getSetRangeMutationsFromCells=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[],i={},s=t.formulaOnly,u=void 0!==s&&s;e.forEach(function(e){if(!e.customType){var t=r.getCellDataDeltaByGraphFormulaNode(e,{formulaOnly:u});if(t){var n=e.sheetId,a=e.row,o=e.col,s={rowIndex:a,colIndex:o,cellDataDelta:t};if(i[n]){var l=i[n];l.cellDataDeltaAtPositions.push(s),l.minRow=Math.min(l.minRow,a),l.maxRow=Math.max(l.maxRow,a),l.minCol=Math.min(l.minCol,o),l.maxCol=Math.max(l.maxCol,o)}else i[n]={cellDataDeltaAtPositions:[s],minCol:o,minRow:a,maxRow:a,maxCol:o}}}});var l=!0,d=!1,c=void 0;try{for(var h,m=(0,o.default)((0,a.default)(i));!(l=(h=m.next()).done);l=!0){var p=h.value,g=i[p],v=g.minRow,N=g.minCol,T=g.maxRow,y=g.maxCol,C=g.cellDataDeltaAtPositions,E=new R.default({gridRange:new f.default(p,v,T,N,y),cellDataDeltaAtPositions:C});n.push(E)}}catch(I){d=!0,c=I}finally{try{!l&&m.return&&m.return()}finally{if(d)throw c}}return n},this.isGridRangeInVisbleArea=function(e){var t=r.visibleArea;return!!t&&(e.sheetId===t.sheetId&&(e.startRowIndex>=t.frozenRowStart&&e.endRowIndex<=t.frozenRowEnd&&e.startColIndex>=t.frozenColStart&&e.endColIndex<=t.frozenColEnd||e.startRowIndex>=t.flowRowStart&&e.endRowIndex<=t.flowRowEnd&&e.startColIndex>=t.flowColStart&&e.endColIndex<=t.flowColEnd))},this.keyframeHandler=function(e){T.generateFromKeyFrameStart();var t=e.sType,n=e.sheetId,a="preview"===t;if(a===r.isPreview){a&&r.isPreview&&(r.spreadsheet=r.parent.preview.previewsheet,r.resetSheet(n));var o=r.formulaGraph;r.sheetFormulaLayerStatusMap.isSheetLoaded(n)||r.sheetFormulaLayerStatusMap.setWaitingStart(n);var i=r.getSheetBySheetId(n);if(i)i.data.rowData.forEach(function(e,t){e&&e.values.forEach(function(e,a){if(e){var i=e.getFormula(),s=e.getEffectiveValue(),u=e.getUserEnteredFormat(),l=u&&u.getDataValidation();if(l&&r.dataValidationApi.add(l,new f.default(n,t,t,a,a)),i){var d=i.toString(t,a);if(d){var c={row:t,col:a,id:(0,h.getGraphNodeIdByRowCol)(t,a,n),sheetId:n,formulaModel:i,needRecalculate:!0};o.addNodeValueAndGenerateDependency(c)}else{var m={formula:null,gridRange:new f.default(n,t,t,a,a)};s&&s.value instanceof g.default&&(m.effectiveValue="="===d?(0,h.getExtendedValueByString)("="):null);var p=(0,C.getSetCellPropertiesMutationForFormula)(m);r.updateCellDataFromFormula(p)}}else if(s&&s.value instanceof g.default){var R=(0,C.getSetCellPropertiesMutationForFormula)({effectiveValue:null,gridRange:new f.default(n,t,t,a,a)});r.updateCellDataFromFormula(R)}}})}),i.conditionalFormatRuleManager.conditionalFormatRules.forEach(function(e){r.conditionalFormatApi.add(e.index,e.rule)}),T.generateFromKeyFrameEnd()}},this.mutationHandler=function(e){var t=e.mutation,n=e.sheetId,a=e.sType,o=e.isFromFormula,i=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).isFromVirtualCrossSheet,s=void 0!==i&&i;if(!o){var u="preview"===a;if(u===r.isPreview){u&&r.isPreview&&r.sheetFormulaLayerStatusMap.isSheetInitialized(n)&&(r.spreadsheet=r.parent.preview.previewsheet,r.resetSheet(n)),r.sheetFormulaLayerStatusMap.isSheetLoaded(n)||s||r.sheetFormulaLayerStatusMap.setWaitingStart(n);var d=Date.now();switch(t.id){case l.default.SET_RANGE_MUTATION:case l.default.SET_CELL_PROPERTIES_MUTATION:T.setMutationSubscribeTime(d),r.calculateFormulasAfterSetCellPropertiesMutation(t),r.mutationForDataValidation(t);break;case l.default.INSERT_DIMENSION_MUTATION:case l.default.DELETE_DIMENSION_MUTATION:T.setMutationSubscribeTime(d),r.calculateFormulasAfterInsertDeleteDimension(t,{isFromVirtualCrossSheet:s});break;case l.default.MAP_RANGE_MUTATION:T.setMutationSubscribeTime(d),r.calculatedFormulasAfterRowColMove(t,{isFromVirtualCrossSheet:s});break;case l.default.REORDER_RANGE_MUTATION:T.setMutationSubscribeTime(d),r.conditionalFormatApi.clearDirtyRange([t.range]),r.calculatedFormulasAfterRowReorder(t);break;case l.default.INIT_DATA_MUTATION:r.sheetFormulaLayerStatusMap.isSheetWaiting(n)&&(r.sheetFormulaLayerStatusMap.setWaitingDone(n),r.formulaGraph.recalculateAfterInitial(n));break;case l.default.SET_DIMENSION_PROPERTIES_MUTATION:t.operation.some(function(e){return e.slot&I.DIMENSION_PROPERTIES_SLOT.SLOT_HIDDEN})?(T.setMutationSubscribeTime(d),r.calculatedFormulasAfterShowHideDimension(t)):r.sendNoOperationMutationCallBackFromWorker(n);break;case l.default.UPDATE_FILTER_MUTATION:case l.default.DELETE_FILTER_MUTATION:T.setMutationSubscribeTime(d),r.calculatedFormulasAfterUpdateOrDeleteFilterDimension(t);break;case l.default.MERGE_CELLS_MUTATION:T.setMutationSubscribeTime(d),r.calculatedFormulasAfterMergeCells(t);break;case l.default.ADD_CONDITIONAL_FORMAT_MUTATION:r.conditionalFormatApi.add(t.ruleIndex,t.rule);break;case l.default.DELETE_CONDITIONAL_FORMAT_MUTATION:r.conditionalFormatApi.delete(t.ruleIndex,t.oldRuleRanges);break;case l.default.UPDATE_CONDITIONAL_FORMAT_MUTATION:r.conditionalFormatApi.update(t.ruleIndex,t.rule,t.oldRuleRanges);break;default:r.sendNoOperationMutationCallBackFromWorker(n)}}}},this.sendNoOperationMutationCallBackFromWorker=function(e){},this.isCellHidden=function(e,t,n,a){var o=r.getSheetBySheetId(n);return!!o&&r.isSheetCellHidden(o,e,t,a)},this.isInRowColMove=function(){return r.inRowColMove},this.markRowColMove=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];r.inRowColMove=e},this.updateSingleCellFromFormula=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if((0,x.isIE)())return!1;var n=(0,C.getSetCellPropertiesMutationForFormula)(e);return!!n&&r.updateCellDataFromFormula(n,t)},this.updateCellsFromFormula=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r.getSetRangeMutationsFromCells(e,t).forEach(function(e){return r.updateCellDataFromFormula(e)})},this.updateCellDataFromFormula=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.needToSyncInVisibleArea,t.mutationQueueIdRelatedSheetId,t.graphUpdateTimes,t.runInWorker;u.default.spreadsheetEvent.trigger("updateCellDataFromFormula",e);e.gridRange;return!1},this.cellDataHasValue=function(e){for(var t=!0,n=e,a=n.sheetId,o=n.startRowIndex;o<=n.endRowIndex;o++)for(var i=n.startColIndex;i<=n.endColIndex;i++){var s=r.getCellData(o,i,a),u=s&&s.getEffectiveValue(),l=u&&u.value;null!==l&&""!==l&&void 0!==l||(t=!1)}return t},this.mutationForDataValidation=function(e){e.gridRange},this.mainThreadWorker=d&&p||t.spreadsheet.mainThreadWorker,this.parent=t,this.spreadsheet=this.parent.spreadsheet,this.isPreview=d,this.inRowColMove=!1,this.sheetFormulaLayerStatusMap=new S.SheetFormulaLayerStatusMap,this.formulaGraph=new c.default({isPreview:d,getRealCellValue:this.getRealCellValue,getRealCellFormat:this.getRealCellFormat,getCellEditValue:this.getCellEditValue,countRows:this.countRows,countCols:this.countCols,getSheetIdBySheetName:this.getSheetIdBySheetName,getSheetIdsAmongTwoSheets:this.getSheetIdsAmongTwoSheets,isCellHidden:this.isCellHidden,getCellData:this.getCellData,updateSingleCellFromFormula:this.updateSingleCellFromFormula,updateCellsFromFormula:this.updateCellsFromFormula,getActiveSheetId:this.getActiveSheetId,getSheetBySheetId:this.getSheetBySheetId,sheetFormulaLayerStatusMap:this.sheetFormulaLayerStatusMap,sendNoOperationMutationCallBackFromWorker:this.sendNoOperationMutationCallBackFromWorker,isGridRangeInVisbleArea:this.isGridRangeInVisbleArea,isInRowColMove:this.isInRowColMove,getSetRangeMutationsFromCells:this.getSetRangeMutationsFromCells}),this.getResultBySingleFormula=this.formulaGraph.getResultBySingleFormula,this.getItemByRowColOnCurrentSheet=this.formulaGraph.getItemByRowColOnCurrentSheet,this.addCustomFormulaNodeAndGenerateDependency=this.formulaGraph.addCustomFormulaNodeAndGenerateDependency,this.triggerAutoUpdateFormulaUpdate=this.formulaGraph.triggerAutoUpdateFormulaUpdate,this.getUnfinishedCalculationNodesBySheetId=this.formulaGraph.getUnfinishedCalculationNodesBySheetId,this.removeCustomFormulaNode=this.formulaGraph.removeCustomFormulaNode,this.removeCustomFormulaNodeByType=this.formulaGraph.removeCustomFormulaNodeByType,this.dataValidationApi=new w.default({formulaGraph:this.formulaGraph,onUpdateDataValidation:this.onUpdateDataValidation.bind(this),onUpdateCellDataDataValidationResult:this.onUpdateCellDataDataValidationResult.bind(this),onBatchUpdateCellDataDataValidationResult:this.onBatchUpdateCellDataDataValidationResult.bind(this),onBatchUpdateDataValidation:this.onBatchUpdateDataValidation.bind(this),getCellData:this.getCellData.bind(this)}),this.conditionalFormatApi=new F.default({formulaGraph:this.formulaGraph,getConditionalFormatRuleAll:function(e){var t=r.parent.spreadsheet.getSheetBySheetId(e);return t?t.conditionalFormatRuleManager.getConditionalFormatRuleAll():[]},onUpdateConditionalFormat:this.onUpdateConditionalFormat.bind(this),onUpdateCellDataConditionalFormatResult:this.onUpdateCellDataConditionalFormatResult.bind(this),onBatchUpdateCellDataConditionalFormatResult:this.onBatchUpdateCellDataConditionalFormatResult.bind(this)}),m.default.bindCustomMethod({parse:this.formulaGraph.plugin.parse,getSheetNameBySheetId:this.getSheetNameBySheetId.bind(this),isSheetAmongTwoSheets:this.spreadsheet.isSheetAmongTwoSheets.bind(this.spreadsheet),getSheetIdBySheetIndex:this.spreadsheet.getSheetIdBySheetIndex.bind(this.spreadsheet),getSheetIndexBySheetId:this.spreadsheet.getSheetIndexBySheetId.bind(this.spreadsheet)}),this.subscribe()}return(0,s.default)(e,[{key:"destroy",value:function(){u.default.spreadsheetEvent.remove("afterMutationRun",this.mutationHandler),u.default.spreadsheetEvent.remove("afterKeyframeRun",this.keyframeHandler),this.formulaGraph.destroy()}},{key:"subscribe",value:function(){u.default.spreadsheetEvent.listen("afterMutationRun",this.mutationHandler),u.default.spreadsheetEvent.listen("afterKeyframeRun",this.keyframeHandler),this.bindVisbileAreaMonitor()}},{key:"bindVisbileAreaMonitor",value:function(){var e=this,t=this.spreadsheet.parent;(0,h.waitUntil)(function(){return t.view.canvas.excel},function(){var r=t.view.canvas.excel;r.event.eventTable.listen("afterRender",(0,A.throttle)(function(){var t=r.areaData,n=t.row,a=n.frozen,o=a.from,i=a.to,s=n.flow,u=s.from,l=s.to,d=t.col,c=d.frozen,h=c.from,f=c.to,m=d.flow,p={frozenRowStart:o,frozenRowEnd:i,flowRowStart:u,flowRowEnd:l,frozenColStart:h,frozenColEnd:f,flowColStart:m.from,flowColEnd:m.to,sheetId:e.currentSheetId};e.mainThreadWorker.sheetData.syncVisibleAreaToWorker({visibleArea:p})},1e3,e,!0))})}},{key:"calculateFormulasAfterInsertDeleteDimension",value:function(e,t){var r=t.isFromVirtualCrossSheet,n=void 0!==r&&r,a=this.formulaGraph,o=e.amount,i=e.index,s=e.sheetId,u=e.type,d=e.id===l.default.INSERT_DIMENSION_MUTATION,c=u.toLowerCase().indexOf("row")>-1;d?a.updateGraphAfterRowColAdd({index:i,amount:o,isRow:c,sheetId:s,isFromVirtualCrossSheet:n}):(a.updateGraphAfterRowColDel({index:i,amount:o,isRow:c,sheetId:s,isFromVirtualCrossSheet:n}),this.inRowColMove=!1)}},{key:"calculatedFormulasAfterRowColMove",value:function(e,t){for(var r=t.isFromVirtualCrossSheet,n=void 0!==r&&r,a=this.formulaGraph,o=e.row,i=e.column,s=-1!==o.to,u=s?o:i,l=u.from,d=l.startIndex,c=l.endIndex,h=u.destinationSheetId,f=u.sourceSheetId,m=u.to,p={},R=c,g=d,v=d,N=0;v<=c;v++,N++){var T=m+N;p[v]={num:T,destinationSheetId:h,sourceSheetId:f},g=Math.min(T,g),R=Math.max(T,R)}a.updateGraphAfterRowColCutMove({migrationMap:p,sourceSheetId:f,isRow:s,isFromVirtualCrossSheet:n,upperBoundOfAffectedArea:R,lowerBoundOfAffectedArea:g})}},{key:"calculatedFormulasAfterRowReorder",value:function(e){var t=this.formulaGraph,r=e.operation.rules,a=e.sheetId,o=e.range,i=o.endColIndex,s=o.startColIndex,u=-1,l=-1,d=(0,n.default)(r||{}).reduce(function(e,t){var r=t.from,n=t.to;return u=-1===u?r:Math.min(u,r),l=-1===l?r:Math.max(l,r),e[r]={num:n,destinationSheetId:a,sourceSheetId:a},e},{});t.updateGraphAfterRowReorder({migrationMap:d,sourceSheetId:a,endColIndex:i,startColIndex:s,minRow:u,maxRow:l})}},{key:"calculateFormulasAfterSetCellPropertiesMutation",value:function(e){var t=this,r=e.gridRange,n=r.sheetId,a=e instanceof R.default?e.cellDataDeltaAtPositions:[],o=[];if(e instanceof p.default)for(var i=e.cellDataDelta,s=r.startRowIndex;s<=r.endRowIndex;s++)for(var u=r.startColIndex;u<=r.endColIndex;u++)a.push({rowIndex:s,colIndex:u,cellDataDelta:i});return a.forEach(function(e){var r=e.cellDataDelta,a=e.rowIndex,i=e.colIndex,s=t.getFormulaModelByRowCol(a,i,n);(s||t.doesCellDataDeltaChangeFormulaLayer({cellDataDelta:r,rowIndex:a,colIndex:i,sheetId:n}))&&o.push({id:(0,h.getGraphNodeIdByRowCol)(a,i,n),row:a,col:i,newValue:s,sheetId:n})}),this.formulaGraph.updateGraphAfterNodesChange(o,n)}},{key:"calculatedFormulasAfterShowHideDimension",value:function(e){var t=e.sheetId,r=e.ranges;this.formulaGraph.updateGraphAfterShowHideDimension({ranges:r,sheetId:t})}},{key:"calculatedFormulasAfterUpdateOrDeleteFilterDimension",value:function(e){var t=e.sheetId;this.formulaGraph.updateGraphAfterFilterDimension(t)}},{key:"calculatedFormulasAfterMergeCells",value:function(e){for(var t=e.sheetId,r=e.startRowIndex,n=e.endRowIndex,a=e.startColIndex,o=e.endColIndex,i=[],s=r;s<=n;s++)for(var u=a;u<=o;u++){var l=this.getCellData(s,u,t),d=l&&l.getFormula();i.push({id:(0,h.getGraphNodeIdByRowCol)(s,u,t),row:s,col:u,newValue:d,sheetId:t})}this.formulaGraph.updateGraphAfterNodesChange(i,t)}},{key:"doesCellDataDeltaChangeFormulaLayer",value:function(e){var t=e.cellDataDelta,r=e.rowIndex,n=e.colIndex,a=e.sheetId,o=this.formulaGraph.getNodeRelationByRowCol(r,n,a),i=o.formulaNodeOrVoid,s=o.hasRelatedNode;if(i&&t.clearSlots&1<<N.default.SLOT_FORMULA)return!0;if(t.setSlots&1<<N.default.SLOT_FORMULA)return!0;if(!s)return!1;if(t.clearSlots&1<<N.default.SLOT_EFFIECTIVE_VALUE)return!0;if(t.setSlots&1<<N.default.SLOT_EFFIECTIVE_VALUE)return!0;var u=t.delta.userEnteredFormatDelta;if(u){if(u.clearSlots&1<<y.default.NUMBER_FORMAT)return!0;if(u.setSlots&1<<y.default.NUMBER_FORMAT)return!0}return!1}},{key:"getSheetNameBySheetId",value:function(e){var t=this.getSheetBySheetId(e);return t?t.getTitle():""}},{key:"getInvertMutationsForDeleteDimensionMutation",value:function(e){var t=this.formulaGraph,r=e.amount,n=e.index,a=e.sheetId,o=e.type.toLowerCase().indexOf("row")>-1,i=t.getDirectImpactFormulaNodeFromRowColDel({index:n,amount:r,isRow:o,sheetId:a});return this.getInvertMutationsFromGraphFormulaNodes(i)}},{key:"getInvertMutationsForRowReorderMutation",value:function(e){var t=this.formulaGraph,r=e.operation.rules,n=e.sheetId,a=this.getMigrationMapForRowReorderFromRules({rules:r,sheetId:n}),o=t.getDirectImpactFormulaNodeFromRowReorder({migrationMap:a,sheetId:n});return this.getInvertMutationsFromGraphFormulaNodes(o)}},{key:"isSheetCellHidden",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"ALL",a=e.data,o=a.rowMetadata,i=a.columnMetadata,s=o?o[t]:null,u=i?i[r]:null,l=!1;return s&&(l="ALL"===n?s.hiddenByUser||s.hiddenByFilter:"USER"===n?s.hiddenByUser:"FILTER"===n&&s.hiddenByFilter),!l&&u&&(u.hiddenByUser||u.hiddenByFilter)&&(l="ALL"===n?u.hiddenByUser||u.hiddenByFilter:"USER"===n?u.hiddenByUser:"FILTER"===n&&u.hiddenByFilter),l}},{key:"resetSheet",value:function(e){this.mainThreadWorker.sheetData.resetSheetOnWorkerFormula({sheetId:e}),this.sheetFormulaLayerStatusMap.resetSheet(e),this.formulaGraph.resetSheet(e)}},{key:"getCellDataDeltaByGraphFormulaNode",value:function(e,t){var r=t.formulaOnly,n=e.sheetId,a=e.formulaModel;if(!e.customType&&this.getSheetBySheetId(n)){var o=new v.default;if(!r){var i=e.effectiveFormatNumberFormat,s=e.userEnteredNumberFormat,u=(0,h.getExtendedValueByFormulaNode)(e);return(0,C.getCellDataDeltaForFormula)({effectiveValue:u,effectiveFormatNumberFormat:i,userEnteredNumberFormat:s})}return a?(o.setSlot(N.default.SLOT_FORMULA,a),o):void 0}}},{key:"getFormulaModelByRowCol",value:function(e,t,r){var n=this.getCellData(e,t,r),a=n&&n.getFormula();if(!a){var o=n&&n.getEffectiveValue();if(o&&"string"===typeof o.value&&(0,h.isFormula)(o.value)){var i=n&&n.getUserEnteredFormat();if(!(i&&(0,d.isTextCell)(i.getNumberFormat()))){var s=o.value;a=m.default.string2FormulaModel(s,e,t,r);var u=(0,C.getSetCellPropertiesMutationForFormula)({formula:a,gridRange:new f.default(r,e,e,t,t)});this.updateCellDataFromFormula(u)}}}return a}},{key:"getMigrationMapForRowReorderFromRules",value:function(e){var t=e.rules,r=e.sheetId;return(0,n.default)(t||{}).reduce(function(e,t){var n=t.from,a=t.to;return e[n]={num:a,destinationSheetId:r,sourceSheetId:r},e},{})}},{key:"getInvertMutationsFromGraphFormulaNodes",value:function(e){var t=this;return e.reduce(function(e,r){var n=r.row,a=r.col,o=r.sheetId;if(r.customType)return[];var i=t.getCellData(n,a,o),s=i&&i.getFormula(),u=s?m.default.string2FormulaModel(s.toString(n,a),n,a,o):s,l=new v.default;l.setSlot(N.default.SLOT_FORMULA,u);var d=new p.default({gridRange:new f.default(o,n,n,a,a),cellDataDelta:l});return e.push(d),e},[])}},{key:"onUpdateConditionalFormat",value:function(e,t,r,n){}},{key:"onUpdateCellDataConditionalFormatResult",value:function(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=new p.default({gridRange:new f.default(e,t,t,r,r),cellDataDelta:n?new v.default({setSlots:1<<N.default.SLOT_CONDITIONAL_FORMAT_DELTA,clearSlots:0,delta:{conditionalFormatResult:n}}):new v.default({setSlots:0,clearSlots:1<<N.default.SLOT_CONDITIONAL_FORMAT_DELTA})});"string"!==typeof a.mutationQueueIdRelatedSheetId&&this.parent.behavior.applyMutation(o,{isLocal:!0,isFromFormula:!0})}},{key:"onBatchUpdateCellDataConditionalFormatResult",value:function(e){var t=e[0].sheetId,r=new R.default({gridRange:new f.default(t,0,this.countRows(t)-1,0,this.countCols(t)-1),cellDataDeltaAtPositions:e.map(function(e){return{rowIndex:e.row,colIndex:e.col,cellDataDelta:e.conditionalFormatResult?new v.default({setSlots:1<<N.default.SLOT_CONDITIONAL_FORMAT_DELTA,clearSlots:0,delta:{conditionalFormatResult:e.conditionalFormatResult}}):new v.default({setSlots:0,clearSlots:1<<N.default.SLOT_CONDITIONAL_FORMAT_DELTA})}})});"string"!==typeof e[0].options.mutationQueueIdRelatedSheetId&&this.parent.behavior.applyMutation(r,{isLocal:!0,isFromFormula:!0})}},{key:"onBatchUpdateCellDataDataValidationResult",value:function(e){var t=e[0].sheetId,r=new R.default({gridRange:new f.default(t,0,this.countRows(t)-1,0,this.countCols(t)-1),cellDataDeltaAtPositions:e.map(function(e){return{rowIndex:e.row,colIndex:e.col,cellDataDelta:null!=e.isDataValid?new v.default({setSlots:1<<N.default.SLOT_IS_DATA_VALID,clearSlots:0,delta:{isDataValid:e.isDataValid}}):new v.default({setSlots:0,clearSlots:1<<N.default.SLOT_IS_DATA_VALID})}})});"string"!==typeof e[0].options.mutationQueueIdRelatedSheetId&&this.parent.behavior.applyMutation(r,{isLocal:!0,isFromFormula:!0})}},{key:"onUpdateCellDataDataValidationResult",value:function(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=new v.default,i=new f.default(e,t,t,r,r);if(this.cellDataHasValue(i)){o.setSlot(N.default.SLOT_IS_DATA_VALID,n);var s=new p.default({gridRange:i,cellDataDelta:o});"string"!==typeof a.mutationQueueIdRelatedSheetId&&this.parent.behavior.applyMutation(s,{isLocal:!0,isFromFormula:!0})}}},{key:"onBatchUpdateDataValidation",value:function(e){var t=e[0].sheetId,r=new R.default({gridRange:new f.default(t,0,this.countRows(t)-1,0,this.countCols(t)-1),cellDataDeltaAtPositions:e.map(function(e){var t=e.row,r=e.col,n=e.dataValidation,a=new v.default,o=new M.default;return o.setSlot(y.default.DATA_VALIDATION,n),a.setSlot(N.default.SLOT_USER_ENTERED_FORMAT_DELTA,o),{rowIndex:t,colIndex:r,cellDataDelta:a}})});"string"!==typeof e[0].options.mutationQueueIdRelatedSheetId&&this.parent.behavior.applyMutation(r,{isLocal:!0,isFromFormula:!0})}},{key:"onUpdateDataValidation",value:function(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=new v.default,i=new f.default(e,t,t,r,r),s=new M.default;s.setSlot(y.default.DATA_VALIDATION,n),o.setSlot(N.default.SLOT_USER_ENTERED_FORMAT_DELTA,s);var u=new p.default({gridRange:i,cellDataDelta:o});"string"!==typeof a.mutationQueueIdRelatedSheetId&&this.parent.behavior.applyMutation(u,{isLocal:!0,isFromFormula:!0})}},{key:"currentSheet",get:function(){return this.spreadsheet.activeSheet}},{key:"currentSheetId",get:function(){return this.spreadsheet.getActiveSheetId()}},{key:"currentSheetTitle",get:function(){return this.spreadsheet.activeSheet.getTitle()}}]),e}();t.default=D},435:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.calculateSingleDurationForTdw=void 0;var n,a=c(r(16)),o=c(r(9)),i=c(r(31)),s=c(r(14)),u=c(r(83));t.getFormulaPerformence=y,t.setFormulaPerformence=function(e,t){void 0===N[e]&&(N[e]={asyncFormulaCount:0,formulaCount:0,calculateCount:0,nodeSortDuration:0,parseDuration:0,calculateDuration:0,calculateSingleDuration:0,inheritFormatDuration:0,formatDuration:0,syncMutationDuration:0,resultToSpreadsheetDuration:0,syncRangeResultDuration:0});N[e]=(0,s.default)({},N[e],t)},t.clearFormulaPerformence=C,t.setUpdateTimeForOpenSheet=function(e,t){T[e]=t},t.setTimeWhenBuildGraphEndForOpenSheet=function(){E=Date.now()},t.getTimeWhenBuildGraphEndForOpenSheet=function(){return E},t.setMutationSubscribeTime=function(e){v.mutationSubscribeTime=e||Date.now()},t.getAndResetMutationSubscribeTime=function(){var e=v.mutationSubscribeTime;return v.mutationSubscribeTime=0,e},t.generateFromKeyFrameStart=function(){v.generateFromKeyFrameStart=Date.now()},t.generateFromKeyFrameEnd=function(){v.generateFromKeyFrameEnd=Date.now();var e=v.generateFromKeyFrameEnd-v.generateFromKeyFrameStart;I((0,u.default)({},p.INIT_KEYFRAME_PARSE,e))},t.updateGraphEnd=function(e){var t=e.mutationSubscribeTime,r=e.isInitSheet;if(!e.isAfterMutationRun||r)return;if(v.mutationsCount=v.mutationsCount+1,v.mutationsCount>=2)return;if(0!==t){var n=Date.now(),a=n-t;I((0,u.default)({},p.ONE_PACK_GRAPH,a))}},t.updateGraphFromNodes=function(e){var t=e.calculateDuration,r=e.graphUpdateTimes,n=e.isInitSheet,a=e.mutationSubscribeTime,o=e.isAfterMutationRun;try{if(n)return;if(!o)return void C(r);if(v.mutationsCount>=2)return void(v.mutationsCount=v.mutationsCount-1);v.mutationsCount=v.mutationsCount-1;var i=y(r),s=i.asyncFormulaCount>0;if(s)return void C(r);if(i.calculateCount>0){var l=i.parseDuration/i.calculateCount,d=i.calculateDuration/i.calculateCount,c=i.calculateSingleDuration/i.calculateCount;I((0,u.default)({},p.EDIT_EVERY_PARSE,l)),I((0,u.default)({},p.EDIT_EVERY_RUN,d)),I((0,u.default)({},p.FUNC_CALCULATESINGLECELLFORMULA,c))}if(I((0,u.default)({},p.ONE_PACK_PARSE,i.parseDuration)),I((0,u.default)({},p.ONE_PACK_CALC,t)),0!==a){var h=Date.now(),f=h-a;I((0,u.default)({},p.ONE_PACK_MUTATION_RUN,f))}C(r)}catch(m){return}},t.openSheetReport=function(e){var t,r=e.hasFormula,n=e.graphAndCalculateDuration,a=e.buildGraphDuration,o=e.calculateDuration,i=e.sheetId,l=T[i];if(!l)return;if(!r)return void C(l);var d=y(l);if(0===d.asyncFormulaCount){var c;I((c={},(0,u.default)(c,p.INIT_GRAPH_AND_CALC,n),(0,u.default)(c,p.INIT_CALC,o),c)),f.formulaReportInfo["[\u51fd\u6570]\u51fd\u6570\u6a21\u5757\u603b\u65f6\u95f4"]=n,f.formulaReportInfo["[\u51fd\u6570]\u51fd\u6570\u8ba1\u7b97\u65f6\u95f4"]=o}if(I((t={},(0,u.default)(t,p.INIT_GRAPH,a),(0,u.default)(t,p.INIT_SORT,d.nodeSortDuration),(0,u.default)(t,p.INIT_PARSE,d.parseDuration),(0,u.default)(t,p.INIT_RUN,d.calculateDuration),(0,u.default)(t,p.INIT_INHERIT_FORMA,d.inheritFormatDuration),(0,u.default)(t,p.INIT_FORMAT,d.formatDuration),(0,u.default)(t,p.INIT_SYNCMUTATION,d.syncMutationDuration),(0,u.default)(t,p.INIT_RESULTTOSPREADSHEET,d.resultToSpreadsheetDuration),(0,u.default)(t,p.INIT_SYNCRANGERESULT,d.syncRangeResultDuration),t)),f.formulaReportInfo["[\u51fd\u6570]\u4f9d\u8d56\u56fe\u6784\u5efa\u65f6\u95f4"]=a,f.formulaReportInfo["[\u51fd\u6570]\u76ee\u6807\u8282\u70b9\u6392\u5e8f\u65f6\u95f4"]=d.nodeSortDuration,f.formulaReportInfo["[\u51fd\u6570]\u51fd\u6570\u89e3\u6790\u65f6\u95f4"]=d.parseDuration,f.formulaReportInfo["[\u51fd\u6570]\u51fd\u6570\u8fd0\u884c\u65f6\u95f4"]=d.calculateDuration,0===d.asyncFormulaCount){A({graphAndCalculateDuration:n,buildGraphDuration:a,calculateDuration:o});var h={graphAndCalculateDuration:n,buildGraphDuration:a,calculateDuration:o,formulaCount:d.formulaCount,calculateCount:d.calculateCount,nodeSortDuration:d.nodeSortDuration,parseDuration:d.parseDuration,calculateSingleDuration:d.calculateSingleDuration,inheritFormatDuration:d.inheritFormatDuration,formatDuration:d.formatDuration,syncMutationDuration:d.syncMutationDuration,resultToSpreadsheetDuration:d.resultToSpreadsheetDuration,syncRangeResultDuration:d.syncRangeResultDuration};S(h),(0,s.default)(f.formulaReportInfo,h)}C(l)},t.openSheetMonitrorReport=A,t.openSheetTdwReport=S,t.longCalculateFormula=function(e){var t=e.formula,r=e.calculateSingleDuration;f.reportProxy.tdwReport({opername:"doc_excel",module:"formula_worker",action:"long_calculate_formula",ver5:(0,a.default)({formula:t,calculateSingleDuration:r})})},t.addFormulaError=function(e,t){w[e]?w[e].push(t):w[e]=[t]},t.reportAllFormulaErrorInfo=function(e){var t=e.isInitSheet,r=(0,o.default)(w);if(0===r.length)return;var n=r.reduce(function(e,t){return e[t]=w[t].length,e},{});r.map(function(e){w[e].length>M&&(w[e]=w[e].slice(0,M))}),f.reportProxy.tdwReport({opername:"doc_excel",module:"formula_worker",action:"error_type_new",ver5:(0,a.default)({reportFormulaError:w,isInitSheet:t,errorTypeCount:n})}),w={}},t.addFormulaParserError=function(e){F.push(e)},t.reportAllFormulaParserErrorInfo=function(e){var t=e.isInitSheet,r=F.length;if(0===r)return;r>x&&(F=F.slice(0,x));f.reportProxy.tdwReport({opername:"doc_excel",module:"formula_worker",action:"parser_error",ver5:(0,a.default)({reportFormulaParserError:F,isInitSheet:t,reportLength:r})}),F=[]};var l=c(r(12)),d=r(22);function c(e){return e&&e.__esModule?e:{default:e}}var h,f=window,m=f.location.href.indexOf("showLog=1")>=0;!function(e){e.PC="PC",e.ANDROID="Android",e.IOS="IOS"}(h||(h={})),f.formulaReportInfo={};var p={INIT_KEYFRAME_PARSE:90,INIT_GRAPH_AND_CALC:91,INIT_GRAPH:92,INIT_CALC:93,INIT_SORT:94,INIT_PARSE:95,INIT_RUN:96,INIT_INHERIT_FORMA:109,INIT_FORMAT:110,INIT_SYNCMUTATION:111,INIT_RESULTTOSPREADSHEET:112,INIT_SYNCRANGERESULT:113,ONE_PACK_MUTATION_RUN:103,ONE_PACK_CALC:104,ONE_PACK_GRAPH:105,ONE_PACK_PARSE:106,EDIT_EVERY_PARSE:107,EDIT_EVERY_RUN:108,FUNC_CALCULATESINGLECELLFORMULA:48},R={90:"INIT_KEYFRAME_PARSE",91:"INIT_GRAPH_AND_CALC",92:"INIT_GRAPH",93:"INIT_CALC",94:"INIT_SORT",95:"INIT_PARSE",96:"INIT_RUN",109:"INIT_INHERIT_FORMA",110:"INIT_FORMAT",111:"INIT_SYNCMUTATION",112:"INIT_RESULTTOSPREADSHEET",113:"INIT_SYNCRANGERESULT"},g=(n={},(0,u.default)(n,p.INIT_KEYFRAME_PARSE,"[\u6253\u5f00][\u51fd\u6570][worker]keyframe\u89e3\u6790\u6784\u56fe\u65f6\u95f4"),(0,u.default)(n,p.INIT_GRAPH_AND_CALC,"[\u6253\u5f00][\u51fd\u6570][worker]\u51fd\u6570\u6a21\u5757\u603b\u65f6\u95f4"),(0,u.default)(n,p.INIT_GRAPH,"[\u6253\u5f00][\u51fd\u6570][worker]\u4f9d\u8d56\u56fe\u6784\u5efa\u65f6\u95f4"),(0,u.default)(n,p.INIT_CALC,"[\u6253\u5f00][\u51fd\u6570][worker]\u51fd\u6570\u8ba1\u7b97\u65f6\u95f4"),(0,u.default)(n,p.INIT_SORT,"[\u6253\u5f00][\u51fd\u6570][worker]\u76ee\u6807\u8282\u70b9\u6392\u5e8f\u65f6\u95f4"),(0,u.default)(n,p.INIT_PARSE,"[\u6253\u5f00][\u51fd\u6570][worker]\u51fd\u6570\u89e3\u6790\u65f6\u95f4"),(0,u.default)(n,p.INIT_RUN,"[\u6253\u5f00][\u51fd\u6570][worker]\u51fd\u6570\u8fd0\u884c\u65f6\u95f4"),(0,u.default)(n,p.ONE_PACK_MUTATION_RUN,"[\u7f16\u8f91][\u51fd\u6570][worker]\u6536\u5230mutation\u5230\u7ed3\u675f"),(0,u.default)(n,p.ONE_PACK_CALC,"[\u7f16\u8f91][\u51fd\u6570][worker]\u5355\u6279\u6b21\u8ba1\u7b97\u65f6\u95f4"),(0,u.default)(n,p.ONE_PACK_GRAPH,"[\u7f16\u8f91][\u51fd\u6570][worker]\u5355\u6279\u6b21\u56fe\u66f4\u65b0\u65f6\u95f4"),(0,u.default)(n,p.ONE_PACK_PARSE,"[\u7f16\u8f91][\u51fd\u6570][worker]\u5355\u6279\u6b21\u51fd\u6570\u89e3\u6790\u65f6\u95f4"),(0,u.default)(n,p.EDIT_EVERY_PARSE,"[\u7f16\u8f91][\u51fd\u6570][worker]\u5355\u4e2a\u51fd\u6570\u89e3\u6790\u65f6\u95f4"),(0,u.default)(n,p.EDIT_EVERY_RUN,"[\u7f16\u8f91][\u51fd\u6570][worker]\u5355\u4e2a\u51fd\u6570\u8fd0\u884c\u65f6\u95f4"),(0,u.default)(n,p.FUNC_CALCULATESINGLECELLFORMULA,"[\u7f16\u8f91][\u51fd\u6570]\u5173\u952e\u51fd\u6570calculateSingleCellFormula"),(0,u.default)(n,p.INIT_INHERIT_FORMA,"[\u6253\u5f00][\u51fd\u6570][worker]\u51fd\u6570\u683c\u5f0f\u7ee7\u627f\u65f6\u95f4"),(0,u.default)(n,p.INIT_FORMAT,"[\u6253\u5f00][\u51fd\u6570][worker]\u51fd\u6570\u7ed3\u679c\u683c\u5f0f\u5316\u65f6\u95f4"),(0,u.default)(n,p.INIT_SYNCMUTATION,"[\u6253\u5f00][\u51fd\u6570][worker]\u51fd\u6570\u6570\u636e\u5e8f\u5217\u5316\u548c\u540c\u6b65\u7ed9\u4e3b\u7ebf\u7a0b\u65f6\u95f4"),(0,u.default)(n,p.INIT_RESULTTOSPREADSHEET,"[\u6253\u5f00][\u51fd\u6570][worker]\u51fd\u6570\u7ed3\u679c\u66f4\u65b0\u5230\u6570\u636e\u5c42\u65f6\u95f4"),(0,u.default)(n,p.INIT_SYNCRANGERESULT,"[\u6253\u5f00][\u51fd\u6570][worker]\u51fd\u6570\u7ed3\u679c\u901a\u8fc7setRange\u8fdb\u884c\u540c\u6b65\u7684\u65f6\u95f4"),n),v=(t.calculateSingleDurationForTdw=30,{mutationSubscribeTime:0,generateFromKeyFrameStart:0,generateFromKeyFrameEnd:0,calculateSingleStart:0,mutationsCount:0}),N={},T={};function y(e){return void 0===N[e]&&(N[e]={asyncFormulaCount:0,formulaCount:0,calculateCount:0,nodeSortDuration:0,parseDuration:0,calculateDuration:0,calculateSingleDuration:0,inheritFormatDuration:0,formatDuration:0,syncMutationDuration:0,resultToSpreadsheetDuration:0,syncRangeResultDuration:0}),N[e]}function C(e){N[e],delete N[e]}var E=void 0;function I(e){l.default.wait(0).run(function(){f.reportProxy.huatuo({appid:20533,flag1:22213,flag2:1,flag3:1,speedTime:e,platform:d.isMobile?d.isAndroid?h.ANDROID:h.IOS:h.PC},!0);var t=!0,r=!1,n=void 0;try{for(var a,s=(0,i.default)((0,o.default)(e));!(t=(a=s.next()).done);t=!0){var u=a.value,l=R[u];l&&(l=l.toLocaleLowerCase(),f.reportProxy.tdwReport({opername:"excel_performance",module:"formula_worker",action:l,ver5:e[u]}))}}catch(C){r=!0,n=C}finally{try{!t&&s.return&&s.return()}finally{if(r)throw n}}if(m){var c=!0,p=!1,v=void 0;try{for(var N,T=(0,i.default)((0,o.default)(e));!(c=(N=T.next()).done);c=!0){var y=N.value;console.warn("%c"+g[y]+": "+e[y],"color: green; font-size: 14px;")}}catch(C){p=!0,v=C}finally{try{!c&&T.return&&T.return()}finally{if(p)throw v}}}})}function A(e){var t=e.graphAndCalculateDuration,r=e.buildGraphDuration,n=e.calculateDuration;var a=0;r>=4e3?a=33614222:r>=3e3?a=33614223:r>=2e3?a=33614234:r>=1e3&&(a=33614235),0!==a&&f.reportProxy.monitor(a);var o=0;n>=4e3?o=33614569:n>=3e3?o=33614570:n>=2e3?o=33614572:n>=1e3&&(o=33614574),0!==o&&f.reportProxy.monitor(o)}function S(e){var t=e.graphAndCalculateDuration,r=e.buildGraphDuration,n=e.calculateDuration,o=e.formulaCount,i=e.calculateCount,s=e.nodeSortDuration,u=e.parseDuration,l=e.calculateSingleDuration,d=e.inheritFormatDuration,c=e.formatDuration,h=e.syncMutationDuration,m=e.resultToSpreadsheetDuration,p=e.syncRangeResultDuration;f.reportProxy.tdwReport({opername:"doc_excel",module:"formula_worker",action:"formula_sheet_open",ver5:(0,a.default)({graphAndCalculateDuration:t,buildGraphDuration:r,calculateDuration:n,formulaCount:o,calculateCount:i,nodeSortDuration:s,parseDuration:u,calculateSingleDuration:l,inheritFormatDuration:d,formatDuration:c,syncMutationDuration:h,resultToSpreadsheetDuration:m,syncRangeResultDuration:p})})}var w={},M=2;var F=[],x=10},44:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.error=t.CURRENT_VALUE_REGARDLESS_OF_VALUE_REG=t.formatChinese=t.noSupportFormulaError=t.noNeedConvertFormula=t.DEFAULT_NUMBER_FORMAT_INFO=void 0;var n=N(r(226)),a=N(r(47)),o=N(r(41)),i=N(r(9)),s=N(r(31)),u=N(r(25)),l=N(r(1094));t.isOperator=function(e){if("("==e||")"==e||"="==e||"<"==e||">"==e||"+"==e||"-"==e||"*"==e||"/"==e||"&"==e||"^"==e||"%"==e||","==e||";"==e||":"==e)return!0;return!1},t.getTwoDigitsNumberString=function(e){return e<10?"0"+e:e},t.addCurrentSymbolToString=function(e,t){var r=0===t.indexOf("-");r&&(t=t.replace("-",""));return(r?"-":"")+e+t},t.addZero=y,t.formatDate=C,t.getStock=function(e,t,r){var n={error:"#ERROR!",result:"#ERROR!",currencyFormat:""},a=(e=e.toString()).split("."),o=a[a.length-1]||"",i=o=o.toLowerCase(),s=a.slice(0,a.length-1).join(".")||"",u=o+s;-1!==["sh","sz"].indexOf(o)&&(o="");(function(e){if(E[e])return E[e];var t=v.default.get(e).then(function(t){return delete E[e],t}).catch(function(t){return delete E[e],t});return E[e]=t,t})("/ifzq/appstock/app/"+o+"fqkline/get?param="+u+",day,,,3,qfq").then(function(e){var a=e.headers.date,o=e.data;try{var d=C(a=a?new Date(a):new Date),c=o.data[u],h=c&&(c.qfqday||c.day),f=[];if(h&&h.length>=2&&(h.forEach(function(e){e[0]!==d&&f.push(e)}),f.length>1)){var m=f[f.length-1],p=f[f.length-2],R=(m[2]-p[2]).toFixed(2),g=(R/p[2]*100).toFixed(2)+"%",v="";switch(i){case"sh":case"sz":v='"\xa5"#,##0.00_);[Red]\\("\xa5"#,##0.00\\)',/^(900)|(20(0|1))/.test(s)&&(v="[$HK$-C04]#,##0.00_);[Red]\\([$HK$-C04]#,##0.00\\)");break;case"hk":v="[$HK$-C04]#,##0.00_);[Red]\\([$HK$-C04]#,##0.00\\)";break;case"us":v="\\$#,##0.00_);[Red]\\(\\$#,##0.00\\)";break;default:v="General"}var N={lastClosePrice:Number(m[2]),company:c.qt[u][1],risingPrice:Number(R),risingRate:Z(g),todayOpenDay:Number(m[1]),todayHighestPrice:Number(m[3]),todayLowestPrice:Number(m[4]),todayVolume:(0,l.default)(m[5]),realTimePrice:Number(h[h.length-1][2])},T=[N.lastClosePrice,N.company,N.risingPrice,N.risingRate,N.todayOpenDay,N.todayHighestPrice,N.todayLowestPrice,N.todayVolume,N.realTimePrice];"undefined"!==typeof T[t]&&(n={error:null,result:T[t],currencyFormat:"General"},[0,2,4,5,6,8].includes(t)&&(n.currencyFormat=v),3===t&&"string"!==typeof N.risingRate&&(n.currencyFormat="0.00%"))}}catch(y){console.error("get stock data error!")}r(n)}).catch(function(){r(n)})},t.isPromise=function(e){return!!e&&("object"===("undefined"===typeof e?"undefined":(0,u.default)(e))||"function"===typeof e)&&"function"===typeof e.then},t.isAsyncFormula=function(e){return/stock\([^\)]*\)/i.test(e)},t.toColumnName=I,t.toRowName=function(e){return e.toString()},t.toCellId=A,t.isGraphNodeId=function(e){return/.+![^\d]+\d+/.test(e)},t.isCustomFormulaNodeId=function(e){return/!-[^-]+-/.test(e)},t.getGraphNodeId=S,t.getGraphNodeIdByRowCol=function(e,t,r){var n=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}).customType,a=void 0===n?"":n;return S(A(e,t),r,{customType:a})},t.colIdToCol=w,t.rowIdToRow=M,t.getRowColFromGraphNodeId=F,t.getRowColFromCellId=function(e){var t=e.replace(/\$/g,""),r=t.match(/^\$?([A-Za-z]+)\$?(\d+)$/);if(!r)throw new Error(t+" \u5e76\u4e0d\u662f\u4e00\u4e2a cellId");var n=(0,o.default)(r,3),a=n[1],i=M(n[2]),s=w(a),u=!/.+\$.+/.test(e),l=!/^\$/.test(e);return{row:i,col:s,isRowRelative:u,isColRelative:l}},t.isFormula=x,t.isFormulaNode=function(e){return e&&"object"===(0,u.default)(e.formulaModel)&&"function"===typeof e.formulaModel.getParts&&e.formulaModel.getParts().length&&"number"===typeof e.row&&"number"===typeof e.col&&"string"===typeof e.id&&"string"===typeof e.sheetId},t.isVirtualCrossSheetReference=function(e){return e&&"VirtualCrossSheetReference"===e.type&&"string"===typeof e.status&&"string"===typeof e.sheetId},t.isCrossSheetNode=function(e){return e&&"CrossSheetNode"===e.type},t.isCrossSheetRowColNode=function(e){return e&&"CrossSheetRowColNode"===e.type},t.getPositionNodeName=function(e){return"position-"+e},t.doCurrentFormulaDepentOnCellValue=function(e){return!O.test(e)},t.delayWithST=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new a.default(function(t){return setTimeout(t,e)})},t.waitUntil=function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=n.pollingInterval,o=void 0===a?1e3:a;if(t())return r();setTimeout(function(){return e(t,r,{pollingInterval:o})},o)},t.getLegalValueResultInfo=function(e){if("string"===typeof e){var t=(0,m.parseValueWithStyle)(e);if(t)return{oriValue:e,result:t.value,format:t.numberFormat}}return{result:e}},t.isLetter=_,t.isNumberString=function(e){var t=e.charCodeAt(0);if(!D(t))return 8===k[t]||10===k[t];return t>=48&&t<=57},t.getErrorMsg=function(e){P(e)||(e=B.error);return e},t.hasError=P,t.isEmptyString=function(e){return G.test(e)},t.getExtendedValueByFormulaNode=function(e){var t=e.value,r=e.oriValue,n=e.error,a=void 0===r?t:r,o=n?c.default.ERROR:U["undefined"===typeof a?"undefined":(0,u.default)(a)];n&&(a=new f.default({type:b[n],displayText:n,title:"\u9519\u8bef",message:V[n]}));return new d.default({type:o,value:a})},t.getExtendedValueByString=function(e){return new d.default({type:c.default.STRING,value:e})},t.getRegExpOfGraphNodeId=function(e){var t=e.match(/(.+!)([^\d]+)(\d+)/);if(!t)throw new Error(e+" \u4e0d\u662f\u4e00\u4e2a GraphNodeId");var r=(0,o.default)(t,4),n=(r[1],r[2]),a=r[3];return new RegExp("\\$?"+n+"\\$?"+a,"g")},t.getPlaceholderForFormula=Y,t.isFormulaNodeCalculated=function(e){return"undefined"!==typeof e.value||"undefined"!==typeof e.error},t.toChar=H,t.isNodeDeleted=function(e){var t=e.id,r=e.index,n=e.amount,a=e.isRow,o=e.currentSheetId,i=F(t),s=i.row,u=i.col,l=i.sheetId,d=a?s:u;return l===o&&d>=r&&d<r+n},t.isVirtualNodeId=W,t.isVirtualRowNodeId=K,t.isVirtualColNodeId=j,t.isVirtualRangeNodeId=function(e){return 0===(e=e.toLowerCase()).indexOf("range-")},t.isVirtualCrossSheetReferenceId=function(e){return 0===(e=e.toLowerCase()).indexOf("cross-sheet-temp-")},t.isVirtualPositionNodeId=function(e){return 0===(e=e.toLowerCase()).indexOf("position-")},t.getInfoFromVirtualRowColId=z,t.getInfoFromVirtualRangeNodeId=function(e){var t=e.split("-"),r=(0,o.default)(t,6),n=r[1],a=r[2],i=r[3],s=r[4],u=r[5];return{sheetId:n,rowsStart:parseInt(a,10),rowsEnd:parseInt(i,10),colsEnd:parseInt(u,10),colsStart:parseInt(s,10)}},t.getVirtualRowColIdFromInfo=function(e){var t=e.num,r=e.sheetId;return(e.isRow?"row":"col")+"-"+r+"!"+t},t.getVirtualRangeNodeIdFromInfo=function(e){var t=e.sheetId,r=e.rowsStart,n=e.rowsEnd,a=e.colsStart,o=e.colsEnd;return"range-"+t+"-"+r+"-"+n+"-"+a+"-"+o},t.getMigrationInfoByRowColMigrationInfo=function(e){var t=e.num,r=e.newNum,n=e.id,a=e.newId,o=e.sheetId,i=e.isRow;return{id:n,newId:a,sheetId:o,newSheetId:o,row:i?t:-1,col:i?-1:t,newRow:i?r:-1,newCol:i?-1:r}},t.removeUserString=function(e,t){return e.replace(/"[^"]*"/g,function(e){var r=Y();return t[r]=e,r})},t.numberToChineseNumberString=function(e){return e.toString().split("").map(function(e){return $[parseInt(e)]}).join("")},t.getAbsoluteNumber=function(e,t,r){return e+(r?t:0)},t.dealWithRangeRef=function(e,t,r,n){if(Array.isArray(t.result))t.result=t.result[0][0][0];else if((0,R.isCalcRef)(t.result)){try{var a=t.result;t.result.isCell?t.result=a.toArray()[0]:t.result=n(a,e.row,e.col,r)}catch(o){t.result="object"===("undefined"===typeof o?"undefined":(0,u.default)(o))?o.message:B.error}null!==t.result&&""!==t.result||(t.result=0)}},t.dealWithErrorResult=function(e,t){var r="undefined"!==typeof e.result?e.result:e.error,n=t.body;if(n&&(0,R.isCellRangeNode)(n)){var a=n;if((0,R.isCellRangeNodeCrossTableThreeDimension)(n))r="#REF!";else if(a.cellRangeType===g.CELL_RANGE_TYPE.COL||a.cellRangeType===g.CELL_RANGE_TYPE.ROW)r=0;else if(a.cellRangeType===g.CELL_RANGE_TYPE.NORMAL)r="#VALUE!";else if(a.cellRangeType===g.CELL_RANGE_TYPE.USER_RANGE)for(;Array.isArray(r);)r=r[0]}-1!==["#NULL!","#DIV/0!","#VALUE!","#REF!","#NAME?","#NUM!","#N/A","#ERROR!","#GETTING_DATA","#PARAMS!","#PARAMS_LACK","#PARAMS_OVER"].indexOf(r)&&(e.error=r);return r},t.getOutScopeControlledPromise=function(){var e=function(){},t=function(){};return{promise:new a.default(function(r,n){e=r,t=n}),resolve:e,reject:t}},t.fixRightBracket=function(e){if("string"===typeof e&&x(e)){var t=e.replace(/(")[^"]*?\1/g,"");t=(t=t.replace(/'.*?'!/g,"")).replace(/\n$/g,"");for(var r=0,n=0,a=0;a<t.length;a++)"("===t[a]?r++:")"===t[a]&&n++;r-n===1&&(e+=")")}return e},t.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},t.isString=function(e){return"[object String]"===Object.prototype.toString.call(e)},t.isFunction=function(e){return"[object Function]"===Object.prototype.toString.call(e)},t.isUndefined=Q,t.isCellFormula=X,t.isCellRangeFormula=function(e){var t=e.split(":");return 2===t.length&&t.every(function(e){return X(e)})},t.isNumber=function(e){return"[object Number]"===Object.prototype.toString.call(e)},t.isNull=q,t.isSet=function(e){return!Q(e)&&!q(e)},t.isRows=function(e){return/^\d+:\d+$/.test(e)},t.isCols=function(e){return/^[A-Za-z]+:[A-Za-z]+$/.test(e)},t.isREF=function(e){return e===B.ref},t.isCircle=function(e){return e===B.circle},t.getCrossSheetCellByFormula=function(e){var t=e.replace(/"[^"]*?"/g,""),r=[],n=function(){var e="\\$?[A-Za-z]{1,3}\\$?[1-9][0-9]{0,5}",t="[A-Za-z]{1,}[A-Za-z_0-9]*",r="\\d+(\\.\\d+)?([Ee][+-]?\\d+)?",n=[],a=!0,o=!1,i=void 0;try{for(var u,l=(0,s.default)(["'.+?'!","[^\\s ' \\[ \\] \\\\ % \" \\( \\) \\| \\{ \\} , @ \\! \\$ \\^ \\uFF08 \\uFF09!\"' \\,\\+\\-\\*\\/\\&\\^\\=\\<\\>]+!"]);!(a=(u=l.next()).done);a=!0){var d=u.value,c="("+d+e+":"+d+e+")";n.push(new RegExp(c,"g")),c="("+d+t+":"+d+t+")",n.push(new RegExp(c,"g")),c="("+d+r+":"+d+r+")",n.push(new RegExp(c,"g")),c="("+d+e+":"+e+")",n.push(new RegExp(c,"g")),c="("+d+t+":"+t+")",n.push(new RegExp(c,"g")),c="("+d+r+":"+r+")",n.push(new RegExp(c,"g"));var h="("+d+e+")";n.push(new RegExp(h,"g"))}}catch(y){o=!0,i=y}finally{try{!a&&l.return&&l.return()}finally{if(o)throw i}}var f=!0,m=!1,p=void 0;try{for(var R,g=(0,s.default)(["'[^:]+?:.+?'!","[^\\s ' \\[ \\] \\\\ % \" \\( \\) \\| \\{ \\} , @ \\! \\$ \\^ \\uFF08 \\uFF09:\\,\\+\\-\\*\\/\\&\\^\\=\\<\\>]+:[^\\s ' \\[ \\] \\\\ % \" \\( \\) \\| , \\{ \\} \\# @ \\! \\$ \\^ \\uFF08 \\uFF09 \\,\\+\\-\\*\\/\\&\\^\\=\\<\\>]+!"]);!(f=(R=g.next()).done);f=!0){var v=R.value,N="("+v+e+":"+e+")";n.push(new RegExp(N,"g")),N="("+v+t+":"+t+")",n.push(new RegExp(N,"g")),N="("+v+r+":"+r+")",n.push(new RegExp(N,"g"));var T="("+v+e+")";n.push(new RegExp(T,"g"))}}catch(y){m=!0,p=y}finally{try{!f&&g.return&&g.return()}finally{if(m)throw p}}return n}(),a=!0,o=!1,i=void 0;try{for(var u,l=(0,s.default)(n);!(a=(u=l.next()).done);a=!0){var d=u.value;t=t.replace(d,function(e){return r.push(e)," "})}}catch(c){o=!0,i=c}finally{try{!a&&l.return&&l.return()}finally{if(o)throw i}}return r},t.convertPercentageIntoNumber=Z,t.hasFuctionRelyOnOwnPosition=function(e){return e.indexOf("ROW()")>-1||e.indexOf("COLUMN()")>-1},t.convertGridRangeToCellId=function(e){var t=e.startRowIndex,r=e.endRowIndex,n=e.startColIndex,a=e.endColIndex;if(t===r&&n===a)return A(t,r);return A(t,n)+":"+A(r,a)},t.fixNumber=function(e,t){"number"===typeof e&&e.toString().length>=t&&(e=e<1&&e>-1?+e.toFixed(t):+e.toPrecision(t));return e},t.hasTextInheritFunction=function(e){return/^=?(ASC|CLEAN|CONCAT|DBCS|DOLLAR|EXACT|FIXED|LEFT|LEFTB|LOWER|MID|MIDB|PROPER|REPLACE|REPLACEB|REPT|RIGHT|RIGHTB|SUBSTITUTE|TEXT|TEXTJOIN|TRIM|UPPER|USDOLLAR)\(.*\)$/i.test(e)},t.translateCellCoords=function(e){var t=e.row,r=e.col;return String(H(r))+(t+1)};var d=N(r(78)),c=N(r(62)),h=N(r(364)),f=N(r(220)),m=r(57),p=N(r(1098)),R=r(201),g=r(136),v=N(r(100));function N(e){return e&&e.__esModule?e:{default:e}}t.DEFAULT_NUMBER_FORMAT_INFO={pattern:"General"};var T=[1,26,676];t.noNeedConvertFormula=function(e){return!!e&&!!e.match(/ID\(|STOCK\(/gi)},t.noSupportFormulaError=function(e){return!!e&&/\#error|\#PARAMS_LACK|\#PARAMS_OVER/gi.test(e)};function y(e){return e<10?"0"+e:e}function C(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!e&&t)return new Date;var r=y(e.getMonth()+1),n=y(e.getDate());return[e.getFullYear(),r,n].join("-")}var E={};function I(e){for(var t="",r=1,n=26;(e-=r)>=0;r=n,n*=26)t=String.fromCharCode(Math.floor(e%n/r)+65)+t;return t}t.formatChinese=function(){var e=void 0,t=void 0,r=void 0;function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments[1];t=t||{"\uff1d":"=","\uff0c":",","\uff08":"(","\uff09":")"};var r=!0,n=!1,a=void 0;try{for(var o,u=(0,s.default)((0,i.default)(t));!(r=(o=u.next()).done);r=!0){var l=o.value,d=new RegExp(l,"g");e=e.replace(d,t[l])}}catch(c){n=!0,a=c}finally{try{!r&&u.return&&u.return()}finally{if(n)throw a}}return e}return function(a,o){return e===a&&r===o||(e=a,r=o,t=a.replace(/([^"]*)("[^"]*"|\s?)([^"]*)/g,function(e,t,r,a){return(t=n(t,o))+r+(a=n(a,o))})),t}}();function A(e,t){return I(t+1)+(e+1)}function S(e,t){var r=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).customType,n=void 0===r?"":r;return e.indexOf("!")>-1?e:(e=e.toUpperCase(),n&&(e="-"+n+"-"+e),t+"!"+e)}function w(e){"$"===e[0]&&(e=e.slice(1));var t=-1,r=void 0,n=0,a=e.length;do{r=e[++t]}while(t<a&&_(r));for(var o=t-1,i=o;i>=0;i--)n+=((32|e[i].charCodeAt(0))-96)*T[o-i];return n-1}function M(e){return e=e.replace(/\$/g,""),parseInt(e)-1}function F(e){if(j(e)){var t=z(e);return{col:t.num,row:-1,sheetId:t.sheetId}}if(K(e)){var r=z(e);return{row:r.num,col:-1,sheetId:r.sheetId}}W(e)&&(e=e.replace(/^(?:position|temp|row|col|cross-sheet-temp)-/i,""));var n=(e=e.replace(/!-[^-!]+-/,"!")).match(/(.+!)([^\d]+)(\d+)/);if(!n)throw new Error(e+" \u4e0d\u662f\u4e00\u4e2a GraphNodeId");var a=(0,o.default)(n,4),i=a[1],s=a[2];return{row:M(a[3]),col:w(s),sheetId:i?i.replace(/!$/,""):""}}function x(e){return"string"===typeof e&&"="===e[0]&&e.length>1}var O=t.CURRENT_VALUE_REGARDLESS_OF_VALUE_REG=/row\([^\)]*\)$/i;var k=[14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,11,24,24,24,26,24,24,24,20,21,24,25,24,19,24,24,8,8,8,8,8,8,8,8,8,8,24,24,25,25,25,24,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,20,24,21,27,18,27,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,20,25,21,25,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,11,24,26,26,26,26,28,28,27,28,1,22,25,19,28,27,28,25,10,10,27,1,28,24,27,10,1,23,10,10,10,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,25,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,25,1,1,1,1,1,1,1,1];function D(e){return e<=127}function _(e){var t=e.charCodeAt(0);return!function(e){return e<=255}(t)||(D(t)?(t|=32)>=96&&t<=122:0===k[t]||1===k[t])}var U={number:c.default.NUMBER,string:c.default.STRING,boolean:c.default.BOOL,error:c.default.ERROR},B=t.error={null:"#NULL!",div0:"#DIV/0!",value:"#VALUE!",ref:"#REF!",circle:"#CIRCLE!",name:"#NAME?",num:"#NUM!",na:"#N/A",error:"#ERROR!",data:"#GETTING_DATA",paramsErr:"#PARAMS!",paramsLack:"#PARAMS_LACK",paramsOver:"#PARAMS_OVER",needUpdate:"#NEED_UPDATE"},L={};function P(e){return L[e]}(0,n.default)(B).forEach(function(e){L[e]=!0});var b={"#NULL!":h.default.NULL_VALUE,"#DIV/0!":h.default.DIVIDE_BY_ZERO,"#VALUE!":h.default.VALUE,"#REF!":h.default.REF,"#NAME?":h.default.NAME,"#NUM!":h.default.NUM,"#N/A":h.default.N_A,"#ERROR!":h.default.ERROR,"#NEED_UPDATE":h.default.LOADING},V={"#NULL":"\u7a7a\u503c\u9519\u8bef\u3002","#DIV/0!":"\u9664\u6570\u4e3a\u96f6\u3002","#VALUE!":"\u627e\u4e0d\u5230\u6570\u7ec4\u503c\u3002","#REF!":"\u4e0d\u5141\u8bb8\u5b58\u5728\u5faa\u73af\u5f15\u7528\u3002","#NAME?":"\u65e0\u6548\u7684\u8303\u56f4\u540d\u79f0\u3002","#NUM!":"\u6570\u503c\u9519\u8bef\u3002","#N/A":"\u53c2\u6570\u4e0d\u53ef\u4e3a\u7a7a\u3002","#ERROR!":"\u516c\u5f0f\u89e3\u6790\u9519\u8bef\u3002","#PARAMS!":"\u53c2\u6570\u8f93\u5165\u9519\u8bef\u3002","#PARAMS_LACK":"\u53c2\u6570\u4e2a\u6570\u4e0d\u8db3\u3002","#PARAMS_OVER":"\u53c2\u6570\u4e2a\u6570\u592a\u591a\u3002"},G=/^\s*$/;function Y(){return(0,p.default)("\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341",10)}function H(e){for(var t="";e>=0;)t=String.fromCharCode(e%26+97)+t,e=Math.floor(e/26)-1;return t.toUpperCase()}function W(e){return 0===(e=e.toLowerCase()).indexOf("position-")||0===e.indexOf("temp-")||0===e.indexOf("row-")||0===e.indexOf("col-")||0===e.indexOf("cross-sheet-temp-")||0===e.indexOf("range-")}function K(e){return 0===(e=e.toLowerCase()).indexOf("row-")}function j(e){return 0===(e=e.toLowerCase()).indexOf("col-")}function z(e){var t=0===e.toLowerCase().indexOf("row-"),r=e.replace(/^(?:col|row)-/i,"").split("!"),n=(0,o.default)(r,2),a=n[0],i=n[1];return{num:parseInt(i),sheetId:a,isRow:t}}var $=["\u96f6","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d","\u4e03","\u516b","\u4e5d"];function Q(e){return"[object Undefined]"===Object.prototype.toString.call(e)}function X(e){if("string"!==typeof e)return!1;var t=e.lastIndexOf("!");e=e.slice(t+1);return/^\$?([A-Za-z]{1,3})\$?([1-9][0-9]{0,5})$/g.test(e)}function q(e){return"[object Null]"===Object.prototype.toString.call(e)}function Z(e){return/^-?\d+\.?\d*%$/.test(e)?parseFloat(e)/100:e}},447:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseNode=t.VariableNode=t.FunctionNode=t.CellRangeBinaryNode=t.CellRangeNode=t.CalcRef=t.CellNode=void 0;var n=r(1101);Object.defineProperty(t,"CellNode",{enumerable:!0,get:function(){return R(n).default}});var a=r(1102);Object.defineProperty(t,"CalcRef",{enumerable:!0,get:function(){return R(a).default}});var o=r(1103);Object.defineProperty(t,"CellRangeNode",{enumerable:!0,get:function(){return R(o).default}});var i=r(1104);Object.defineProperty(t,"CellRangeBinaryNode",{enumerable:!0,get:function(){return R(i).default}});var s=r(1105);Object.defineProperty(t,"FunctionNode",{enumerable:!0,get:function(){return R(s).default}});var u=r(1108);Object.defineProperty(t,"VariableNode",{enumerable:!0,get:function(){return R(u).default}});var l=r(184);Object.defineProperty(t,"BaseNode",{enumerable:!0,get:function(){return R(l).default}});var d=R(n),c=R(o),h=R(i),f=R(s),m=R(u),p=R(l);function R(e){return e&&e.__esModule?e:{default:e}}t.default={BaseNode:p.default,CellNode:d.default,CellRangeNode:c.default,CellRangeBinaryNode:h.default,FunctionNode:f.default,VariableNode:m.default}},60:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=l(r(0)),a=l(r(1)),o=r(44),i=r(201),s=r(371),u=r(1109);function l(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(t){(0,n.default)(this,e),this.parts=t.parts||[]}return(0,a.default)(e,[{key:"serialize",value:function(){var e=[];return Array.isArray(this.parts)&&this.parts.forEach(function(t){t instanceof u.CellRangeWithFixedInfo?e.push(t.serialize()):"string"===typeof t&&e.push(t)}),e}},{key:"autofix",value:function(t,r,n){var a=this.isReliable();if(a)return!a;var o=this.toString(t,r),i=e.string2FormulaModel(o,t,r,n);return this.parts=i.parts,!a}},{key:"clone",value:function(){return new e({parts:this.parts.map(function(e){return"string"===typeof e?e:e.clone()})})}},{key:"getAllCellRangeWithFixedInfo",value:function(){return this.parts.filter(function(e){return e instanceof u.CellRangeWithFixedInfo})}},{key:"getParts",value:function(){return this.parts.map(function(e){return e})}},{key:"hasRelativeReference",value:function(){for(var e=this.parts,t=e.length-1;t>0;t--){var r=e[t];if("string"!==typeof r&&(r.isStartColRelative||r.isEndColRelative||r.isStartRowRelative||r.isEndRowRelative))return!0}return!1}},{key:"isAffectedByRowColDel",value:function(e){for(var t=e.index,r=e.amount,n=e.isRow,a=e.sheetId,o=e.row,i=e.col,s=e.nodeSheetId,u=0,l=this.parts.length;u<l;u++){var d=this.parts[u];if("string"!==typeof d&&((d.isCrossSheetReference||s===a)&&!d.isThreeDimensionalReference&&(!d.isCrossSheetReference||d.startSheetId===a))){var c=n?d.getAbsoluteStartRow(o):d.getAbsoluteStartCol(i);if(c>=t&&c<t+r)return!0;var h=n?d.getAbsoluteEndRow(o):d.getAbsoluteEndCol(i);if(h>=t&&h<t+r)return!0}}return!1}},{key:"toString",value:function(t,r){var n="";return this.parts.forEach(function(a){a instanceof u.CellRangeWithFixedInfo?n+=a.toString(t,r,e.custom.getSheetNameBySheetId):n+=a}),n}},{key:"updateAfterCutAndPaste",value:function(e){var t=e.cutRanges,r=e.oldRow,n=e.oldCol,a=e.newRow,o=e.newCol;this.parts.forEach(function(e){if("string"!==typeof e)for(var i=t.length-1;i>-1;i--){var s=t[i],u=e.isContainedByRange({row:r,col:n,range:s});e.updateAfterFormulaPositionChange({oldRow:r,oldCol:n,newRow:a,newCol:o,keepRelativeRelationship:u})}})}},{key:"updateAfterRowColAdd",value:function(t){var r=t.sheetId,n=t.index,a=t.amount,i=t.isRow,s=t.row,u=t.col,l=t.nodeSheetId,d=!1,c=!1,h=!1,f=l===r,m=i?s:u,p=f&&m>=n;return this.parts=this.parts.map(function(t){if("string"===typeof t)return p&&(0,o.hasFuctionRelyOnOwnPosition)(t)&&(c=!0),t;var s=t.isCrossSheetReference,u=t.isRowArray,R=t.isColArray,g=t.isCellRangeReferenceCorrect,v=t.isSheetReferenceCorrect;if(!g||!v)return t;var N=!1,T=i?R:u;if(s){var y=t.isThreeDimensionalReference;if(y){var C=e.custom.isSheetAmongTwoSheets(r,t.startSheetId,t.endSheetId);if(!p&&!C)return t;if(C)if(T)c=!0;else(i?t.getAbsoluteEndRow(m)>=n:t.getAbsoluteEndCol(m)>=n)&&(c=!0,h=!0)}if(y)N=!0;else if(f)N=t.startSheetId!==r;else if(t.startSheetId!==r)return t}else if(l!==r)return t;if(T)return c=!N,t;var E=i?"startRowIndex":"startColIndex",I=i?"endRowIndex":"endColIndex",A=i?t.isStartRowRelative:t.isStartColRelative,S=i?t.isEndRowRelative:t.isEndColRelative,w=t[E],M=t[I],F=M-w;return A?p!==(!N&&w+m>=n)&&(t[E]=w+(p?-a:a),d=!0):!N&&w>=n&&(t[E]=w+a,d=!0),S?p!==(!N&&M+m>=n)&&(t[I]=M+(p?-a:a),d=!0):!N&&M>=n&&(t[I]=M+a,d=!0),N||t[I]-t[E]===F||(c=!0,(i&&u||!i&&R)&&(h=!0)),t}),{isValueChanged:c,isFormulaChanged:d,isDependencyChanged:h}}},{key:"updateAfterRowColDel",value:function(t){var r=t.index,n=t.amount,a=t.isRow,i=t.sheetId,s=t.row,u=t.col,l=t.nodeSheetId,d=!1,c=!1,h=!1,f=l===i,m=a?s:u,p=f&&m>=r;return this.parts=this.parts.reduce(function(t,s){if("string"===typeof s)return p&&(0,o.hasFuctionRelyOnOwnPosition)(s)&&(c=!0),t.push(s),t;var u=s.isCrossSheetReference,R=s.isRowArray,g=s.isColArray,v=s.isCellRangeReferenceCorrect,N=s.isSheetReferenceCorrect;if(!v||!N)return t.push(s),t;var T=!1,y=a?g:R;if(u){var C=s.isThreeDimensionalReference;if(C){var E=e.custom.isSheetAmongTwoSheets(i,s.startSheetId,s.endSheetId);if(!p&&!E)return t.push(s),t;if(E)if(y)c=!0;else(a?s.getAbsoluteEndRow(m)>=r:s.getAbsoluteEndCol(m)>=r)&&(c=!0,h=!0)}if(C)T=!0;else if(f)T=s.startSheetId!==i;else if(s.startSheetId!==i)return t.push(s),t}else if(l!==i)return t.push(s),t;if(y)return c=!T,t.push(s),t;var I=a?"startRowIndex":"startColIndex",A=a?"endRowIndex":"endColIndex",S=a?s.isStartRowRelative:s.isStartColRelative,w=a?s.isEndRowRelative:s.isEndColRelative,M=s[I],F=s[A],x=a?s.getAbsoluteStartRow(m):s.getAbsoluteStartCol(m),O=a?s.getAbsoluteEndRow(m):s.getAbsoluteEndCol(m),k=F-M,D=x>=r&&x<r+n,_=O>=r&&O<r+n;if((_||D)&&(d=!0,h=!0,c=!0),!T&&D&&_){var U=t.length-1;return d=!0,c=!0,u?(s.isCellRangeReferenceCorrect=!1,t.push(s)):"string"===typeof t[U]?t[U]=t[U].concat("#REF!"):t.push("#REF!"),t}var B=D?r+n:x,L=_?r-1:O,P=S?B-m:B,b=w?L-m:L;return s[I]=P,s[A]=b,S?p!==(!T&&B>=r)&&(s[I]=P-(p?-n:n),d=!0):!T&&B>=r&&(s[I]=P-n,d=!0),w?p!==(!T&&L>=r)&&(s[A]=b-(p?-n:n),d=!0):!T&&L>=r&&(s[A]=b-n,d=!0),t.push(s),T||s[A]-s[I]===k||(c=!0,h=!0),t},[]),{isValueChanged:c,isFormulaChanged:d,isDependencyChanged:h}}},{key:"updateAfterRowColCutMove",value:function(t){var r=t.migrationMap,n=t.sourceSheetId,a=t.isRow,i=t.row,s=t.col,u=t.nodeSheetId,l=t.upperBoundOfAffectedArea,d=t.lowerBoundOfAffectedArea,c=!1,h=!1,f=!1,m=u===n,p=a?i:s,R=m&&r[p];return this.parts=this.parts.map(function(t){if("string"===typeof t)return R&&(0,o.hasFuctionRelyOnOwnPosition)(t)&&(h=!0),t;var i=t.isCrossSheetReference,s=t.isRowArray,g=t.isColArray,v=t.isCellRangeReferenceCorrect,N=t.isSheetReferenceCorrect;if(!v||!N)return t;var T=!1,y=a?g:s;if(i){if(t.isThreeDimensionalReference){if(h)return t;if("string"===typeof n&&!e.custom.isSheetAmongTwoSheets(n,t.startSheetId,t.endSheetId))return t;if(y)return h=!0,t;var C=a?t.getAbsoluteStartRow(p):t.getAbsoluteStartCol(p),E=a?t.getAbsoluteEndRow(p):t.getAbsoluteStartCol(p);return!(C>l||E<d)&&(h=!0,f=!0),t}if(m)T=t.startSheetId!==n;else if(t.startSheetId!==n)return t}else if(u!==n)return t;if(y)return h=!T,t;var I=a?"startRowIndex":"startColIndex",A=a?"endRowIndex":"endColIndex",S=a?t.isStartRowRelative:t.isStartColRelative,w=a?t.isEndRowRelative:t.isEndColRelative,M=t[I],F=t[A],x=R?r[p].num:p,O=(0,o.getAbsoluteNumber)(M,p,S),k=(0,o.getAbsoluteNumber)(F,p,w),D=O,_=k;if(S?(R||!T&&r[O])&&(D=r[O]?r[O].num:O,c=!0):!T&&r[M]&&(D=r[M].num,c=!0),w?(R||!T&&r[k])&&(_=r[k]?r[k].num:k,c=!0):!T&&r[F]&&(_=r[F].num,c=!0),!c)return t;var U=Math.min(D,_),B=Math.max(D,_);return t[I]=S?U-x:U,t[A]=w?B-x:B,T||F===t[A]&&M===t[I]||(h=!0,f=!0),t}),{isFormulaChanged:c,isValueChanged:h,isDependencyChanged:f}}},{key:"updateAfterRowReoder",value:function(e){var t=e.row,r=e.newRow,n=!1,a=!1;return this.parts=this.parts.reduce(function(e,o){if("string"===typeof o)return e.push(o),e;var i=o.isCrossSheetReference,s=o.isColArray,u=o.isCellRangeReferenceCorrect,l=o.isSheetReferenceCorrect;if(!u||!l||s)return e.push(o),e;var d=i,c=o.isStartRowRelative,h=o.isEndRowRelative,f=o.startRowIndex,m=o.endRowIndex,p=r-t;if(c&&(d?(o.startRowIndex+=p,n=!0):f+r<0&&(o.startRowIndex=-r,n=!0,a=!0)),h)if(d)o.endRowIndex+=p,n=!0;else if(m+r<0){var R=e.length-1;return"string"===typeof e[R]?e[R]=e[R].concat("#REF!"):e.push("#REF!"),n=!0,a=!0,e}return e.push(o),e},[]),{isValueChanged:!0,isFormulaChanged:n,isDependencyChanged:a}}},{key:"updateAfterSheetDeleted",value:function(t){var r=t.sheetId,n=t.originSheetIndex,a=!1;return this.parts=this.parts.map(function(t){if("string"===typeof t)return t;if(!t.isCrossSheetReference)return t;if(t.isThreeDimensionalReference)if(t.startSheetId===r)a=!0;else if(t.endSheetId===r)a=!0;else{var o=e.custom.getSheetIndexBySheetId(t.startSheetId),i=e.custom.getSheetIndexBySheetId(t.endSheetId);o<n&&i>=n&&(a=!0)}else t.startSheetId===r&&(a=!0);return t}),{isFormulaChanged:!1,isValueChanged:a,isDependencyChanged:!1}}},{key:"updateAfterSheetRenamed",value:function(e){var t=e.sheetId,r=!1;return this.parts=this.parts.map(function(e){return"string"===typeof e?e:e.isCrossSheetReference?(e.isThreeDimensionalReference?e.startSheetId===t?r=!0:e.endSheetId===t&&(r=!0):e.startSheetId===t&&(r=!0),e):e}),{isFormulaChanged:r,isValueChanged:!1,isDependencyChanged:!1}}},{key:"updateAfterSheetInserted",value:function(t){var r=t.sheetIndex,n=!1;return this.parts=this.parts.map(function(t){if("string"===typeof t)return t;if(!t.isCrossSheetReference)return t;if(t.isThreeDimensionalReference){var a=e.custom.getSheetIndexBySheetId(t.startSheetId),o=e.custom.getSheetIndexBySheetId(t.endSheetId);a<r&&o>r&&(n=!0)}return t}),{isFormulaChanged:!1,isValueChanged:n,isDependencyChanged:n}}},{key:"isReliable",value:function(){return this.parts.reduce(function(e,t){if(!e)return e;if("string"===typeof t){var r=t.replace(/"[^"]*"/g,"");if(/\$?[A-Za-z]+\$?[0-9]+/.test(r)||/\$?[A-Za-z]+:\$?[A-Za-z]+|\$?[0-9]+:\$?[0-9]+/.test(r))return!1}return e},!0)}},{key:"getStringIndex",value:function(){return void 0===this.stringIndex&&this.createStringIndex(),this.stringIndex}},{key:"createStringIndex",value:function(){var e="";return Array.isArray(this.parts)&&this.parts.forEach(function(t){t instanceof u.CellRangeWithFixedInfo?e+=t._toString():"string"===typeof t&&(e+=t)}),this.stringIndex=e,this}},{key:"hasReferenceError",get:function(){for(var e=this.parts,t=0;t<e.length;t++){var r=e[t];if(r instanceof u.CellRangeWithFixedInfo&&!r.isReferenceCorrect)return!0}return!1}}],[{key:"deserialize",value:function(t){var r=[];if(Array.isArray(t)){var n=!1,a=!1;if(t.forEach(function(e){if("string"===typeof e){r.push(e);var t=e.toLowerCase();(t.indexOf("row")>-1||t.indexOf("offset")>-1)&&(n=!0)}else if(Array.isArray(e)){var o=u.CellRangeWithFixedInfo.deserialize(e);r.push(o),o.isPositionRely&&(a=!0)}}),n&&!a){var o=new e({parts:r}).toString(5e3,5e3),i=e.string2FormulaModel(o,5e3,5e3,"NOEXIST");r=i.parts}}return new e({parts:r})}},{key:"bindCustomMethod",value:function(e){this.custom=e}},{key:"string2FormulaModel",value:function(t,r,n,a){var l=(arguments.length>4&&void 0!==arguments[4]?arguments[4]:{}).customGraphNodeId,d=this.custom.parse,c=t.replace(/^=/,"").trim(),h=l||(0,o.getGraphNodeIdByRowCol)(r,n,a),f=Date.now(),m=d(c,{row:r,col:n,sheetId:a,id:h}),p=Date.now();if((0,i.isCellNode)(m)){m.reportLongTime(p-f,s.CellMap.REPORT_TYPE.MINI_AST);var R=[];(0,i.walk)(m,function(e,t){if((0,i.isCellNode)(e)||(0,i.isCellRangeNode)(e)){var a=(0,i.isCurrentNodeInPositionRelyFunction)(t);if((0,i.isCellRangeNode)(e)){var s=e.originValue,l=e.cellRangeType,d=e.start,c=e.end,h="",f="";if((0,i.isCellRangeNodeCrossTable)(e)&&(h=e.startSheetId,f=e.endSheetId),"COL"===l){var m=!/\$/.test(d),p=!/\$/.test(c),g=(0,o.colIdToCol)(d)-(m?n:0),v=(0,o.colIdToCol)(c)-(p?n:0);return R.unshift({rangeInfo:new u.CellRangeWithFixedInfo({startColIndex:g,endColIndex:v,startRowIndex:0,endRowIndex:0,isStartColRelative:m,isEndColRelative:p,isStartRowRelative:!0,isEndRowRelative:!0,isColArray:!0,isPositionRely:a,startSheetId:h,endSheetId:f}),text:s}),{stopSearchingDown:!0}}if("ROW"===l){var N=!/\$/.test(d),T=!/\$/.test(c),y=(0,o.rowIdToRow)(d)-(N?r:0),C=(0,o.rowIdToRow)(c)-(T?r:0);return R.unshift({rangeInfo:new u.CellRangeWithFixedInfo({startColIndex:0,endColIndex:0,startRowIndex:y,endRowIndex:C,isStartColRelative:!0,isEndColRelative:!0,isStartRowRelative:N,isEndRowRelative:T,isRowArray:!0,isPositionRely:a,startSheetId:h,endSheetId:f}),text:s}),{stopSearchingDown:!0}}if("NORMAL"===l){var E=(0,o.getRowColFromCellId)(d),I=E.row,A=E.col,S=E.isRowRelative,w=E.isColRelative,M=(0,o.getRowColFromCellId)(c),F=M.row,x=M.col,O=M.isRowRelative,k=M.isColRelative,D=Math.min(A,x),_=Math.max(A,x),U=Math.min(F,I),B=Math.max(I,F),L=S?U-r:U,P=w?D-n:D,b=O?B-r:B,V=k?_-n:_;return R.unshift({rangeInfo:new u.CellRangeWithFixedInfo({startColIndex:P,endColIndex:V,startRowIndex:L,endRowIndex:b,isStartColRelative:w,isEndColRelative:k,isStartRowRelative:S,isEndRowRelative:O,isPositionRely:a,startSheetId:h,endSheetId:f}),text:s}),{stopSearchingDown:!0}}return{stopSearchingDown:!0}}if((0,i.isCellNode)(e)){var G=e.cellId,Y="",H="";(0,i.isCellNodeCrossTable)(e)&&(Y=e.sheetId,H=e.sheetId);var W=(0,o.getRowColFromCellId)(G),K=W.row,j=W.col,z=W.isRowRelative,$=W.isColRelative,Q=z?K-r:K,X=$?j-n:j;return R.unshift({rangeInfo:new u.CellRangeWithFixedInfo({startColIndex:X,endColIndex:X,startRowIndex:Q,endRowIndex:Q,isStartColRelative:$,isEndColRelative:$,isStartRowRelative:z,isEndRowRelative:z,isPositionRely:a,startSheetId:Y,endSheetId:H}),text:G}),{stopSearchingDown:!0}}return{stopSearchingDown:!0}}});var g={},v=-1,N=t.replace(/'.*?'!|"([^"]|"")*"/g,function(e){if("'!"===e.slice(e.length-2))return e;var t=(0,o.numberToChineseNumberString)(++v);return g[t]=e,t}).replace(/[\u96f6\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d]+/g,function(e){if(g[e])return e;var t=(0,o.numberToChineseNumberString)(++v);return g[t]=e,t}),T=[],y=N;return R.forEach(function(e){var t=e.text,r=e.rangeInfo,n=y.indexOf(t),a=y.slice(0,n),o=y.slice(n+t.length),i=a.replace(/[\u96f6\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d]+/g,function(e){return g[e]||""}),s="string"===typeof T[T.length-1]?T.pop()+i:i;"string"===typeof r?T.push(s+r):(T.push(s),T.push(r)),y=o}),y&&T.push(y.replace(/[\u96f6\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d]+/g,function(e){return g[e]||""})),new e({parts:T})}return new e({parts:[t]})}}]),e}();d.protoMap={0:{name:"parts",dataType:{serialize:function(e,t){if(!Array.isArray(e))return[];var r=[];return e.forEach(function(e){e instanceof u.CellRangeWithFixedInfo?r.push(t(e,u.CellRangeWithFixedInfo)):"string"===typeof e&&r.push(e)}),r},deserialize:function(e,t){if(!Array.isArray(e))return[];var r=[],n=!1,a=!1;if(e.forEach(function(e){if("string"===typeof e){r.push(e);var o=e.toLowerCase();(o.indexOf("row")>-1||o.indexOf("offset")>-1)&&(n=!0)}else if(Array.isArray(e)){var i=t(e,u.CellRangeWithFixedInfo);r.push(i),i.isPositionRely&&(a=!0)}}),n&&!a){var o=new d({parts:r}).toString(5e3,5e3),i=d.string2FormulaModel(o,5e3,5e3,"NOEXIST");r=i.parts}return r}}}},t.default=d},763:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.UN_BOOL_TO_NUMBER_FUNCTIONS={AND:!0,STOCK:!0,DAYS360:!0,DATEDIF:!0,E:!0,FALSE:!0,HLOOKUP:!0,IF:!0,INT:!0,ISEVEN:!0,ISODD:!0,ISNUMBER:!0,IFERROR:!0,ISNA:!0,ISERROR:!0,ISERR:!0,INDIRECT:!0,INDEX:!0,LOOKUP:!0,MATCH:!0,NOT:!0,OR:!0,TRUE:!0,VLOOKUP:!0,COUNTIF:!0,ASC:!0,CONCATENATE:!0,CONCAT:!0,TRIM:!0,VALUE:!0,SUBSTITUTE:!0,UPPER:!0,"WORKDAY.ORIGIN":!0,"WORKDAY.INTL":!0,FIXED:!0,PRODUCT:!0,REPT:!0,LOGICMATCH:!0,SPECIALMATCH:!0,EOMONTH:!0,EDATE:!0,IMSUB:!0,IMCONJUGATE:!0,COMPLEX:!0,SQRTPI:!0,FVSCHEDULE:!0,PROPER:!0,N:!0,EFFECT:!0,NOMINAL:!0,BIN2DEC:!0,BIN2OCT:!0,BIN2HEX:!0,OCT2BIN:!0,OCT2DEC:!0,OCT2HEX:!0,HEX2BIN:!0,HEX2OCT:!0,HEX2DEC:!0,DEC2BIN:!0,DEC2OCT:!0,DEC2HEX:!0,"ERF.ORIGIN":!0,"ERF.PRECISE":!0,"ERFC.PRECISE":!0,RANDBETWEEN:!0,CONVERT:!0,DELTA:!0,GESTEP:!0,LEN:!0},t.UN_THROW_ERROR_FUNCTIONS={ISERROR:!0,IFERROR:!0,ISERR:!0,ISNA:!0,IF:!0,COUNT:!0,COUNTA:!0,COUNTIF:!0,COUNTIFS:!0,CHOOSE:!0,ISNUMBER:!0,SUMIF:!0,SUMIFS:!0,ISBLANK:!0,COLUMN:!0,MATCH:!0,ISFORMULA:!0,ISREF:!0},t.EMPTY_CELL_IS_NULL={VLOOKUP:!0,HLOOKUP:!0,LOOKUP:!0,ISNUMBER:!0,OR:!0,MATHMATCH:!0,LOGICMATCH:!0,AVERAGEA:!0,COUNTIFS:!0,MOD:!0},t.UNEXPAND_FUNCTIONS={IFERROR:!0,OFFSET:!0,COUNTIF:!0,COUNTIFS:!0,SUMIF:!0,SUMIFS:!0},t.LIKE_SUMPRODUCT={SUMPRODUCT:!0,LOOKUP:!0};var n=t.ARG_TYPE={BOOL:"BOOL",STRING:"STRING",NUMBER:"NUMBER",DATE:"DATE",ARRAY:"ARRAY",NOT_ARRAY:"NOT_ARRAY",ANY:"ANY"};t.FUNC_CONFIG={SUM:{argumentsType:n.ANY,acceptRef:!0,min:1},IF:{argumentsType:[n.BOOL,n.NOT_ARRAY,n.NOT_ARRAY],min:2,max:3,acceptRef:!0},STOCK:{min:2,max:2},ID:{min:2,max:2},ROUND:{argumentsType:[n.NUMBER,n.NUMBER],min:2,max:2},AVERAGE:{argumentsType:n.ANY,min:1,max:255,acceptRef:!0},COUNTIF:{argumentsType:[n.ANY,n.STRING],min:2,max:2,acceptRef:!0},MID:{argumentsType:[n.STRING,n.NUMBER,n.NUMBER],min:3,max:3},MAX:{argumentsType:n.ANY,min:1,max:255,acceptRef:!0},COUNTA:{argumentsType:n.ANY,min:1,max:255,acceptRef:!0},DATEDIF:{argumentsType:[n.DATE,n.DATE,n.STRING],min:3,max:3},COUNTIFS:{argumentsType:[n.ANY,n.STRING,n.ANY,n.STRING,n.ANY,n.STRING,n.ANY,n.STRING],min:2},SUBTOTAL:{argumentsType:[n.NUMBER,n.ANY,n.ANY],min:2,acceptRef:!0},MIN:{argumentsType:n.ANY,min:1,max:255,acceptRef:!0},COUNT:{argumentsType:n.ANY,min:1,acceptRef:!0},SUMIF:{argumentsType:[n.ANY,n.STRING,n.ANY],min:2,max:3,acceptRef:!0},SUMIFS:{argumentsType:[n.ANY,n.ANY,n.STRING,n.ANY,n.STRING,n.ANY,n.STRING],min:3,max:254},TEXT:{argumentsType:[n.NOT_ARRAY,n.STRING],min:2,max:2},LEFT:{argumentsType:[n.STRING,n.NUMBER],min:1,max:2},RIGHT:{argumentsType:[n.STRING,n.NUMBER],min:1,max:2},YEAR:{argumentsType:[n.DATE],min:1,max:1},INT:{argumentsType:[n.NUMBER],min:1,max:1},MOD:{argumentsType:[n.NUMBER,n.NUMBER],min:2,max:2},DATE:{argumentsType:[n.NUMBER,n.NUMBER,n.NUMBER],min:3,max:3},NOW:{argumentsType:[n.ANY],min:0,max:0},ABS:{argumentsType:[n.NUMBER],min:1,max:1},MONTH:{argumentsType:[n.DATE],min:1,max:1},RAND:{argumentsType:[n.ANY],min:0,max:0},SQRT:{argumentsType:[n.NUMBER],min:1,max:1},DAY:{argumentsType:[n.DATE],min:1,max:1},LEN:{argumentsType:[n.STRING],min:1,max:1},WEEKDAY:{argumentsType:[n.DATE,n.NUMBER],min:1,max:2},OR:{argumentsType:[n.ANY],min:1,max:255},INDIRECT:{argumentsType:[n.STRING,n.BOOL],min:1,max:2},AND:{argumentsType:[n.ANY],min:1},ROUNDUP:{argumentsType:[n.NUMBER,n.NUMBER],min:2,max:2},ROUNDDOWN:{argumentsType:[n.NUMBER,n.NUMBER],min:2,max:2},VLOOKUP:{argumentsType:[n.ANY,n.ANY,n.STRING,n.BOOL],min:3,max:4,acceptRef:!0},HLOOKUP:{argumentsType:[n.ANY,n.ANY,n.STRING,n.BOOL],min:3,max:4,acceptRef:!0},LOOKUP:{argumentsType:[n.NOT_ARRAY,n.ANY,n.ANY],min:2,max:3,acceptRef:!0},INDEX:{argumentsType:[n.ANY,n.NUMBER,n.NUMBER,n.NUMBER],min:2,max:4,acceptRef:!0},ISERROR:{argumentsType:[n.NOT_ARRAY],min:1,max:1},ISERR:{argumentsType:[n.NOT_ARRAY],min:1,max:1},FIND:{argumentsType:[n.STRING,n.STRING,n.NUMBER],min:2,max:3},SUMPRODUCT:{argumentsType:n.ANY,min:1,acceptRef:!0},ISNA:{argumentsType:[n.ANY],min:1,max:1},ISNUMBER:{argumentsType:[n.NOT_ARRAY],min:1,max:1},IFERROR:{argumentsType:[n.ANY,n.NOT_ARRAY],min:2,max:2},ROW:{argumentsType:[n.ANY],min:0,max:1,acceptRef:!0},TODAY:{argumentsType:[n.ANY],min:0,max:0},MATCH:{argumentsType:[n.NOT_ARRAY,n.ANY,n.ANY],min:2,max:3,acceptRef:!0},TRIM:{argumentsType:[n.STRING],min:1,max:1},CONCATENATE:{argumentsType:[n.ARRAY],min:1},CONCAT:{argumentsType:n.ANY,min:1},CHOOSE:{argumentsType:[n.NUMBER,n.ANY],min:2,max:255,acceptRef:!0},PRODUCT:{argumentsType:n.ANY,min:1,acceptRef:!0},SPECIALMATCH:{argumentsType:[n.ANY,n.ANY,n.STRING],min:3,max:3},MATHMATCH:{argumentsType:[n.NUMBER,n.NUMBER,n.STRING],min:3,max:3,acceptRef:!0},LOGICMATCH:{argumentsType:[n.NOT_ARRAY,n.NOT_ARRAY,n.STRING],min:3,max:3},SUBSTITUTE:{argumentsType:[n.STRING,n.STRING,n.STRING,n.NUMBER],min:3,max:4},TRUNC:{argumentsType:[n.NUMBER,n.NUMBER],min:1,max:2},OFFSET:{argumentsType:[n.ANY,n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER],min:3,max:5,acceptRef:!0},VALUE:{argumentsType:[n.STRING],min:1,max:1},FIXED:{argumentsType:[n.NUMBER,n.NUMBER,n.BOOL],min:1,max:3},ISBLANK:{argumentsType:[n.NOT_ARRAY],min:1,max:1},ASC:{argumentsType:[n.STRING],min:1,max:1},UPPER:{argumentsType:[n.STRING],min:1,max:1},LN:{argumentsType:[n.NUMBER],min:1,max:1},"CEILING.ORIGIN":{argumentsType:[n.NUMBER,n.NUMBER],min:2,max:2},"CEILING.MATH":{argumentsType:[n.NUMBER,n.NUMBER,n.NUMBER],min:1,max:3},"CEILING.PRECISE":{argumentsType:[n.NUMBER,n.NUMBER],min:1,max:2},"FLOOR.ORIGIN":{argumentsType:[n.NUMBER,n.NUMBER],min:2,max:2},"FLOOR.MATH":{argumentsType:[n.NUMBER,n.NUMBER,n.NUMBER],min:1,max:3},"FLOOR.PRECISE":{argumentsType:[n.NUMBER,n.NUMBER],min:1,max:2},ADDRESS:{argumentsType:[n.NUMBER,n.NUMBER,n.NUMBER,n.BOOL,n.STRING],min:2,max:5},COLUMN:{argumentsType:[n.ANY],min:0,max:1,acceptRef:!0},"WORKDAY.ORIGIN":{argumentsType:[n.DATE,n.NOT_ARRAY,n.ARRAY],min:2,max:3},"WORKDAY.INTL":{argumentsType:[n.DATE,n.NOT_ARRAY,n.NUMBER,n.ARRAY],min:2,max:4},AVERAGEIF:{argumentsType:[n.ANY,n.ANY,n.ANY],min:2,max:3,acceptRef:!0},"RANK.EQ":{argumentsType:[n.NUMBER,n.ARRAY,n.NUMBER],min:2,max:3},"RANK.AVG":{argumentsType:[n.NUMBER,n.ARRAY,n.NUMBER],min:2,max:3},AVERAGEA:{argumentsType:n.ANY,min:1},LOG:{argumentsType:[n.NUMBER,n.NUMBER],min:1,max:2},CHAR:{argumentsType:[n.NUMBER],min:1,max:1},COS:{argumentsType:[n.NUMBER],min:1,max:1},SIN:{argumentsType:[n.NUMBER],min:1,max:1},SINH:{argumentsType:[n.NUMBER],min:1,max:1},TAN:{argumentsType:[n.NUMBER],min:1,max:1},ASIN:{argumentsType:[n.NUMBER],min:1,max:1},ACOS:{argumentsType:[n.NUMBER],min:1,max:1},ATAN:{argumentsType:[n.NUMBER],min:1,max:1},PI:{argumentsType:[],min:0,max:0},DEGREES:{argumentsType:[n.NUMBER],min:1,max:1},RADIANS:{argumentsType:[n.NUMBER],min:1,max:1},ISODD:{argumentsType:[n.NOT_ARRAY],min:1,max:1},N:{argumentsType:[n.ANY],min:1,max:1},REPT:{argumentsType:[n.STRING,n.NUMBER],min:2,max:2},SMALL:{argumentsType:[n.ARRAY,n.NOT_ARRAY],min:2,max:2},LARGE:{argumentsType:[n.ARRAY,n.NOT_ARRAY],min:2,max:2},MINUTE:{argumentsType:[n.DATE],min:1,max:1},HOUR:{argumentsType:[n.DATE],min:1,max:1},SECOND:{argumentsType:[n.DATE],min:1,max:1},NOT:{argumentsType:[n.ANY],min:1,max:1},PROPER:{argumentsType:[n.NOT_ARRAY],min:1,max:1},LOWER:{argumentsType:[n.NOT_ARRAY],min:1,max:1},EOMONTH:{argumentsType:[n.DATE,n.NUMBER],min:2,max:2},EDATE:{argumentsType:[n.DATE,n.NUMBER],min:2,max:2},PMT:{argumentsType:[n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER],min:3,max:5},IMSUB:{argumentsType:[n.NOT_ARRAY,n.NOT_ARRAY],min:2,max:2},IMCONJUGATE:{argumentsType:[n.NOT_ARRAY],min:1,max:1},COMPLEX:{argumentsType:[n.NUMBER,n.NUMBER,n.STRING],min:2,max:3},POWER:{argumentsType:[n.NUMBER,n.NUMBER],min:2,max:2},TRUE:{argumentsType:[],min:0,max:0},FALSE:{argumentsType:[],min:0,max:0},LOG10:{argumentsType:[n.NUMBER],min:1,max:1},EXP:{argumentsType:[n.NUMBER],min:1,max:1},RATE:{argumentsType:[n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER],min:3,max:6},SUMSQ:{argumentsType:n.ANY,min:1},STDEVA:{argumentsType:n.ANY,min:1},STDEVPA:{argumentsType:n.ANY,min:1},VARA:{argumentsType:n.ANY,min:1},VARPA:{argumentsType:n.ANY,min:1},AVEDEV:{argumentsType:n.ANY,min:1},DEVSQ:{argumentsType:n.ANY,min:1},EXACT:{argumentsType:[n.STRING,n.STRING],min:2,max:2},ROMAN:{argumentsType:[n.NUMBER,n.NUMBER],min:1,max:2},CORREL:{argumentsType:[n.ARRAY,n.ARRAY],min:2,max:2},TEXTJOIN:{argumentsType:n.ANY,min:3},GEOMEAN:{argumentsType:n.ANY,min:1},HARMEAN:{argumentsType:n.ANY,min:1},IPMT:{argumentsType:[n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER],min:4,max:6},PPMT:{argumentsType:[n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER],min:4,max:6},UNICHAR:{argumentsType:[n.NUMBER],min:1,max:1},UNICODE:{argumentsType:[n.ANY],min:1,max:1},CHIDIST:{argumentsType:[n.NUMBER,n.NUMBER],min:2,max:2},KURT:{argumentsType:n.ANY,min:1},INTERCEPT:{argumentsType:[n.ARRAY,n.ARRAY],min:2,max:2},PEARSON:{argumentsType:[n.ARRAY,n.ARRAY],min:2,max:2},RSQ:{argumentsType:[n.ARRAY,n.ARRAY],min:2,max:2},ISEVEN:{argumentsType:[n.NOT_ARRAY],min:1,max:1},"SKEW.ORIGIN":{argumentsType:n.ANY,min:1},"SKEW.P":{argumentsType:n.ANY,min:1},WEEKNUM:{argumentsType:[n.DATE,n.NUMBER],min:1,max:2},ISOWEEKNUM:{argumentsType:[n.DATE],min:1,max:1},SLOPE:{argumentsType:n.ANY,min:2,max:2},CODE:{min:1,max:1},ATAN2:{argumentsType:[n.NUMBER,n.NUMBER],min:2,max:2},ASINH:{argumentsType:[n.NUMBER],min:1,max:1},ACOSH:{argumentsType:[n.NUMBER],min:1,max:1},TANH:{argumentsType:[n.NUMBER],min:1,max:1},ATANH:{argumentsType:[n.NUMBER],min:1,max:1},COSH:{argumentsType:[n.NUMBER],min:1,max:1},COT:{argumentsType:[n.NUMBER],min:1,max:1},COTH:{argumentsType:[n.NUMBER],min:1,max:1},ACOT:{argumentsType:[n.NUMBER],min:1,max:1},ACOTH:{argumentsType:[n.NUMBER],min:1,max:1},REPLACE:{argumentsType:[n.STRING,n.NUMBER,n.NUMBER,n.STRING],min:4,max:4},CLEAN:{argumentsType:[n.STRING],min:1,max:1},FV:{argumentsType:[n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER],min:3,max:5},DOLLAR:{argumentsType:[n.NUMBER,n.NUMBER],min:1,max:2},XOR:{argumentsType:n.ANY,min:1},PV:{argumentsType:[n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER],min:3,max:5},SQRTPI:{argumentsType:[n.NUMBER],min:1,max:1},TIME:{argumentsType:[n.NUMBER,n.NUMBER,n.NUMBER],min:3,max:3},DATEVALUE:{argumentsType:[n.STRING],min:1,max:1},TIMEVALUE:{argumentsType:[n.STRING],min:1,max:1},FVSCHEDULE:{argumentsType:[n.NOT_ARRAY,n.ANY],min:2,max:2},"VAR.P":{argumentsType:n.ANY,min:1},"VAR.S":{argumentsType:n.ANY,min:1},"STDEV.S":{argumentsType:n.ANY,min:1},IRR:{argumentsType:[n.ARRAY,n.NUMBER],min:1,max:2},DAYS:{argumentsType:[n.DATE,n.DATE],min:2,max:2},DAYS360:{argumentsType:[n.DATE,n.DATE,n.BOOL],min:2,max:3},YEARFRAC:{argumentsType:[n.DATE,n.DATE,n.NUMBER],min:2,max:3},CUMIPMT:{argumentsType:[n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER],min:6,max:6},CUMPRINC:{argumentsType:[n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER],min:6,max:6},T:{argumentsType:[n.ANY],min:1,max:1},MROUND:{argumentsType:[n.NUMBER,n.NUMBER],min:2,max:2},EFFECT:{argumentsType:[n.NUMBER,n.NUMBER],min:2,max:2},NOMINAL:{argumentsType:[n.NUMBER,n.NUMBER],min:2,max:2},EVEN:{argumentsType:[n.NUMBER],min:1,max:1},ODD:{argumentsType:[n.NUMBER],min:1,max:1},BESSELI:{argumentsType:[n.NUMBER,n.NUMBER],min:2,max:2},BESSELJ:{argumentsType:[n.NUMBER,n.NUMBER],min:2,max:2},BESSELK:{argumentsType:[n.NUMBER,n.NUMBER],min:2,max:2},BESSELY:{argumentsType:[n.NUMBER,n.NUMBER],min:2,max:2},TRIMMEAN:{argumentsType:[n.ANY,n.NUMBER],min:2,max:2},BIN2DEC:{argumentsType:[n.STRING],min:1,max:1},BIN2OCT:{argumentsType:[n.STRING,n.NUMBER],min:1,max:2},BIN2HEX:{argumentsType:[n.STRING,n.NUMBER],min:1,max:2},OCT2DEC:{argumentsType:[n.STRING],min:1,max:1},OCT2BIN:{argumentsType:[n.STRING,n.NUMBER],min:1,max:2},OCT2HEX:{argumentsType:[n.STRING,n.NUMBER],min:1,max:2},HEX2BIN:{argumentsType:[n.STRING,n.NUMBER],min:1,max:2},HEX2OCT:{argumentsType:[n.STRING,n.NUMBER],min:1,max:2},HEX2DEC:{argumentsType:[n.STRING],min:1,max:1},DEC2BIN:{argumentsType:[n.STRING,n.NUMBER],min:1,max:2},DEC2OCT:{argumentsType:[n.STRING,n.NUMBER],min:1,max:2},DEC2HEX:{argumentsType:[n.STRING,n.NUMBER],min:1,max:2},SYD:{argumentsType:[n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER],min:4,max:4},SLN:{argumentsType:[n.NUMBER,n.NUMBER,n.NUMBER],min:3,max:3},MAXA:{argumentsType:n.ANY,min:1},MINA:{argumentsType:n.ANY,min:1},PRICE:{argumentsType:[n.DATE,n.DATE,n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER],min:6,max:7},PRICEDISC:{argumentsType:[n.DATE,n.DATE,n.NUMBER,n.NUMBER,n.NUMBER],min:4,max:5},"MODE.SNGL":{argumentsType:n.ANY,min:1},MEDIAN:{argumentsType:n.ANY,min:1},PRICEMAT:{argumentsType:[n.DATE,n.DATE,n.DATE,n.NUMBER,n.NUMBER,n.NUMBER],min:5,max:6},"PERCENTRANK.INC":{argumentsType:[n.ARRAY,n.NUMBER,n.NUMBER],min:2,max:3},"PERCENTRANK.EXC":{argumentsType:[n.ARRAY,n.NUMBER,n.NUMBER],min:2,max:3},YIELD:{argumentsType:[n.DATE,n.DATE,n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER],min:6,max:7},YIELDMAT:{argumentsType:[n.DATE,n.DATE,n.DATE,n.NUMBER,n.NUMBER,n.NUMBER],min:5,max:6},YIELDDISC:{argumentsType:[n.DATE,n.DATE,n.NUMBER,n.NUMBER,n.NUMBER],min:4,max:5},DB:{argumentsType:[n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER,n.NUMBER],min:4,max:5},"ERF.ORIGIN":{argumentsType:[n.NUMBER,n.NUMBER],min:1,max:2},"ERF.PRECISE":{argumentsType:[n.NUMBER],min:1,max:1},"ERFC.PRECISE":{argumentsType:[n.NUMBER],min:1,max:1},NA:{argumentsType:[],min:0,max:0},SEARCH:{argumentsType:[n.STRING,n.STRING,n.NUMBER],min:2,max:3},RANDBETWEEN:{argumentsType:[n.NUMBER,n.NUMBER],min:2,max:2},CONVERT:{argumentsType:[n.NUMBER,n.STRING,n.STRING],min:3,max:3},COUNTBLANK:{argumentsType:[n.ARRAY],min:1,max:1},DELTA:{argumentsType:[n.NUMBER,n.NUMBER],min:1,max:2},GESTEP:{argumentsType:[n.NUMBER,n.NUMBER],min:1,max:2},MINVERSE:{argumentsType:[n.ANY],min:1,max:1,acceptRef:!0},MMULT:{argumentsType:[n.ANY,n.ANY],min:2,max:2,acceptRef:!0},"NETWORKDAYS.ORIGIN":{argumentsType:[n.NOT_ARRAY,n.NOT_ARRAY],min:2,max:3},"NETWORKDAYS.INTL":{argumentsType:[n.NOT_ARRAY,n.NOT_ARRAY],min:2,max:4},ISFORMULA:{argumentsType:n.ANY,min:1,max:1,acceptRef:!0},ISREF:{argumentsType:n.ANY,min:1,max:1,acceptRef:!0},AVERAGEIFS:{argumentsType:n.ANY,min:1,acceptRef:!0},FREQUENCY:{argumentsType:[n.ANY,n.ANY],min:2,max:2,acceptRef:!0},TRANSPOSE:{argumentsType:n.ANY,min:1,max:1},MINIFS:{argumentsType:n.ANY,min:3,acceptRef:!0},MAXIFS:{argumentsType:n.ANY,min:3,acceptRef:!0}}}}]);
//# sourceMappingURL=chunk-formula-pc-0108a8232c.js.map